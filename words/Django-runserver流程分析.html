<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> Django runserveræµç¨‹åˆ†æ </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>
            <a href="https://twitter.com/willdx">
                <button class="ui mini circular twitter icon button">
                  <i class="twitter icon"></i>
                </button>
            </a>
            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>Django runserveræµç¨‹åˆ†æ</h1>
        <h4>Posted April 07, 2017</h4>
        <p><a href="https://yq.aliyun.com/articles/39030">æ–‡ç« è½¬è‡ª01</a>
<a href="https://segmentfault.com/a/1190000002435578">æ–‡ç« è½¬è‡ª02</a></p>
<blockquote class="blockquote-normal">
                <p>è¿›å…¥project ç›®å½•-æ‰§è¡Œpython manage.py runserver-ç¨‹åºå¯åŠ¨</p><br/><p>é‚£djangoæ˜¯å¦‚ä½•ä»ä¸€ä¸ªå‘½ä»¤å°±å¯åŠ¨æ•´ä¸ªserver,å¯åŠ¨çš„æµç¨‹æ˜¯å¦‚ä½•çš„å‘¢</p><br/><p>æ‰“å¼€manage.py</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;will.settings&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># The above import may fail for some other reason. Ensure that the</span>
        <span class="c1"># issue is really that Django is missing to avoid masking other</span>
        <span class="c1"># exceptions on Python 2.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">django</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Couldn&#39;t import Django. Are you sure it&#39;s installed and &quot;</span>
                <span class="s2">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span>
                <span class="s2">&quot;forget to activate a virtual environment?&quot;</span>
            <span class="p">)</span>
        <span class="k">raise</span>
    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>é¦–å…ˆçœ‹os.environ.setdefault(),environä¸ºç±»_Environçš„ä¸€ä¸ªå®ä¾‹,å®ƒç»§æ‰¿è‡ªIterableUserDict,è€ŒIterableUserDictç»§æ‰¿è‡ªUserDict,åŒ…æ‹¬setdefault()è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯UserDictçš„ä¸€ä¸ªæ–¹æ³•,çœ‹ä¸€ä¸‹setdefaultå®ç°çš„åŠŸèƒ½</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># keyæ˜¯ DJANGO_SETTINGS_MODULE,è¿™é‡Œçš„selfæ˜¯ä¸€ä¸ªå­—å…¸</span>
<span class="c1"># åˆ¤æ–­keyæ˜¯ä¸æ˜¯åœ¨é‡Œé¢,ä¸åœ¨é‡Œé¢å°±åšä¸€ä¸ªé”®å€¼ç»‘å®š,ç„¶åè¿”å›</span>
  <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">failobj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">failobj</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>æ¥ç€å¯ä»¥çœ‹å‡ºå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯django.core.management.execute<em>from</em>command_lineå‡½æ•°</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim django/core/management/__init__.py</span>
<span class="k">def</span> <span class="nf">execute_from_command_line</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    A simple method that runs a ManagementUtility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utility</span> <span class="o">=</span> <span class="n">ManagementUtility</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>å…¶ä¸­ManagementUtilityä½ä¸€ä¸ªç±»ç©¿è¿›å»çš„å‚æ•°åˆ—è¡¨ä¼šè¿›å…¥ä¸€ä¸ªç®€å•çš„åˆå§‹åŒ–</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1">#å°†ä¼ å…¥çš„å‚æ•°èµ‹å€¼ç»™argv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">argv</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[:]</span> 

    <span class="c1">#å°†æ‰§è¡Œçš„æ–‡ä»¶åç§°,æ­¤æ—¶æ˜¯manage.pyä¼ é€’ç»™self.prog_name </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">settings_exception</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>å®ä¾‹åŒ–ä¹‹åæ‰§è¡Œutility.execute(),å³ManagementUtilityçš„execute()æ–¹æ³•</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;è·å–å‘½ä»¤è¡Œå‚æ•°,æ­¤å‡½æ•°ä¼šæ‰¾å‡ºéœ€è¦è¿è¡Œçš„å­å‘½ä»¤,ä¸ºå­å‘½ä»¤åˆ›å»ºä¸€ä¸ªåˆé€‚çš„è§£æå™¨,æ¥ç€è¿è¡Œå‘½ä»¤&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subcommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#è·å–å­å‘½ä»¤çš„åç§°,æ­¤æ—¶ä¸ºmanage.py</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">subcommand</span> <span class="o">=</span> <span class="s1">&#39;help&#39;</span>  <span class="c1">#è‹¥æœªè¾“å…¥å­å‘½ä»¤å‚æ•°,åˆ™ä¸€å¾‹è®¾å®šä¸ºhelp</span>

        <span class="c1"># é¢„å¤„ç†é€‰é¡¹_è®¾ç½®_æå–PYTHONPATH,è¿™äº›é€‰é¡¹å¯èƒ½ä¼šå½±å“å¯ç”¨çš„å‘½ä»¤,æ‰€ä»¥å¿…é¡»å°½æ—©å¤„ç†</span>
        <span class="c1"># ä»¥ä¸‹4è¡Œä»£ç å¯¹è¾“å…¥çš„å‘½ä»¤è¿›è¡Œäº†é¢„å¤„ç†(django.core.management.base.CommandParser)</span>
        <span class="c1"># CommandParserç»§æ‰¿ArgumentParser,è€ŒArgumentParserä»from argparseå¯¼å…¥</span>
        <span class="c1"># ArgumentParser.__doc__ä¸­æè¿°æ­¤ç±»æ˜¯ç”¨æ¥æ”¹å–„é”™è¯¯æ¶ˆæ¯ä»¥åŠé¢„é˜²åœ¨ä¸€äº›æƒ…å†µä¸‹çš„ç¨‹åºå¼‚å¸¸é€€å‡ºçš„æƒ…å†µ</span>
        <span class="c1"># argparseæ¨¡å—ä½œä¸ºoptparseçš„ä¸€ä¸ªæ›¿ä»£è¢«æ·»åŠ åˆ°Python2.7,æ˜¯ä¸€ä¸ªå…¨é¢çš„å‚æ•°å¤„ç†åº“</span>
        <span class="c1"># argparseå‚æ•°å¯ä»¥è§¦å‘ä¸åŒçš„åŠ¨ä½œ,åŠ¨ä½œç”± add_argument()æ–¹æ³•çš„actionå‚æ•°æŒ‡å®š,é»˜è®¤çš„åŠ¨ä½œæ˜¯ä¿å­˜å‚æ•°å€¼</span>
        <span class="c1"># [argparseå‚è€ƒæ–‡æ¡£](http://blog.xiayf.cn/2013/03/30/argparse/)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">CommandParser</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> subcommand [options] [args]&quot;</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;_settings&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;_pythonpath&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>  <span class="c1"># catch-all</span>

    <span class="c1"># å°†settingså’Œpythonpathä¿¡æ¯å­˜å‚¨åˆ°options,æŠŠé¢å¤–å‚æ•°æ”¾å…¥args</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
            <span class="n">handle_default_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CommandError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Ignore any option errors at this point.</span>

        <span class="n">no_settings_commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;_help&#39;</span><span class="p">,</span> <span class="s1">&#39;_version&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compilemessages&#39;</span><span class="p">,</span> <span class="s1">&#39;makemessages&#39;</span><span class="p">,</span>
            <span class="s1">&#39;startapp&#39;</span><span class="p">,</span> <span class="s1">&#39;startproject&#39;</span><span class="p">,</span>
        <span class="p">]</span>
      <span class="c1"># è¿™å—ä»£ç å°±å¯ä»¥è§£é‡Šæˆ‘ä»¬æ‰§è¡Œpython manage.py start project æ—¶djangoåœ¨èƒŒåä¼šè°ƒç”¨settings.configureæ–¹æ³•</span>
        <span class="c1"># è¿™é‡Œçš„settingsæ˜¯django.conf.LazySettingsçš„ä¸€ä¸ªå®ä¾‹</span>
        <span class="c1"># configureæ–¹æ³•ä½¿ç”¨django.conf.global_settings.pyä¸­çš„é»˜è®¤è®¾ç½®åˆ›å»ºä¸€ä»½æ–°çš„é…ç½®æ–‡ä»¶,ç»™æ–°å»ºçš„project</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span>
        <span class="k">except</span> <span class="n">ImproperlyConfigured</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings_exception</span> <span class="o">=</span> <span class="n">exc</span>
            <span class="c1"># A handful of built-in management commands work without settings</span>
            <span class="c1"># Load the default settings _ where INSTALLED_APPS is empty</span>
            <span class="k">if</span> <span class="n">subcommand</span> <span class="ow">in</span> <span class="n">no_settings_commands</span><span class="p">:</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">configured</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;runserver&#39;</span> <span class="ow">and</span> <span class="s1">&#39;_noreload&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">autoreload</span><span class="o">.</span><span class="n">check_errors</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">)()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">apps</span><span class="o">.</span><span class="n">all_models</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">)</span>
                    <span class="n">apps</span><span class="o">.</span><span class="n">app_configs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                    <span class="n">apps</span><span class="o">.</span><span class="n">apps_ready</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">models_ready</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="c1"># In all other cases, django.setup() is required to succeed.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># autoreload.check_errors(django.setup)()å…¶å®ä¹Ÿæ˜¯è°ƒç”¨django.setupæ–¹æ³•</span>
                <span class="c1"># è€Œdjango.setupæ–¹æ³•,è´Ÿè´£åˆå§‹åŒ–æ—¥å¿—æ¨¡å—ä»¥åŠæ‰€æœ‰åº”ç”¨</span>
                <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autocomplete</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;_commands&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_help_text</span><span class="p">(</span><span class="n">commands_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_help_text</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fetch_command</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">print_help</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Special-cases: We want &#39;django-admin _version&#39; and</span>
        <span class="c1"># &#39;django-admin _help&#39; to work, for backwards compatibility.</span>
        <span class="k">elif</span> <span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;version&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;_version&#39;</span><span class="p">]:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">([</span><span class="s1">&#39;_help&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-h&#39;</span><span class="p">]):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_help_text</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fetch_commandä¼šæ ¹æ®subcommand(è¿™æ˜¯æˆ‘ä»¬æ‰§è¡Œpython manage.py rumserveræ—¶ä¼ å…¥çš„</span>
            <span class="c1"># ç¬¬äºŒä¸ªå‚æ•°:runserver)å»django.core.management.commandsä¸­æŸ¥æ‰¾å¯¹åº”çš„commandç±»</span>
            <span class="c1"># ç„¶åæŠŠæ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ä¼ ç»™run_from_argvæ–¹æ³•å¹¶æ‰§è¡Œ,åœ¨runserverè¿™ä¸ªç¤ºä¾‹ä¸­,æœ€ç»ˆä¼šè°ƒç”¨</span>
            <span class="c1"># django.utils.autoreloadä¸­çš„python_reloaderæˆ–è€…jython_reloaderæ–°å¼€ä¸€ä¸ªçº¿ç¨‹</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetch_command</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span><span class="o">.</span><span class="n">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>è¿›å…¥runserver.py,Commandè¿™ä¸ªç±»ç»§æ‰¿äº†BaseCommandè¿™ä¸ªç±»,BaseCommandåœ¨Base.pyä¸­,é‡Œé¢æœ‰run<em>from</em>arvè¿™ä¸ªæ–¹æ³•,åœ¨å…¶ä»–çš„å‘½ä»¤é‡Œ<br/>æœ‰çš„é‡å†™äº†è¿™ä¸ªæ–¹æ³•</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="c1">#è®¾ç½®ç¯å¢ƒå˜é‡,ç„¶åè¿è¡Œè¿™ä¸ªå‘½ä»¤</span>
    <span class="c1">#å¦‚python  manage.py  runserver,manage.pyå°±æ˜¯argv[0],runserveræ˜¯argv[1]</span>
    <span class="c1">#create_parserç›´æ¥è°ƒç”¨OptionParser(prog=prog_name,usage=self.usage(subcommand),version=self.get_version(),option_list=self.option_list)</span>
    <span class="c1">#å°†manage.py å’ŒrunserveråŠ å…¥å‚æ•°åˆ—è¡¨</span>
    <span class="c1">#æ¥ä¸‹æ¥ç”¨parser.parse_argsè¿›è¡Œè§£æ,argv[2]ä¹‹åä¸ºé»˜è®¤å‚æ•°,ipåœ°å€è¿˜æœ‰ç«¯å£å·,æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾ç¤ºçš„ä¼ è¿›å»,é»˜è®¤æ˜¯127.0.0.1,ç«¯å£å·8000</span>
    <span class="c1">#ä¸‹é¢åˆåˆ°äº†handle_default_optionså‡½æ•°</span>
    <span class="c1">#æ¥ä¸‹æ¥æ˜¯æ‰§è¡Œexecuteå‡½æ•°,è¿˜æœ‰å¼‚å¸¸æ•è·</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_parser</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">handle_default_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">traceback</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">CommandError</span><span class="p">):</span>
            <span class="k">raise</span>

        <span class="c1"># self.stderr is not guaranteed to be set here</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">,</span> <span class="n">OutputWrapper</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">ERROR</span><span class="p">))</span>
        <span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>ä¸‹é¢è¿›å…¥executeå‡½æ•°,å‰è¾¹æ˜¯ä¸€äº›è®¾ç½®å’Œé”™è¯¯æ£€æŸ¥,æœ€ä¸»è¦çš„æ˜¯output=self.handle(*args, **options),å¯ä»¥å‘ç°handleåœ¨BaseCommandé‡Œæ˜¯ç©ºçš„,æ¯ä¸ªå‘½ä»¤å¯¹å…¶è¿›è¡Œäº†é‡å†™,runserverä¹Ÿæ˜¯</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addrport</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="c1">#å¯¼å…¥è®¾ç½®æ¨¡å—</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="c1">#DEBUGå’ŒALLOWED_HOSTSçš„è®¾ç½®</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">ALLOWED_HOSTS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s1">&#39;You must set settings.ALLOWED_HOSTS if DEBUG is False.&#39;</span><span class="p">)</span>
    <span class="c1">#ipv6çš„è®¾ç½®</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_ipv6&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">socket</span><span class="o">.</span><span class="n">has_ipv6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s1">&#39;Your Python does not support IPv6.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s1">&#39;Usage is runserver </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ipv6</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">addrport</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">DEFAULT_PORT</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#å¦‚æœè®¾ç½®äº†ipåœ°å€å’Œç«¯å£å·,ç”¨æ­£åˆ™åŒ¹é…å‡ºæ¥</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">naiveip_re</span><span class="p">,</span> <span class="n">addrport</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; is not a valid port number &#39;</span>
                               <span class="s1">&#39;or address:port pair.&#39;</span> <span class="o">%</span> <span class="n">addrport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">,</span> <span class="n">_ipv4</span><span class="p">,</span> <span class="n">_ipv6</span><span class="p">,</span> <span class="n">_fqdn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is not a valid port number.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_ipv6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ipv6</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_fqdn</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; is not a valid IPv6 address.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">:</span>
        <span class="c1">#å¦‚æœæ²¡æœ‰è®¾ç½®ipåœ°å€ä½¿ç”¨127.0.0.1ä»£æ›¿</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="s1">&#39;::1&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span> <span class="k">else</span> <span class="s1">&#39;127.0.0.1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ipv6</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span><span class="p">)</span>
     <span class="c1">#è¿è¡Œå‘½ä»¤</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>runserveré‡Œçš„runæ–¹æ³•ä¸»è¦æ—¶è°ƒç”¨äº†inner_run(*args, **options)è¿™ä¸ªæ–¹æ³•</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inner_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1">#çœç•¥äº†éƒ¨åˆ†ä»£ç </span>
        <span class="c1">#å¾ˆç†Ÿæ‚‰å§,è¿™å°±æ˜¯æˆ‘ä»¬å¼€å§‹è¿è¡Œæ—¶,ç»ˆç«¯ä¸Šè¾“å‡ºçš„ä¿¡æ¯å•Š </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">((</span>
            <span class="s2">&quot;</span><span class="si">%(started_at)s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Django version </span><span class="si">%(version)s</span><span class="s2">, using settings </span><span class="si">%(settings)r</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Starting development server at http://</span><span class="si">%(addr)s</span><span class="s2">:</span><span class="si">%(port)s</span><span class="s2">/</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Quit the server with </span><span class="si">%(quit_command)s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">(),</span>
            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">SETTINGS_MODULE</span><span class="p">,</span>
            <span class="s2">&quot;addr&quot;</span><span class="p">:</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ipv6</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">,</span>
            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="s2">&quot;quit_command&quot;</span><span class="p">:</span> <span class="n">quit_command</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="c1">#åŠ è½½ç¼–ç è®¾ç½®</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_handler</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span> <span class="n">handler</span><span class="p">,</span>
                <span class="n">ipv6</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_ipv6</span><span class="p">,</span> <span class="n">threading</span><span class="o">=</span><span class="n">threading</span><span class="p">)</span>

          <span class="c1">#çœç•¥éƒ¨åˆ†ä»£ç </span>

    <span class="k">def</span> <span class="nf">get_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the default WSGI handler for the runner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_internal_wsgi_application</span><span class="p">()</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>get<em>internal</em>wsgi_application()å’Œrun()éƒ½åœ¨django.core.servers.basehttpä¸­</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_internal_wsgi_application</span><span class="p">():</span>

    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="c1">#åœ¨settingsæ¨¡å—ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°WSGI_APPLICATIONè¿™ä¸ªç¯å¢ƒå˜é‡,å› æ­¤app_pathä½ç©º</span>
    <span class="n">app_path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;WSGI_APPLICATION&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">app_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_wsgi_application</span><span class="p">()</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>åœ¨django/coreä¸‹wsig.pyä¸­çš„æ–‡ä»¶å¦‚ä¸‹</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.core.handlers.wsgi</span> <span class="kn">import</span> <span class="n">WSGIHandler</span>


<span class="k">def</span> <span class="nf">get_wsgi_application</span><span class="p">():</span>

    <span class="c1">#setupæ˜¯åŠ è½½logå’Œsettings.INSTALLED_APPS</span>
    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="c1">#è¿”å›WSGIHhadlerç±»çš„ä¸€ä¸ªå®ä¾‹</span>
    <span class="k">return</span> <span class="n">WSGIHandler</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">WSGIHandler</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="c1">#åˆå§‹åŒ–ä¸€ä¸ªçº¿ç¨‹é”</span>
    <span class="n">initLock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
    <span class="c1">#WSGIRequestä¸ºhttp.HttpRequestçš„ä¸€ä¸ªå­ç±»,</span>
    <span class="c1">#WSGIRequestå®ç°äº†wsgiè§„èŒƒ </span>
    <span class="n">request_class</span> <span class="o">=</span> <span class="n">WSGIRequest</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>ä¸‹é¢æˆ‘ä»¬è¿›å…¥django.core.servers.basehttpä¸­çš„runæ–¹æ³•</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">wsgi_handler</span><span class="p">,</span> <span class="n">ipv6</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">threading</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">threading</span><span class="p">:</span>
        <span class="n">httpd_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;WSGIServer&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">WSGIServer</span><span class="p">),</span> <span class="p">{})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">httpd_cls</span> <span class="o">=</span> <span class="n">WSGIServer</span>
    <span class="n">httpd</span> <span class="o">=</span> <span class="n">httpd_cls</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">WSGIRequestHandler</span><span class="p">,</span> <span class="n">ipv6</span><span class="o">=</span><span class="n">ipv6</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">threading</span><span class="p">:</span>
        <span class="c1"># ThreadingMixIn.daemon_threads indicates how threads will behave on an</span>
        <span class="c1"># abrupt shutdown; like quitting the server by the user or restarting</span>
        <span class="c1"># by the auto-reloader. True means the server will not wait for thread</span>
        <span class="c1"># termination before it quits. This will make auto-reloader faster</span>
        <span class="c1"># and will prevent the need to kill the server manually if a thread</span>
        <span class="c1"># isn&#39;t terminating correctly.</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">daemon_threads</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">set_app</span><span class="p">(</span><span class="n">wsgi_handler</span><span class="p">)</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>httpd<em>cls(server</em>address, WSGIRequestHandler, ipv6=ipv6)ä¸ºå®ä¾‹åŒ–ä¸€ä¸ªWSGIServerç±»</p><br/><p>æœ€ç»ˆçš„å®ä¾‹åŒ–æ–¹æ³•åœ¨çˆ¶ç±»SocketServerä¸­çš„TCPServerå’ŒBaseServerä¸­<br/>åŒ…æ‹¬åˆå§‹åŒ–çº¿ç¨‹,åˆå§‹åŒ–ç½‘ç»œå¥æŸ„,åƒä¸‹é¢çš„<strong>is<em>shut</em>downå’Œ</strong>shutdown_requestéƒ½æ˜¯åœ¨å…¶ä¸­åˆå§‹åŒ–çš„</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1">#å¤„ç†ä¸€ä¸ªhttpè¯·æ±‚ç›´åˆ°å…³é—­</span>
   <span class="k">def</span> <span class="nf">serve_forever</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="c1">#__is_shut_downä¸ºä¸€ä¸ªåˆå§‹åŒ–çš„threading.Event()çš„å¥æŸ„,ç”¨äºçº¿ç¨‹é—´é€šä¿¡</span>
        <span class="c1">#.clear()å°†æ ‡è¯†è®¾ç½®ä¸ºfalse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_shut_down</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shutdown_request</span><span class="p">:</span>
                <span class="c1">#ä¸‹é¢çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªå°è£…å¥½äº†çš„selectå‡½æ•°,åé¢çš„å››ä¸ªä¸ºä¼ é€’ç»™selectå‡½æ•°çš„å‚æ•°,åˆ†åˆ«è¡¨ç¤ºè¾“å…¥å¯¹è±¡åˆ—è¡¨,è¾“å‡ºå¯¹è±¡åˆ—è¡¨,é”™è¯¯å¯¹è±¡åˆ—è¡¨ä»¥åŠè¶…æ—¶æ—¶é—´</span>
                <span class="c1">#è¿”å›å€¼ä¸ºä¸‰ä¸ªåˆ—è¡¨,ä»£è¡¨å¯å†™,å¯è¯»,é”™è¯¯çš„äº‹ä»¶çš„å¯¹è±¡åˆ—è¡¨</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">_eintr_retry</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> 
                                       <span class="n">poll_interval</span><span class="p">)</span>
                <span class="c1">#åˆ¤æ–­selfäº‹ä»¶æ˜¯å¦åœ¨å¯è¯»å¯¹è±¡åˆ—è¡¨ä¸­,åœ¨å°±è¿›å…¥è¿›è¡Œå¤„ç†</span>
                <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                    <span class="c1">#å¤„ç†è¿æ¥è¯·æ±‚</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_request_noblock</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shutdown_request</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c1">#å°†æ ‡è¯†è®¾ç½®ä¸ºtrue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__is_shut_down</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

   <span class="c1">#å¯¹selectå‡½æ•°çš„å°è£…        </span>
   <span class="k">def</span> <span class="nf">_eintr_retry</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;restart a system call interrupted by EINTR&quot;&quot;&quot;</span>
      <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EINTR</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_handle_request_noblock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#è¿”å›è¯·æ±‚å¥æŸ„,å®¢æˆ·ç«¯åœ°å€,get_request()ä¸­è°ƒç”¨äº†self.socket.accept()æ¥å®ç°å®¢æˆ·ç«¯çš„è¿æ¥</span>
            <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1">#çœŸæ­£çš„å¤„ç†è¿æ¥è¯·æ±‚çš„åœ°æ–¹,è°ƒç”¨äº†self.finish_request(request, client_address)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">finish_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finish one request by instantiating RequestHandlerClass.&quot;&quot;&quot;</span>
        <span class="c1">#æ­¤å¤„çš„RequestHandlerClassä¸ºåˆå§‹åŒ–çš„æ—¶å€™ä¼ è¿›æ¥çš„WSGIRequestHandler,å®ç°äº†å›è°ƒ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RequestHandlerClass</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>åœ¨WSGIRequestHandlerä¸­å®ç°ä¸‹é¢çš„åˆå§‹åŒ–å‡½æ•°</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">admin_static_prefix</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span> <span class="s1">&#39;admin/&#39;</span><span class="p">)</span>
    <span class="c1"># We set self.path to avoid crashes in log_message() on unsupported</span>
    <span class="c1"># requests (like &quot;OPTIONS&quot;).</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">color_style</span><span class="p">()</span>
    <span class="c1">#è°ƒç”¨çˆ¶ç±»çš„WSGIRequestHandlerè¿›è¡Œåˆå§‹åŒ–,å®ƒçš„çˆ¶ç±»æ˜¯simple_server.pyé‡Œçš„WSGIRequestHandler,å®ƒé‡Œé¢æ²¡æœ‰__init__,ç»§ç»­æ‰¾å®ƒçš„çˆ¶ç±»</span>
    <span class="c1">#å¦‚æ­¤é‡å¤,åœ¨æœ€ç»ˆçš„åŸºç±»ä¸­å¯ä»¥æ‰¾åˆ°__init__æ–¹æ³•,ä½äºSocketServer.pyä¸­çš„ BaseRequestHandlerç±».</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">WSGIRequestHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span> <span class="o">=</span> <span class="n">client_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
        <span class="c1">#setupå‡½æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>å¯ä»¥çœ‹åˆ°é‡Œé¢çš„æ–¹æ³•å¹¶æ²¡æœ‰å®ç°,åªæ˜¯ç»™å‡ºäº†å®šä¹‰,å®ç°éƒ½åœ¨å­ç±»</p><br/><p>å†å›åˆ°WSGIRequestHandlerç±»ä¸­,åœ¨simple_server.pyä¸­å®ç°äº†handleå‡½æ•°,å®ç°å¯¹è¯·æ±‚çš„å¤„ç†</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle a single HTTP request&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raw_requestline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_request</span><span class="p">():</span> <span class="c1"># An error code has been sent, just exit</span>
            <span class="k">return</span>
        <span class="c1">#ä¼ å…¥çš„å‚æ•°,è¯»,å†™,é”™è¯¯,ç¯å¢ƒå˜é‡.åœ¨å…¶çˆ¶ç±»SimpleHandlerä¸­è¿›è¡Œäº†åˆå§‹åŒ–,å¹¶ä¸”æ‰“å¼€äº†å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹é€‰é¡¹</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">ServerHandler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stderr</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_environ</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">request_handler</span> <span class="o">=</span> <span class="bp">self</span>      <span class="c1"># backpointer for logging</span>
        <span class="c1">#åœ¨SimpleHandlerçš„çˆ¶ç±»BaseHandlerä¸­å«å®ç°äº†runæ–¹æ³•.æ­¤å¤„get_app()æ˜¯ä¸Šé¢çš„runæ–¹æ³•ä¸­æˆ‘ä»¬ä¼ è¿›å»çš„wsgi_handler,httpd.set_app(wsgi_handler)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">())</span>      


    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#è®¾ç½®ç¯å¢ƒå˜é‡</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_environ</span><span class="p">()</span>
            <span class="c1">#æ‰§è¡ŒWSGIHandler(self.environ,self.start_response)</span>
            <span class="c1">#å› ä¸ºç±»ä¸­å®ç°äº†__call__æ–¹æ³•,è°ƒç”¨ç±»çš„å®ä¾‹å°±ç›¸å½“äºè°ƒç”¨äº†__call__æ–¹æ³•</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_response</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finish_response</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_error</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># If we get an error handling an error, just give up already!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">raise</span>   <span class="c1"># ...and let the actual server figure it out.</span>

 <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="c1"># Set up middleware if needed. We couldn&#39;t do this earlier, because</span>
    <span class="c1"># settings weren&#39;t available.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_middleware</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">initLock</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check that middleware is still uninitialised.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_middleware</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1">#å°è¯•åŠ è½½ä¸­é—´ä»¶</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_middleware</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># Unload whatever middleware we got</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_request_middleware</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">raise</span>
    <span class="c1">#è®¾ç½®è„šæœ¬è·¯å¾„</span>
    <span class="n">set_script_prefix</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">get_script_name</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
    <span class="n">signals</span><span class="o">.</span><span class="n">request_started</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_class</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad Request (UnicodeDecodeError)&#39;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HttpResponseBadRequest</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">response</span><span class="o">.</span><span class="n">_handler_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>

    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason_phrase</span><span class="p">)</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">response_headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">))))</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">force_str</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="n">response_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://willdx.github.io">willdx.github.io</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93231524-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: '177af99888a292531873',
        clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'Django-runserveræµç¨‹åˆ†æ',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>