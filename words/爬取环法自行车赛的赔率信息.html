<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> çˆ¬å–ç¯æ³•è‡ªè¡Œè½¦èµ›çš„èµ”ç‡ä¿¡æ¯ </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>





            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>çˆ¬å–ç¯æ³•è‡ªè¡Œè½¦èµ›çš„èµ”ç‡ä¿¡æ¯</h1>
        <h4>Posted April 07, 2017</h4>
        <h2>1.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># æ³¨æ„: ç¯å¢ƒä½¿ç”¨Python2.7.xç‰ˆæœ¬, è‹¥ä½¿ç”¨Python3ä¼šæœ‰å¾ˆå¤šå‘</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">Scrapy</span>
</pre></div>
</div>
<h2>1.2 åˆ›å»ºé¡¹ç›®</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">scrapy</span> <span class="n">startproject</span> <span class="n">huanfa</span>
</pre></div>
</div><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>(will_spiders) âœ  huanfa tree -L  3
.
â”œâ”€â”€ huanfa
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ items.py
â”‚Â Â  â”œâ”€â”€ middlewares.py
â”‚Â Â  â”œâ”€â”€ pipelines.py
â”‚Â Â  â”œâ”€â”€ settings.py
â”‚Â Â  â”œâ”€â”€ spiders
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ france_spider.py  # æ·»åŠ çš„çˆ¬è™«è„šæœ¬
â””â”€â”€ scrapy.cfg</pre></div></div>

<h2>1.3 æ ¼å¼åŒ–cookies</h2>

<ul>
<li><p>è·å–cookies</p>

<p>æ‰“å¼€å¼€å‘è€…å·¥å…·, Cookiesåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¼šä¾èµ–ä¸Šä¸€ä¸ªé¡µé¢, æ‰€ä»¥å…ˆè¿›åˆ°ä¸»é¡µ, ç„¶åè¿›å…¥åˆ°èµ”ç‡é¡µé¢, ç„¶åviewall-ç‚¹å‡»å…·ä½“ç»„åˆ«-Network-Headers-Cookies-ä½¿ç”¨Cookiesæ ¼å¼åŒ–å­—å…¸</p></li>
</ul>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14986229633303.jpg"></p>
</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">class</span> <span class="nc">transCookie</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookie</span> <span class="o">=</span> <span class="n">cookie</span>

    <span class="k">def</span> <span class="nf">stringToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        å°†ä»æµè§ˆå™¨ä¸ŠCopyæ¥çš„cookieå­—ç¬¦ä¸²è½¬åŒ–ä¸ºScrapyèƒ½ä½¿ç”¨çš„Dict</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">itemDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">itemDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">itemDict</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">cookie</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">transCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">trans</span><span class="o">.</span><span class="n">stringToDict</span><span class="p">()</span>
</pre></div>
</div>
<h2>1.4 Scrapyçˆ¬è™«ä»£ç </h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1">#   Author  :   Rhapsodyzs</span>
<span class="c1">#   E-mail  :   zs1213yh@gmail.com</span>
<span class="c1">#   Date    :   16/06/20 14:27:09</span>
<span class="c1">#   Desc    :   </span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">scrapy</span><span class="o">,</span> <span class="nn">MySQLdb</span><span class="o">,</span> <span class="nn">MySQLdb.cursors</span>
<span class="kn">from</span> <span class="nn">france.items</span> <span class="kn">import</span> <span class="n">FranceItem</span>
<span class="kn">from</span> <span class="nn">scrapy</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="kn">from</span> <span class="nn">godbox.utils.db</span> <span class="kn">import</span> <span class="n">my_get_dict_res</span>
<span class="kn">from</span> <span class="nn">godbox.options</span> <span class="kn">import</span> <span class="n">define</span><span class="p">,</span> <span class="n">options</span>
<span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>


<span class="c1"># æµ‹è¯•æ•°æ®åº“è¿æ¥</span>
<span class="n">define</span><span class="p">(</span><span class="s2">&quot;MYSQL_CONN_LOCAL&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">dbhost</span><span class="o">=</span><span class="s2">&quot;192.168.0.46&quot;</span><span class="p">,</span>
    <span class="n">dbuser</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="n">dbpass</span><span class="o">=</span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;xingzhe&quot;</span><span class="p">,</span>
    <span class="n">dbport</span><span class="o">=</span><span class="mi">3306</span>
<span class="p">))</span>

<span class="c1"># çº¿ä¸Šæ•°æ®åº“è¿æ¥</span>
<span class="n">define</span><span class="p">(</span><span class="s2">&quot;MYSQL_CONN_ONLINE&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">dbhost</span><span class="o">=</span><span class="s2">&quot;xxxx&quot;</span><span class="p">,</span>
    <span class="n">dbuser</span><span class="o">=</span><span class="s2">&quot;xx&quot;</span><span class="p">,</span>
    <span class="n">dbpass</span><span class="o">=</span><span class="s2">&quot;xx&quot;</span><span class="p">,</span>
    <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="n">dbport</span><span class="o">=</span><span class="mi">3306</span>
<span class="p">))</span>

<span class="c1"># æ–¹ä¾¿æµ‹è¯•åº“å’Œçº¿ä¸Šåº“çš„åˆ‡æ¢ </span>
<span class="n">MYSQL_CONN</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">MYSQL_CONN_ONLINE</span>

<span class="c1"># ç¯æ³•ç»„åˆ«</span>
<span class="c1"># TODO: ç›®å‰ç»Ÿè®¡åˆ°å·²æœ‰çš„é¡¹ç›®, åç»­åˆ†èµ›æ®µçš„é¡¹ç›®è¦å¡«è¿›æ¥</span>
<span class="n">france_group</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">#&quot;327979&quot;: {&quot;group_name&quot;: &quot;Stage Betting&quot;, &quot;xz_group_id&quot;: 100, &quot;zh_group_name&quot;: &quot;ç¬¬ä¸€èµ›æ®µ(13km-ITT)&quot;},</span>
    <span class="c1">#&quot;327921&quot;: {&quot;group_name&quot;: &quot;Outright Betting&quot;, &quot;xz_group_id&quot;: 96, &quot;zh_group_name&quot;: &quot;æ€»å† å†›&quot;},</span>
    <span class="c1">#&quot;1610187&quot;: {&quot;group_name&quot;: &quot;To Win Green Jersey&quot;, &quot;xz_group_id&quot;: 97, &quot;zh_group_name&quot;: &quot;æœ€ç»ˆç»¿è¡«è·å¾—è€…&quot;},</span>
    <span class="c1">#&quot;629274&quot;: {&quot;group_name&quot;: &quot;Number of Finishers&quot;, &quot;xz_group_id&quot;: 98, &quot;zh_group_name&quot;: &quot;å®Œèµ›äººæ•°&quot;},</span>
    <span class="s2">&quot;629275&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;group_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of Yellow Jerseys&quot;</span><span class="p">,</span> <span class="s2">&quot;xz_group_id&quot;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;zh_group_name&quot;</span><span class="p">:</span> <span class="s2">&quot;é»„è¡«è·å¾—äººæ•°&quot;</span><span class="p">}</span>
    <span class="c1">#&quot;328205&quot;: {&quot;group_name&quot;: &quot;King of the Mountains&quot;, &quot;xz_group_id&quot;: 121, &quot;zh_group_name&quot;: &quot;çˆ¬å¡ç‹&quot;},</span>
    <span class="c1">#&quot;328282&quot;: {&quot;group_name&quot;: &quot;Young Rider Classification&quot;, &quot;xz_group_id&quot;: 122, &quot;zh_group_name&quot;: &quot;æœ€ç»ˆç™½è¡«è·å¾—è€…&quot;}</span>
<span class="p">}</span>

<span class="n">competitor</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Stephen Cummings&quot;</span><span class="p">:</span> <span class="s2">&quot;å²è’‚èŠ¬Â·åº·æ˜æ–¯&quot;</span><span class="p">,</span> <span class="s2">&quot;Roman Kreuziger&quot;</span><span class="p">:</span> <span class="s2">&quot;ç½—æ›¼Â·å…‹ç½—ä¼Šé½æ ¼å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Alberto Contador&quot;</span><span class="p">:</span> <span class="s2">&quot;é˜¿å°”è´æ‰˜Â·åº·å¡”å¤š&quot;</span><span class="p">,</span> <span class="s2">&quot;Michael Matthews&quot;</span><span class="p">:</span> <span class="s2">&quot;è¿ˆå…‹å°”Â·é©¬ä¿®æ–¯&quot;</span><span class="p">,</span> <span class="s2">&quot;Tiago Machado&quot;</span><span class="p">:</span> <span class="s2">&quot;è’‚äºšæˆˆÂ·é©¬æŸ¥å¤š&quot;</span><span class="p">,</span> <span class="s2">&quot;Tony Martin&quot;</span><span class="p">:</span> <span class="s2">&quot;æ‰˜å°¼Â·é©¬ä¸&quot;</span><span class="p">,</span> <span class="s2">&quot;Luke Durbridge&quot;</span><span class="p">:</span> <span class="s2">&quot;å¢å…‹Â·å¾·å¸ƒé‡Œå¥‡&quot;</span><span class="p">,</span> <span class="s2">&quot;Jonathan Castroviejo&quot;</span><span class="p">:</span> <span class="s2">&quot;ä¹”çº³æ£®Â·å¡æ–¯ç½—ç»´ä¹Ÿè·&quot;</span><span class="p">,</span> <span class="s2">&quot;Dylan Van Baarle&quot;</span><span class="p">:</span> <span class="s2">&quot;è¿ªä¼¦Â·å‡¡Â·å·´é›·&quot;</span><span class="p">,</span> <span class="s2">&quot;Timo Roosen&quot;</span><span class="p">:</span> <span class="s2">&quot;è’‚è«Â·ç½—æ£®&quot;</span><span class="p">,</span> <span class="s2">&quot;Alejando Valverde&quot;</span><span class="p">:</span> <span class="s2">&quot;äºšå†æ­å¾·ç½—Â·å·´å°”éŸ¦å¾·&quot;</span><span class="p">,</span> <span class="s2">&quot;Alex Dowsett&quot;</span><span class="p">:</span> <span class="s2">&quot;äºšå†å…‹æ–¯Â·å¤šå¡ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Andrew Talansky&quot;</span><span class="p">:</span> <span class="s2">&quot;å®‰å¾·é²Â·å¡”å…°æ–¯åŸº&quot;</span><span class="p">,</span> <span class="s2">&quot;Jurgen Roelandts&quot;</span><span class="p">:</span> <span class="s2">&quot;å°¤å°”æ ¹Â·ç½—å…°å…¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Marcel Kittel&quot;</span><span class="p">:</span> <span class="s2">&quot;é©¬å¡å°”Â·åŸºç‰¹å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Greg Van Avermaet&quot;</span><span class="p">:</span> <span class="s2">&quot;æ ¼é›·æ ¼Â·èŒƒé˜¿ç»´é©¬&quot;</span><span class="p">,</span> <span class="s2">&quot;Nikias Arndt&quot;</span><span class="p">:</span> <span class="s2">&quot;å°¼å‡¯äºšæ–¯Â·é˜¿æ©ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Alexander Kristoff&quot;</span><span class="p">:</span> <span class="s2">&quot;äºšå†å±±å¤§Â·å…‹é‡Œæ–¯æ‰˜å¤«&quot;</span><span class="p">,</span> <span class="s2">&quot;Philippe Gilbert&quot;</span><span class="p">:</span> <span class="s2">&quot;è²åˆ©æ™®Â·å‰å°”ä¼¯ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Edvald Boasson Hagen&quot;</span><span class="p">:</span> <span class="s2">&quot;çˆ±å¾·åÂ·åšæ£®Â·å“ˆæ ¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Sylvain Chavanel&quot;</span><span class="p">:</span> <span class="s2">&quot;è¥¿å°”ä¸‡Â·æ²™ç“¦å†…å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Jos Van Emden&quot;</span><span class="p">:</span> <span class="s2">&quot;ä¹”æ–¯Â·å‡¡Â·åŸƒå§†ç™»&quot;</span><span class="p">,</span> <span class="s2">&quot;Patrick Bevin&quot;</span><span class="p">:</span> <span class="s2">&quot;å¸•ç‰¹é‡Œå…‹Â·è´æ–‡&quot;</span><span class="p">,</span> <span class="s2">&quot;Damiano Caruso&quot;</span><span class="p">:</span> <span class="s2">&quot;è¾¾ç±³äºšè¯ºÂ·å¡é²ç´¢&quot;</span><span class="p">,</span> <span class="s2">&quot;Alexey Lutsenko&quot;</span><span class="p">:</span> <span class="s2">&quot;é˜¿åˆ—å…‹è°¢Â·å¢å²‘ç§‘&quot;</span><span class="p">,</span> <span class="s2">&quot;Dmitry Gruzdev&quot;</span><span class="p">:</span> <span class="s2">&quot;å¾·ç±³ç‰¹é‡ŒÂ·æ ¼é²å…¹å¾·å¤«&quot;</span><span class="p">,</span> <span class="s2">&quot;Fabio Felline&quot;</span><span class="p">:</span> <span class="s2">&quot;æ³•æ¯”å¥¥Â·è´¹åˆ©å†…&quot;</span><span class="p">,</span> <span class="s2">&quot;Peter Sagan&quot;</span><span class="p">:</span> <span class="s2">&quot;å½¼å¾—Â·è¨ç”˜&quot;</span><span class="p">,</span> <span class="s2">&quot;Primoz Roglic&quot;</span><span class="p">:</span> <span class="s2">&quot;æ™®åˆ©è«æ³½Â·ç½—æ ¼é‡Œå¥‡&quot;</span><span class="p">,</span> <span class="s2">&quot;Tony Gallopin&quot;</span><span class="p">:</span> <span class="s2">&quot;æ‰˜å°¼Â·åŠ æ´›æ½˜&quot;</span><span class="p">,</span> <span class="s2">&quot;Jakob Fuglsang&quot;</span><span class="p">:</span> <span class="s2">&quot;é›…å„å¸ƒÂ·å¯Œæ ¼å°”æ¡‘&quot;</span><span class="p">,</span> <span class="s2">&quot;Reto Hollenstein&quot;</span><span class="p">:</span> <span class="s2">&quot;é›·æ‰˜Â·éœä¼¦æ–¯å¦&quot;</span><span class="p">,</span> <span class="s2">&quot;Rigoberto Uran&quot;</span><span class="p">:</span> <span class="s2">&quot;é‡Œæˆˆè´æ‰˜Â·ä¹Œå…°&quot;</span><span class="p">,</span> <span class="s2">&quot;Michael Albasini&quot;</span><span class="p">:</span> <span class="s2">&quot;è¿ˆå…‹å°”Â·é˜¿å°”å·´è¥¿å°¼&quot;</span><span class="p">,</span> <span class="s2">&quot;Geraint Thomas&quot;</span><span class="p">:</span> <span class="s2">&quot;æ°å…°ç‰¹Â·æ‰˜é©¬æ–¯&quot;</span><span class="p">,</span> <span class="s2">&quot;Jan Bakelants&quot;</span><span class="p">:</span> <span class="s2">&quot;è´¾æ©Â·å·´å…‹å…°èŒ¨&quot;</span><span class="p">,</span> <span class="s2">&quot;Andrey Amador&quot;</span><span class="p">:</span> <span class="s2">&quot;å®‰å¾·çƒˆÂ·é˜¿é©¬å¤šå°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Robert Gesink&quot;</span><span class="p">:</span> <span class="s2">&quot;ç½—ä¼¯ç‰¹Â·æ ¼è¾›å…‹&quot;</span><span class="p">,</span> <span class="s2">&quot;Nacer Bouhanni&quot;</span><span class="p">:</span> <span class="s2">&quot;çº³èµ›å°”Â·å¸ƒé˜¿å°¼&quot;</span><span class="p">,</span> <span class="s2">&quot;Maciej Bodanar&quot;</span><span class="p">:</span> <span class="s2">&quot;é©¬åˆ‡ä¼ŠÂ·åšå¾·çº³å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Taylor Phinney&quot;</span><span class="p">:</span> <span class="s2">&quot;æ³°å‹’Â·è²å°¼&quot;</span><span class="p">,</span> <span class="s2">&quot;Niki Terpstra&quot;</span><span class="p">:</span> <span class="s2">&quot;å°¼åŸºÂ·ç‰¹æ™®æ–¯ç‰¹æ‹‰&quot;</span><span class="p">,</span> <span class="s2">&quot;Michal Kwiatkowski&quot;</span><span class="p">:</span> <span class="s2">&quot;ç±³å“ˆä¹ŒÂ·ç§‘ç»´äºšç‰¹ç§‘å¤«æ–¯åŸº&quot;</span><span class="p">,</span> <span class="s2">&quot;Jens Keukeleire&quot;</span><span class="p">:</span> <span class="s2">&quot;å»¶æ–¯Â·å‡¯å…‹è±å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Yves Lampaert&quot;</span><span class="p">:</span> <span class="s2">&quot;ä¼Šå¤«Â·å…°å¸•ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Guillaume Van Keirsbulck&quot;</span><span class="p">:</span> <span class="s2">&quot;çºªå°§å§†Â·èŒƒå‡¯å°”æ–¯å¸ƒå…‹&quot;</span><span class="p">,</span> <span class="s2">&quot;Tim Wellens&quot;</span><span class="p">:</span> <span class="s2">&quot;è’‚å§†Â·éŸ¦åŸƒä¼¦æ–¯&quot;</span><span class="p">,</span> <span class="s2">&quot;Thomas De Gendt&quot;</span><span class="p">:</span> <span class="s2">&quot;æ‰˜é©¬æ–¯Â·å¾·Â·æ ¹ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Stefan Kung&quot;</span><span class="p">:</span> <span class="s2">&quot;æ–¯ç‰¹å‡¡Â·åº“æ©&quot;</span><span class="p">,</span> <span class="s2">&quot;Vasil Kiryienka&quot;</span><span class="p">:</span> <span class="s2">&quot;ç“¦è¥¿å°”Â·åŸºé‡Œè¿å¡&quot;</span><span class="p">,</span> <span class="s2">&quot;Marcus Burghardt&quot;</span><span class="p">:</span> <span class="s2">&quot;é©¬åº“æ–¯Â·å¸ƒå°”åŠ ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Pierre Latour&quot;</span><span class="p">:</span> <span class="s2">&quot;çš®åŸƒå°”Â·æ‹‰å›¾å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Thibaut Pinot&quot;</span><span class="p">:</span> <span class="s2">&quot;è’‚åšÂ·çš®è¯º&quot;</span><span class="p">,</span> <span class="s2">&quot;Matteo Trentin&quot;</span><span class="p">:</span> <span class="s2">&quot;é©¬ç‰¹å¥¥Â·ç‰¹ä¼¦ä¸&quot;</span><span class="p">,</span> <span class="s2">&quot;Nairo Quintana&quot;</span><span class="p">:</span> <span class="s2">&quot;å¥ˆç½—Â·é‡‘å¡”çº³&quot;</span><span class="p">,</span> <span class="s2">&quot;Damien Howson&quot;</span><span class="p">:</span> <span class="s2">&quot;è¾¾ç±³å®‰Â·è±ªæ£®&quot;</span><span class="p">,</span> <span class="s2">&quot;Mark Cavendish&quot;</span><span class="p">:</span> <span class="s2">&quot;é©¬å…‹Â·å¡æ–‡è¿ªä»€&quot;</span><span class="p">,</span> <span class="s2">&quot;Nelson Oliveira&quot;</span><span class="p">:</span> <span class="s2">&quot;å°¼å°”æ£®Â·å¥¥åˆ©ç»´æ‹‰&quot;</span><span class="p">,</span> <span class="s2">&quot;Andriy Grivko&quot;</span><span class="p">:</span> <span class="s2">&quot;å®‰å¾·é‡ŒÂ·æ ¼é‡Œå¤«ç§‘&quot;</span><span class="p">,</span> <span class="s2">&quot;Stephane Rossetto&quot;</span><span class="p">:</span> <span class="s2">&quot;æ–¯è’‚èŠ¬Â·ç½—å¡æ‰˜&quot;</span><span class="p">,</span> <span class="s2">&quot;Andre Greipel&quot;</span><span class="p">:</span> <span class="s2">&quot;å®‰å¾·çƒˆÂ·æ ¼é›·ä½©å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Jon Izaguirre&quot;</span><span class="p">:</span> <span class="s2">&quot;çº¦æ©Â·ä¼Šè¨å‰é›·&quot;</span><span class="p">,</span> <span class="s2">&quot;Richie Porte&quot;</span><span class="p">:</span> <span class="s2">&quot;é‡Œå¥‡Â·æ³¢ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Nils Politt&quot;</span><span class="p">:</span> <span class="s2">&quot;å°¼å°”æ–¯Â·æ³¢åˆ©ç‰¹&quot;</span><span class="p">,</span> <span class="s2">&quot;Arnaud Demare&quot;</span><span class="p">:</span> <span class="s2">&quot;é˜¿è¯ºÂ·å¾·ç›å°”&quot;</span><span class="p">,</span> <span class="s2">&quot;Chris Froome&quot;</span><span class="p">:</span> <span class="s2">&quot;å…‹é‡Œæ–¯Â·å¼—é²å§†&quot;</span><span class="p">}</span> 

<span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;http://www.sportsbet.com.au/betting/cycling/tour-de-france/outrights?&amp;ev_oc_grp_id={}&amp;is_ajax=1&amp;is_top_markets=&amp;ignore_linked=&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">DmozSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;france&quot;</span>
    <span class="n">start_urls</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">domain</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">france_group</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">]</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;price_all_dps_threshold&#39;</span><span class="p">:</span> <span class="s1">&#39;1.01&#39;</span><span class="p">,</span> <span class="s1">&#39;KP_UID&#39;</span><span class="p">:</span> <span class="s1">&#39;60070c3cf7dd50a23dc0f35c3a3eb611&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETPOOL&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;sbt_ssl_login&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;mvar&#39;</span><span class="p">:</span> <span class="s1">&#39;Carousel_Trial_R19&#39;</span><span class="p">,</span> <span class="s1">&#39;REMOTE_BS&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;sbt_login&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETLEG&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;cust_lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;price_dps_show_all&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;__qca&#39;</span><span class="p">:</span> <span class="s1">&#39;P0-1330082800-1498455850235&#39;</span><span class="p">,</span> <span class="s1">&#39;sbt_pref&#39;</span><span class="p">:</span> <span class="s1">&#39;bs_show_opts|yes|bs_minimized|min&#39;</span><span class="p">,</span> <span class="s1">&#39;RCVariant&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;BIR_REQ_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;_ga&#39;</span><span class="p">:</span> <span class="s1">&#39;GA1.3.874386321.1498455847&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETMULTI&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;POSSIBLE_PLACED_BET&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;_uetsid&#39;</span><span class="p">:</span> <span class="s1">&#39;_uetd310101a&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETLEGFORMAT&#39;</span><span class="p">:</span> <span class="s1">&#39;leg_sort|leg_type|lp_num|lp_den|hcap_value|bir_index|banker|selns|ew_fac_num|ew_fac_den|ew_places|lp_plc_num|lp_plc_den|wp_places|prev_lp_num|prev_lp_den|prev_hcap_value|positions|alt_price_types|ocv_id|default_price_type|leg_desc|mkt_ver_date|enhanced_odds_active|orig_lp_num|orig_lp_den|price_type|multi_prices|cust_rules_control|leg_num|disporder|stake|ccy_stake|mult_incl|displayed_lp_num|displayed_lp_den|displayed_hcap|boxed|retain|enhanced_odds_avail|enhanced_odds_win_num|enhanced_odds_win_den&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_SGL_STAKE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETRECEIPT&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;utag_main&#39;</span><span class="p">:</span> <span class="s1">&#39;v_id:015ce2edac120015c92a7004261a04079004407100838:3:0:1498488375999:8%3Bexp-session:1498483001945%3Bexp-session&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETJOINTACCT&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;SBBETFREEBET&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;sb_partner_mid&#39;</span><span class="p">:</span> <span class="s1">&#39;qF3bS5LVKIbulQmTAVK722Nd7ZgqdRLk12921&#39;</span><span class="p">,</span> <span class="s1">&#39;_gid&#39;</span><span class="p">:</span> <span class="s1">&#39;GA1.3.1461306886.1498455847&#39;</span><span class="p">,</span> <span class="s1">&#39;aid&#39;</span><span class="p">:</span> <span class="s1">&#39;2249009751748745&#39;</span><span class="p">,</span> <span class="s1">&#39;dialog_message&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;timer_stop&#39;</span><span class="p">:</span> <span class="s1">&#39;1498493772871&#39;</span><span class="p">,</span> <span class="s1">&#39;timer_start&#39;</span><span class="p">:</span> <span class="s1">&#39;1498483001642&#39;</span><span class="p">}</span>  <span class="c1"># å¸¦ç€Cookieå‘ç½‘é¡µå‘è¯·æ±‚</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Cookie&quot;</span><span class="p">:</span> <span class="n">cookies</span><span class="p">,</span> <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.sportsbet.com.au/betting/cycling/tour-de-france/outrights&quot;</span><span class="p">,</span> <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;</span><span class="p">}</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;dont_redirect&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;handle_httpstatus_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">301</span><span class="p">,</span> <span class="mi">302</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># çˆ¬è™«çš„èµ·ç‚¹</span>
    <span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># å¸¦ç€cookieå‘ç½‘ç«™æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œè¡¨æ˜æˆ‘ä»¬æ˜¯ä¸€ä¸ªå·²ç™»å½•çš„ç”¨æˆ·</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_urls</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cookies</span><span class="p">,</span>
                          <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;######:start&quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">france_group_id</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">query</span><span class="p">,</span><span class="bp">True</span><span class="p">)[</span><span class="s2">&quot;ev_oc_grp_id&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">group_info</span> <span class="o">=</span> <span class="n">france_group</span><span class="p">[</span><span class="n">france_group_id</span><span class="p">]</span>
        <span class="c1"># è¡Œè€…ç»„åˆ«</span>
        <span class="n">en_group_name</span> <span class="o">=</span> <span class="n">group_info</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span>  <span class="c1"># è‹±æ–‡ç»„åˆ«åç§°</span>
        <span class="n">xz_group_id</span> <span class="o">=</span> <span class="n">group_info</span><span class="p">[</span><span class="s2">&quot;xz_group_id&quot;</span><span class="p">]</span>   <span class="c1"># å¯¹åº”è¡Œè€…ç»„åˆ«ID</span>
        <span class="n">zh_group_name</span> <span class="o">=</span> <span class="n">group_info</span><span class="p">[</span><span class="s2">&quot;zh_group_name&quot;</span><span class="p">]</span> <span class="c1"># å¯¹åº”ä¸­æ–‡ç»„åˆ«åç§°</span>

        <span class="c1"># 1.å½’æ¡£å†å²æ•°æ®</span>
        <span class="n">updata_sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE lottery_options set is_expire=1 WHERE event_id={0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xz_group_id</span><span class="p">)</span>
        <span class="n">my_get_dict_res</span><span class="p">(</span><span class="n">updata_sql</span><span class="p">,</span> <span class="n">MYSQL_CONN</span><span class="p">)</span>

        <span class="c1"># 2.è·å–æœ€æ–°æ•°æ®</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">zh_group_name</span> <span class="o">==</span> <span class="s2">&quot;é»„è¡«è·å¾—äººæ•°&quot;</span><span class="p">:</span>
            <span class="n">divs</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;accordion-body-629275&quot;]&#39;</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">divs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># é»„è¡«å–ç¬¬ä¸€éƒ¨åˆ†</span>
            <span class="n">column</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># ç½‘é¡µçš„åˆ—æ•°</span>
            <span class="n">group_user_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># è®°å½•ç»„åˆ«äººæ•°</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">lottery_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;div[1]/div[{}]/a/span[1]/text()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">lottery_name</span> <span class="o">=</span> <span class="n">lottery_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Under&quot;</span><span class="p">,</span> <span class="s2">&quot;å°äº&quot;</span><span class="p">)</span>
                <span class="n">lottery_name</span> <span class="o">=</span> <span class="n">lottery_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Over&quot;</span><span class="p">,</span> <span class="s2">&quot;å¤§äº&quot;</span><span class="p">)</span>
                <span class="n">price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;div[1]/div[{}]/a/span[2]/text()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;lottery_name:{}, price:{}, xz_group_id:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lottery_name</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">xz_group_id</span><span class="p">))</span>
                <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lottery_name</span><span class="p">,</span> <span class="n">lottery_name</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">xz_group_id</span><span class="p">])</span>
                <span class="n">group_user_count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">group_user_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># è®°å½•ç»„åˆ«äººæ•°</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[contains(@class,&quot;market-buttons&quot;)]&#39;</span><span class="p">):</span>
                <span class="n">column</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#ç½‘é¡µçš„åˆ—æ•°</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">en_username</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;div[{}]/a/span[1]/text()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;div[{}]/a/span[2]/text()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">zh_username</span> <span class="o">=</span> <span class="n">competitor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">en_username</span><span class="p">,</span> <span class="n">en_username</span><span class="p">)</span>  <span class="c1"># å¦‚æœè·å–ä¸åˆ°ä¸­æ–‡åç§°, é‚£ä¹ˆå°±è®¾ç½®ä¸ºè‹±æ–‡åç§°</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;en_username:{},zh_username:{},price:{},xz_group_id:{}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">en_username</span><span class="p">,</span> <span class="n">zh_username</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">xz_group_id</span><span class="p">))</span>
                        <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">en_username</span><span class="p">,</span> <span class="n">zh_username</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">xz_group_id</span><span class="p">])</span>

                        <span class="c1"># ç»Ÿè®¡ç»„åˆ«äººæ•°</span>
                        <span class="n">group_user_count</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="c1"># 3.æ’å…¥æ•°æ®</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
            <span class="c1"># æ’å…¥å½©ç¥¨é€‰é¡¹è¡¨: ä¸­æ–‡ç”¨æˆ·ååç§°, è‹±æ–‡åç§°, èµ”ç‡, è¡Œè€…ç»„åˆ«</span>
            <span class="n">insert_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO lottery_options (c_content, content, odds, event_id) values(&#39;{}&#39;, &#39;{}&#39;, {}, {})&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;insert_sql: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">insert_sql</span><span class="p">))</span>
            <span class="n">my_get_dict_res</span><span class="p">(</span><span class="n">insert_sql</span><span class="p">,</span> <span class="n">MYSQL_CONN</span><span class="p">)</span>
             
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;è‹±æ–‡ç»„åˆ«åç§°:{}, è¡Œè€…ç»„åˆ«ID:{}, ä¸­æ–‡ç»„åˆ«åç§°:{}, äººæ•°:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">en_group_name</span><span class="p">,</span> <span class="n">xz_group_id</span><span class="p">,</span> <span class="n">zh_group_name</span><span class="p">,</span> <span class="n">group_user_count</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;######:end&quot;</span><span class="p">)</span>
</pre></div>
</div>
<h2>1.5 çˆ¬å–</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">scrapy</span> <span class="n">crawl</span> <span class="n">france</span>
</pre></div>
</div>
<h1>2018å¹´ç¯æ„</h1>

<p>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=327924&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</p>

<p><p class="hassubimage"><img src="media/15252481180063.jpg"></p>
</p>

<p><p class="hassubimage"><img src="media/15252489388143.jpg"></p>
</p>

<h2>ç»„åˆ«</h2>
<div class="code table-wrapper"><table class="ui selectable celled table"><thead>
<tr>
<th>è‹±æ–‡å</th>
<th>ä¸­æ–‡å</th>
<th>ç»„åˆ«</th>
<th>é“¾æ¥</th>
</tr>
</thead>

<tbody>
<tr>
<td>Outright Betting</td>
<td>æ€»å† å†›</td>
<td>327924</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=327924&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
<tr>
<td>Points Classification</td>
<td>å†²åˆºç‹</td>
<td>328201</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=328201&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
<tr>
<td>King of the Mountains</td>
<td>çˆ¬å¡ç‹</td>
<td>328204</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=328204&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
<tr>
<td>Team Classfication</td>
<td>è½¦é˜Ÿå† å†›</td>
<td>328207</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=328207&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
<tr>
<td>Young Rider Classification</td>
<td>æœ€ä½³å¹´è½»è½¦æ‰‹</td>
<td>328283</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=328283&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
<tr>
<td>Stage Betting</td>
<td>èµ›æ®µå† å†›</td>
<td>327982</td>
<td>https://www.sportsbet.com.au/betting/cycling/giro-ditalia/outrights?&amp;ev<em>oc</em>grp<em>id=327982&amp;is</em>ajax=1&amp;is<em>top</em>markets=&amp;ignore_linked=</td>
</tr>
</tbody>
</table></div>
    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://github.com/willdx/willdx.github.io">blog.willdx.me</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-68394485-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: 'de35601f0076c240632f',
        clientSecret: '903d34bc340117aaeadda4cb5c3bfe09a95c76db',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'çˆ¬å–ç¯æ³•è‡ªè¡Œè½¦èµ›çš„èµ”ç‡ä¿¡æ¯',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: [''],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>