<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> HashiCorpå…¨å®¶æ¡¶-Terraform </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>





            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>HashiCorpå…¨å®¶æ¡¶-Terraform</h1>
        <h4>Posted April 07, 2017</h4>
        <p><a href="https://www.hashicorp.com/">HashiCorpå®˜ç½‘</a></p>
<div class="code table-wrapper"><table class="ui selectable celled table"><thead>
<tr>
<th>æ¨¡å—åç§°</th>
<th>åŠŸèƒ½æè¿°</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="https://www.terraform.io/">Terraform</a></td>
<td>åˆ›å»ºï¼Œç»“åˆï¼Œå’Œç®¡ç†å¤šä¸ªæœåŠ¡æä¾›å•†çš„åŸºç¡€è®¾æ–½,ä¾‹å¦‚:ç®¡ç†é˜¿é‡Œäº‘æœåŠ¡</td>
</tr>
<tr>
<td><a href="https://www.vaultproject.io/docs/">Vault</a></td>
<td>é›†ä¸­å­˜å‚¨ï¼Œå®‰å…¨ï¼Œå’Œæ§åˆ¶åˆ†å¸ƒå¼ç§˜å¯†è®¿é—®</td>
</tr>
<tr>
<td><a href="https://www.consul.io/">Consul</a></td>
<td>åˆ†å¸ƒå¼çš„æœåŠ¡å‘ç°ã€é…ç½®é«˜å¯ç”¨çš„å·¥å…·å’Œæµç¨‹</td>
</tr>
<tr>
<td><a href="https://www.nomadproject.io/docs/">Nomad</a></td>
<td>é›†ç¾¤ç®¡ç†å’Œè°ƒåº¦åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ä»»ä½•åŸºç¡€è®¾æ–½</td>
</tr>
<tr>
<td><a href="https://www.packer.io/">Packer</a></td>
<td>è‡ªåŠ¨æ„å»ºé•œåƒ</td>
</tr>
<tr>
<td><a href="https://www.vagrantup.com/docs/index.html">Vagrant</a></td>
<td>ç¯å¢ƒç®¡ç†ä½¿å¾—å¼€å‘ç¯å¢ƒä¸€è‡´</td>
</tr>
</tbody>
</table></div>
<h1>1. å®‰è£…terraform</h1>

<p>ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„<a href="https://www.terraform.io/downloads.html">Terraformç‰ˆæœ¬</a>, å¹¶å°†å…¶æ”¾åˆ°ç³»ç»Ÿçš„PATHè·¯å¾„ä¸‹, ä»¥MACä¸ºä¾‹å­:</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># 1.è·å–PATHç¯å¢ƒå˜é‡
âœ  ~ echo $PATH
/usr/local/Cellar/postgresql/9.5.1/bin:/Library/Frameworks/Python.framework/Versions/3.5/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/aria2/bin:/usr/local/sbin

# 2.ä¸‹è½½å¹¶è§£å‹å®‰è£…æ–‡ä»¶
wget https://releases.hashicorp.com/terraform/0.11.3/terraform_0.11.3_darwin_amd64.zip
unzip nomad_0.7.1_darwin_amd64.zip

# 3.å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°ç¯å¢ƒå˜é‡ä¸‹
mv terraform /Library/Frameworks/Python.framework/Versions/3.5/bin/</pre></div></div>

<h1>2.å»ºè®¾åŸºç¡€è®¾æ–½</h1>

<p>Hashicorpæ¨èä½¿ç”¨<a href="https://github.com/hashicorp/hcl">HCLé¡¹ç›®</a>ç®¡ç†é…ç½®æ–‡ä»¶(PS: ç®¡ç†ç¬¬ä¸‰æ–¹äº‘å¹³å°çš„), åŒæ—¶, ä¹Ÿæ”¯æŒJSONè¯­æ³•; å‚è€ƒ<a href="https://www.terraform.io/docs/configuration/syntax.html">é…ç½®è¯­æ³•ä¾‹å­</a>;</p>

<h2>2.1 è·å–AWSçš„IAMå‡­è¯å‡­è¯</h2>

<p><a href="https://console.aws.amazon.com/iam/home?#/security_credential">AWSçš„å®‰å…¨å‡­è¯ç®¡ç†æ§åˆ¶å°</a>
<p class="hassubimage"><img src="http://iwillb.imdancer.com/15183307918069.jpg"></p>
</p>

<h2>2.2 åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶</h2>

<h3>2.1.1 åˆ›å»ºä¸€ä¸ªterraformç›®å½•ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>(PS: æ³¨æ„ç¡®ä¿å½“å‰ç›®å½•ä¸‹æ²¡æœ‰å…¶ä»–çš„tfç»“å°¾çš„æ–‡ä»¶, å› ä¸ºé»˜è®¤Terraformä¼šåŠ è½½æ‰€æœ‰å½“å‰ç›®å½•ä¸‹çš„.tfç»“å°¾çš„æ–‡ä»¶)
âœ  terraform pwd
/Users/daixiang/hashicorp/terraform
âœ  terraform ls
example.tf</pre></div></div>

<h3>2.1.2 å†™å…¥é…ç½®æ–‡ä»¶å†…å®¹</h3>

<p>providerå—ç”¨äºé…ç½®ä½¿ç”¨çš„ä¾›åº”å•†çš„åå­—;
resourceå—å®šä¹‰çš„åŸºç¡€è®¾æ–½ä¸­å­˜åœ¨çš„èµ„æº;</p>

<p>regionè¡¨ç¤ºåŒºåŸŸ, åœ¨ä¸åŒçš„å¹³å°æœ‰ä¸åŒçš„è¡¨ç¤º, amiæ˜¯å’Œregionå¯¹åº”çš„, æ¯ä¸€ä¸ªåŒºåŸŸéƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ami;
instance_typeè¡¨ç¤ºå®ä¾‹ç±»å‹, t2.micro è¡¨ç¤ºEC2 accounts, t1.micro è¡¨ç¤º EC2 Classic users;</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>provider "aws" {
  access_key = "ACCESS_KEY_HERE"
  secret_key = "SECRET_KEY_HERE"
  region     = "us-east-1"
}

resource "aws_instance" "example" {
  ami           = "ami-2757f631"
  instance_type = "t2.micro"
}</pre></div></div>

<h3>2.1.3 åˆå§‹åŒ–terraformç¯å¢ƒ</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform terraform init

Initializing provider plugins...
- Checking for available provider plugins on https://releases.hashicorp.com...
- Downloading plugin for provider "aws" (1.9.0)...

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = "..." constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.aws: version = "~> 1.9"

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
(PS: ä¸€å †æç¤ºä¿¡æ¯, åŒ…æ‹¬æˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡å®‰è£…, æ‰€ä»¥é»˜è®¤ç»™å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬....)</pre></div></div>

<h3>2.1.4 åº”ç”¨æ›´æ”¹</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform terraform apply

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  + aws_instance.example
      id:                           <computed>
      ami:                          "ami-2757f631"
      associate_public_ip_address:  <computed>
      availability_zone:            <computed>
      ebs_block_device.#:           <computed>
      ephemeral_block_device.#:     <computed>
      instance_state:               <computed>
      instance_type:                "t2.micro"
      ipv6_address_count:           <computed>
      ipv6_addresses.#:             <computed>
      key_name:                     <computed>
      network_interface.#:          <computed>
      network_interface_id:         <computed>
      placement_group:              <computed>
      primary_network_interface_id: <computed>
      private_dns:                  <computed>
      private_ip:                   <computed>
      public_dns:                   <computed>
      public_ip:                    <computed>
      root_block_device.#:          <computed>
      security_groups.#:            <computed>
      source_dest_check:            "true"
      subnet_id:                    <computed>
      tenancy:                      <computed>
      volume_tags.%:                <computed>
      vpc_security_group_ids.#:     <computed>


Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

aws_instance.example: Creating...
  ami:                          "" => "ami-2757f631"
  associate_public_ip_address:  "" => "<computed>"
  availability_zone:            "" => "<computed>"
  ebs_block_device.#:           "" => "<computed>"
  ephemeral_block_device.#:     "" => "<computed>"
  instance_state:               "" => "<computed>"
  instance_type:                "" => "t2.micro"
  ipv6_address_count:           "" => "<computed>"
  ipv6_addresses.#:             "" => "<computed>"
  key_name:                     "" => "<computed>"
  network_interface.#:          "" => "<computed>"
  network_interface_id:         "" => "<computed>"
  placement_group:              "" => "<computed>"
  primary_network_interface_id: "" => "<computed>"
  private_dns:                  "" => "<computed>"
  private_ip:                   "" => "<computed>"
  public_dns:                   "" => "<computed>"
  public_ip:                    "" => "<computed>"
  root_block_device.#:          "" => "<computed>"
  security_groups.#:            "" => "<computed>"
  source_dest_check:            "" => "true"
  subnet_id:                    "" => "<computed>"
  tenancy:                      "" => "<computed>"
  volume_tags.%:                "" => "<computed>"
  vpc_security_group_ids.#:     "" => "<computed>"
aws_instance.example: Still creating... (10s elapsed)
aws_instance.example: Still creating... (20s elapsed)
aws_instance.example: Still creating... (30s elapsed)
aws_instance.example: Creation complete after 38s (ID: i-0dc0b5ee43a90cadb)

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

PS: 
åœ¨åº”ç”¨æ›´æ”¹çš„æ—¶å€™, å‘Šè¯‰ä½ æœ‰å“ªäº›æ›´æ”¹, å¹¶éœ€è¦äººå·¥ç¡®è®¤åæ‰èƒ½æ‰§è¡Œ
å·®ä¸å¤š38sçš„æ—¶é—´æˆ‘ä»¬å¾—åˆ°äº†ä¸€å°AWSçš„æœºå™¨, å¾…æˆ‘å»æŸ¥çœ‹ä¸€ç•ª....
è¯·ç¡®ä¿ä½ çœ‹è¿™æ˜¯åœ¨æä¾›é…ç½®ä¸­é…ç½®ç›¸åŒçš„åŒºåŸŸ!

PS:
Terraformè¿˜å°†ä¸€äº›æ•°æ®å†™å…¥terraform.tfstateæ–‡ä»¶ã€‚è¿™ä¸ªçŠ¶æ€æ–‡ä»¶éå¸¸é‡è¦ã€‚å®ƒä¼šè·Ÿè¸ªåˆ›å»ºçš„èµ„æºçš„IDï¼Œä»¥ä¾¿TerraformçŸ¥é“å®ƒæ­£åœ¨ç®¡ç†ä»€ä¹ˆã€‚è¿™ä¸ªæ–‡ä»¶å¿…é¡»ä¿å­˜å¹¶åˆ†å‘ç»™ä»»ä½•å¯èƒ½è¿è¡ŒTerraformçš„äººã€‚é€šå¸¸å»ºè®® åœ¨ä½¿ç”¨Terraformæ—¶è®¾ç½®è¿œç¨‹çŠ¶æ€ï¼Œè‡ªåŠ¨å…±äº«çŠ¶æ€ï¼Œä½†å¯¹äºåƒæœ¬å…¥é—¨æŒ‡å—è¿™æ ·çš„ç®€å•æƒ…å†µï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„;</pre></div></div>

<h3>2.1.5 æ£€æŸ¥å½“å‰çš„çŠ¶æ€</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform terraform show
aws_instance.example:
  id = i-0dc0b5ee43a90cadb
  ami = ami-2757f631
  associate_public_ip_address = true
  availability_zone = us-east-1b
  disable_api_termination = false
  ebs_block_device.# = 0
  ebs_optimized = false
  ephemeral_block_device.# = 0
  iam_instance_profile =
  instance_state = running
  instance_type = t2.micro
  ipv6_addresses.# = 0
  key_name =
  monitoring = false
  network_interface.# = 0
  network_interface_id = eni-ba516677
  placement_group =
  primary_network_interface_id = eni-ba516677
  private_dns = ip-172-31-83-15.ec2.internal
  private_ip = 172.31.83.15
  public_dns = ec2-34-201-242-185.compute-1.amazonaws.com
  public_ip = 34.201.242.185
  root_block_device.# = 1
  root_block_device.0.delete_on_termination = true
  root_block_device.0.iops = 100
  root_block_device.0.volume_id = vol-00f923af0cadc022a
  root_block_device.0.volume_size = 8
  root_block_device.0.volume_type = gp2
  security_groups.# = 1
  security_groups.3814588639 = default
  source_dest_check = true
  subnet_id = subnet-14c5863b
  tags.% = 0
  tenancy = default
  volume_tags.% = 0
  vpc_security_group_ids.# = 1
  vpc_security_group_ids.436076155 = sg-6d1f771a
  
PS: æˆ‘ä»¬èƒ½æŸ¥çœ‹åˆ›å»ºçš„å®ä¾‹çš„ä¿¡æ¯, ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§èµ„äº§ç®¡ç†çš„è§„èŒƒ</pre></div></div>

<h1>3.æ”¹å˜åŸºç¡€è®¾æ–½</h1>

<p>é€šè¿‡ä½¿ç”¨Terraformæ”¹å˜åŸºç¡€è®¾æ–½ï¼Œå°±å¯ä»¥ç‰ˆæœ¬æ§åˆ¶ä¸ä»…æ˜¯ä½ çš„é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½ çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°åŸºç¡€è®¾æ–½å¦‚ä½•éšç€æ—¶é—´è€Œæ¼”å˜;</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># 1. æ›´æ”¹amié…ç½®ä¸ºami-b374d5a5
resource "aws_instance" "example" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"
}</pre></div></div>

<p>å‰ç¼€-/+æ˜¯æŒ‡Terraformä¼šç ´åå¹¶é‡æ–°åˆ›å»ºèµ„æºï¼Œè€Œä¸æ˜¯å°±åœ°æ›´æ–°å®ƒ;</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform terraform apply
aws_instance.example: Refreshing state... (ID: i-0dc0b5ee43a90cadb)

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
-/+ destroy and then create replacement

Terraform will perform the following actions:

-/+ aws_instance.example (new resource required)
      id:                           "i-0dc0b5ee43a90cadb" => <computed> (forces new resource)
      ami:                          "ami-2757f631" => "ami-b374d5a5" (forces new resource)
      associate_public_ip_address:  "true" => <computed>
      availability_zone:            "us-east-1b" => <computed>
      ebs_block_device.#:           "0" => <computed>
      ephemeral_block_device.#:     "0" => <computed>
      instance_state:               "running" => <computed>
      instance_type:                "t2.micro" => "t2.micro"
      ipv6_address_count:           "" => <computed>
      ipv6_addresses.#:             "0" => <computed>
      key_name:                     "" => <computed>
      network_interface.#:          "0" => <computed>
      network_interface_id:         "eni-ba516677" => <computed>
      placement_group:              "" => <computed>
      primary_network_interface_id: "eni-ba516677" => <computed>
      private_dns:                  "ip-172-31-83-15.ec2.internal" => <computed>
      private_ip:                   "172.31.83.15" => <computed>
      public_dns:                   "ec2-34-201-242-185.compute-1.amazonaws.com" => <computed>
      public_ip:                    "34.201.242.185" => <computed>
      root_block_device.#:          "1" => <computed>
      security_groups.#:            "1" => <computed>
      source_dest_check:            "true" => "true"
      subnet_id:                    "subnet-14c5863b" => <computed>
      tenancy:                      "default" => <computed>
      volume_tags.%:                "0" => <computed>
      vpc_security_group_ids.#:     "1" => <computed>


Plan: 1 to add, 0 to change, 1 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

aws_instance.example: Destroying... (ID: i-0dc0b5ee43a90cadb)
aws_instance.example: Still destroying... (ID: i-0dc0b5ee43a90cadb, 10s elapsed)
aws_instance.example: Still destroying... (ID: i-0dc0b5ee43a90cadb, 20s elapsed)
aws_instance.example: Still destroying... (ID: i-0dc0b5ee43a90cadb, 30s elapsed)
aws_instance.example: Still destroying... (ID: i-0dc0b5ee43a90cadb, 40s elapsed)
aws_instance.example: Destruction complete after 49s
aws_instance.example: Creating...
  ami:                          "" => "ami-b374d5a5"
  associate_public_ip_address:  "" => "<computed>"
  availability_zone:            "" => "<computed>"
  ebs_block_device.#:           "" => "<computed>"
  ephemeral_block_device.#:     "" => "<computed>"
  instance_state:               "" => "<computed>"
  instance_type:                "" => "t2.micro"
  ipv6_address_count:           "" => "<computed>"
  ipv6_addresses.#:             "" => "<computed>"
  key_name:                     "" => "<computed>"
  network_interface.#:          "" => "<computed>"
  network_interface_id:         "" => "<computed>"
  placement_group:              "" => "<computed>"
  primary_network_interface_id: "" => "<computed>"
  private_dns:                  "" => "<computed>"
  private_ip:                   "" => "<computed>"
  public_dns:                   "" => "<computed>"
  public_ip:                    "" => "<computed>"
  root_block_device.#:          "" => "<computed>"
  security_groups.#:            "" => "<computed>"
  source_dest_check:            "" => "true"
  subnet_id:                    "" => "<computed>"
  tenancy:                      "" => "<computed>"
  volume_tags.%:                "" => "<computed>"
  vpc_security_group_ids.#:     "" => "<computed>"
aws_instance.example: Still creating... (10s elapsed)
^@aws_instance.example: Still creating... (20s elapsed)
aws_instance.example: Still creating... (30s elapsed)
aws_instance.example: Creation complete after 35s (ID: i-0c648bf865b52b8c1)

Apply complete! Resources: 1 added, 0 changed, 1 destroyed.</pre></div></div>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/15183374587980.jpg"></p>
</p>

<h1>4.æ‘§æ¯åŸºç¡€è®¾æ–½</h1>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform terraform destroy
aws_instance.example: Refreshing state... (ID: i-0c648bf865b52b8c1)

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  - aws_instance.example


Plan: 0 to add, 0 to change, 1 to destroy.

Do you really want to destroy?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

aws_instance.example: Destroying... (ID: i-0c648bf865b52b8c1)
aws_instance.example: Still destroying... (ID: i-0c648bf865b52b8c1, 10s elapsed)
aws_instance.example: Still destroying... (ID: i-0c648bf865b52b8c1, 20s elapsed)
aws_instance.example: Still destroying... (ID: i-0c648bf865b52b8c1, 30s elapsed)
aws_instance.example: Still destroying... (ID: i-0c648bf865b52b8c1, 40s elapsed)
aws_instance.example: Destruction complete after 46s

Destroy complete! Resources: 1 destroyed.</pre></div></div>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/15183376967356.jpg"></p>
</p>

<h1>5.èµ„æºä¾èµ–å…³ç³»</h1>

<h2>5.1 åˆ†é…ä¸€ä¸ªå¼¹æ€§IP</h2>

<h3>5.1.1 æ·»åŠ é…ç½®</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>resource "aws_eip" "ip" {
  instance = "${aws_instance.example.id}"
}</pre></div></div>

<h3>5.1.2 è‡ªåŠ¨æ¨æ–­ä¾èµ–</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># 2. Terraformåˆ›å»ºå¼¹æ€§IPåœ°å€ä¹‹å‰åˆ›å»ºçš„EC2å®ä¾‹ã€‚ç”±äºæ˜¯é€šè¿‡EC2å®ä¾‹çš„å¼¹æ€§IPåœ°å€çš„IDçš„æ’å€¼è¡¨è¾¾å¼ï¼ŒTerraformèƒ½å¤Ÿæ¨æ–­çš„ä¾èµ–ï¼Œå¹¶ä¸”çŸ¥é“å®ƒå¿…é¡»å…ˆåˆ›å»ºå®ä¾‹
âœ  terraform  terraform apply

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  + aws_eip.ip
      id:                           <computed>
      allocation_id:                <computed>
      association_id:               <computed>
      domain:                       <computed>
      instance:                     "${aws_instance.example.id}"
      network_interface:            <computed>
      private_ip:                   <computed>
      public_ip:                    <computed>
      vpc:                          <computed>

  + aws_instance.example
      id:                           <computed>
      ami:                          "ami-b374d5a5"
      associate_public_ip_address:  <computed>
      availability_zone:            <computed>
      ebs_block_device.#:           <computed>
      ephemeral_block_device.#:     <computed>
      instance_state:               <computed>
      instance_type:                "t2.micro"
      ipv6_address_count:           <computed>
      ipv6_addresses.#:             <computed>
      key_name:                     <computed>
      network_interface.#:          <computed>
      network_interface_id:         <computed>
      placement_group:              <computed>
      primary_network_interface_id: <computed>
      private_dns:                  <computed>
      private_ip:                   <computed>
      public_dns:                   <computed>
      public_ip:                    <computed>
      root_block_device.#:          <computed>
      security_groups.#:            <computed>
      source_dest_check:            "true"
      subnet_id:                    <computed>
      tenancy:                      <computed>
      volume_tags.%:                <computed>
      vpc_security_group_ids.#:     <computed>


Plan: 2 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

aws_instance.example: Creating...
  ami:                          "" => "ami-b374d5a5"
  associate_public_ip_address:  "" => "<computed>"
  availability_zone:            "" => "<computed>"
  ebs_block_device.#:           "" => "<computed>"
  ephemeral_block_device.#:     "" => "<computed>"
  instance_state:               "" => "<computed>"
  instance_type:                "" => "t2.micro"
  ipv6_address_count:           "" => "<computed>"
  ipv6_addresses.#:             "" => "<computed>"
  key_name:                     "" => "<computed>"
  network_interface.#:          "" => "<computed>"
  network_interface_id:         "" => "<computed>"
  placement_group:              "" => "<computed>"
  primary_network_interface_id: "" => "<computed>"
  private_dns:                  "" => "<computed>"
  private_ip:                   "" => "<computed>"
  public_dns:                   "" => "<computed>"
  public_ip:                    "" => "<computed>"
  root_block_device.#:          "" => "<computed>"
  security_groups.#:            "" => "<computed>"
  source_dest_check:            "" => "true"
  subnet_id:                    "" => "<computed>"
  tenancy:                      "" => "<computed>"
  volume_tags.%:                "" => "<computed>"
  vpc_security_group_ids.#:     "" => "<computed>"
aws_instance.example: Still creating... (10s elapsed)
aws_instance.example: Still creating... (20s elapsed)
aws_instance.example: Creation complete after 30s (ID: i-0ad92d379a747bd10)
aws_eip.ip: Creating...
  allocation_id:     "" => "<computed>"
  association_id:    "" => "<computed>"
  domain:            "" => "<computed>"
  instance:          "" => "i-0ad92d379a747bd10"
  network_interface: "" => "<computed>"
  private_ip:        "" => "<computed>"
  public_ip:         "" => "<computed>"
  vpc:               "" => "<computed>"
aws_eip.ip: Creation complete after 5s (ID: eipalloc-9f60e9a9)

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</pre></div></div>

<h3>5.1.3 éšå¼å’Œæ˜¾å¼ä¾èµ–</h3>

<h4>éšå¼ä¾èµ–</h4>

<p>é€šè¿‡æ’å€¼è¡¨è¾¾å¼çš„éšå¼ä¾èµ–å…³ç³»æ˜¯å‘Terraformé€šçŸ¥è¿™äº›å…³ç³»çš„ä¸»è¦æ–¹å¼ï¼Œåº”å°½å¯èƒ½ä½¿ç”¨;</p>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¡¨è¾¾å¼${aws<em>instance.example.id}åˆ›å»ºäº†ä¸€ä¸ªéšå«çš„ä¾èµ–å…³ç³»çš„aws</em>instanceå‘½åexample;</p>

<h4>æ˜¾ç¤ºä¾èµ–</h4>

<p>æœ‰æ—¶æœ‰èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»å¯¹terraformæ˜¯ä¸å¯è§çš„ã€‚depends_onå‚æ•°æ˜¯ç”±ä»»ä½•èµ„æºæ¥çº³å’Œæ¥å—çš„èµ„æºåˆ—è¡¨åˆ›å»ºæ˜¾å¼ä¾èµ–çš„;</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># New resource for the S3 bucket our application will use.
resource "aws_s3_bucket" "example" {
  # NOTE: S3 bucket names must be unique across _all_ AWS accounts, so
  # this name must be changed before applying this example to avoid naming
  # conflicts.
  bucket = "terraform_getting_started_guide"
  acl    = "private"
}

# Change the aws_instance we declared earlier to now include "depends_on"
resource "aws_instance" "example" {
  ami           = "ami-2757f631"
  instance_type = "t2.micro"

  # Tells Terraform that this EC2 instance must be created only after the
  # S3 bucket has been created.
  depends_on = ["aws_s3_bucket.example"]
}</pre></div></div>

<h4>éä¾èµ–èµ„æº</h4>

<p>æˆ‘ä»¬å¯ä»¥ç»§ç»­é€šè¿‡æ·»åŠ å¦ä¸€ä¸ªEC2å®ä¾‹å»ºç«‹è¿™ä¸ªé…ç½®ï¼š</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>resource "aws_instance" "another" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"
}</pre></div></div>

<p>ç”±äºè¿™ç§æ–°æƒ…å†µä¸‹ä¸ä¾èµ–äºä»»ä½•å…¶ä»–èµ„æºï¼Œå®ƒå¯ä»¥å¹¶è¡Œåˆ›å»ºä¸å…¶ä»–èµ„æºã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œå°†Terraformæ‰§è¡Œæ“ä½œï¼ŒåŒæ—¶é™ä½åº”ç”¨æ›´æ”¹æ‰€èŠ±è´¹çš„æ€»æ—¶é—´ã€‚</p>

<p>è¿è¡Œ<code>terraform destroy</code>å°†ä¹‹å‰åˆ›å»ºçš„å®ä¾‹éƒ½å…³é—­</p>

<h1>6.åˆå§‹åŒ–é…ç½®</h1>

<p>æ­¤æ—¶,æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨shellæ¥æ‰§è¡Œä¸€äº›ç¯å¢ƒçš„åˆå§‹åŒ–</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>resource "aws_instance" "example" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"

  provisioner "local-exec" {
    command = "echo ${aws_instance.example.public_ip} > ip_address.txt"
  }
}</pre></div></div>

<p>å¯¹äºé…ç½®ç®¡ç†ï¼Œä½ åº”è¯¥ä½¿ç”¨Terraformé…ç½®æ¥è°ƒç”¨ä¸€ä¸ªçœŸæ­£çš„é…ç½®ç®¡ç†è§£å†³æ–¹æ¡ˆ, ä¾‹å¦‚: Packerçš„æ–¹å¼, é…ç½®ç®¡ç†å³ä»£ç ;</p>

<h1>7.è¾“å…¥å˜é‡</h1>

<h2>7.1 æ–°å»ºå˜é‡æ–‡ä»¶</h2>

<p>ä¸€ä¸ªvariables.tfæ–‡ä»¶ç”¨ä¸å­˜å‚¨é»˜è®¤å˜é‡</p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform cat variables.tf
variable "access_key" {
    default = "AK7KNZQQKNPSQ"
}
variable "secret_key" {
    default = "FGWDDkhUMIjjBZ59nOPEivW2e0tcwL"
}
variable "region" {
  default = "us-east-1"
}</pre></div></div>

<h2>7.2 ä½¿ç”¨å˜é‡æ–‡ä»¶å†…å˜é‡</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform cat example.tf
provider "aws" {
  access_key = "${var.access_key}"
  secret_key = "${var.secret_key}"
  region     = "${var.region}"
}

resource "aws_instance" "example" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"
}

resource "aws_eip" "ip" {
  instance = "${aws_instance.example.id}"
}

resource "aws_instance" "another" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"
}</pre></div></div>

<h1>8.è¾“å‡ºå˜é‡</h1>

<h2>8.1 å°†åœ¨applyæ—¶è¾“å‡ºå˜é‡çš„å€¼</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>output "ip" {
  value = "${aws_eip.ip.public_ip}"
}</pre></div></div>

<h2>8.2 è¾“å‡ºå˜é‡è¦åœ¨refreshåæ‰èƒ½ç”Ÿæ•ˆ</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>âœ  terraform vim example.tf
âœ  terraform terraform output ip
The state file either has no outputs defined, or all the defined
outputs are empty. Please define an output in your configuration
with the `output` keyword and run `terraform refresh` for it to
become available. If you are using interpolation, please verify
the interpolated value is not empty. You can use the
`terraform console` command to assist.
âœ  terraform terraform apply
aws_instance.another: Refreshing state... (ID: i-011bc4c0ce26999a0)
aws_instance.example: Refreshing state... (ID: i-0839fdf19b568365e)
aws_eip.ip: Refreshing state... (ID: eipalloc-6ec84058)

Apply complete! Resources: 0 added, 0 changed, 0 destroyed.

Outputs:

ip = 35.171.130.63
âœ  terraform terraform output ip
35.171.130.63</pre></div></div>

<h1>9.æ¨¡å—module</h1>

<ul>
<li>åˆ›å»ºä¸€ä¸ªconsulé›†ç¾¤</li>
</ul>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>provider "aws" {
  access_key = "AWS ACCESS KEY"
  secret_key = "AWS SECRET KEY"
  region     = "us-east-1"
}

module "consul" {
  source = "hashicorp/consul/aws"

  aws_region  = "us-east-1" # should match provider region
  num_servers = "3"
}</pre></div></div>

<h1>10.è¿œç¨‹åç«¯</h1>

<p>é»˜è®¤æˆ‘ä»¬ä½¿ç”¨æœ¬åœ°è¿›è¡ŒTerraformçš„çŠ¶æ€, ä½†æ˜¯åœ¨å›¢é˜Ÿåä½œçš„æ—¶å€™å®¹æ˜“å†²çª,æ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬éœ€è¦æŠŠçŠ¶æ€å­˜å‚¨åˆ°è¿œç¨‹åç«¯; æ¨èä½¿ç”¨<a href="https://www.consul.io/">ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°</a></p>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># 1.å°†terraformæŒ‡å‘consul: demo.consul.io
terraform {
  backend "consul" {
    address = "demo.consul.io"
    path    = "getting-started-RANDOMSTRING"
    lock    = false
  }
}
PS: æˆ‘ä»¬å¯ä»¥è‡ªå»ºConsulç„¶åæŠŠConsulæŒ‡å‘åˆ°è‡ªå»ºçš„åœ°å€</pre></div></div>

<p>ä¿®æ”¹è¿œç¨‹åç«¯åéœ€è¦ terraform init &amp;&amp; terraform apply</p>

<h1>11.é…ç½®å®ä¾‹</h1>

<p><a href="https://www.terraform.io/docs/providers/alicloud/index.html">ä¾›åº”å•†æ˜¯é˜¿é‡Œäº‘æ–‡æ¡£</a></p>

<p><a href="https://www.terraform.io/docs/providers/aws/index.html">ä¾›åº”å•†æ˜¯AWSæ–‡æ¡£</a></p>

    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://willdx.github.io">willdx.github.io</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-68394485-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: '177af99888a292531873',
        clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'HashiCorpå…¨å®¶æ¡¶-Terraform',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>