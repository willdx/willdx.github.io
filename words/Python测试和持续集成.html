<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> Python测试和持续集成 </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">主题选择</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">墨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">绿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">青</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">橘</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">波妞</div>
                                <div class="time">2017年2月21号</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">三三</div>
                                <div class="time">2017年4月10号</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        微信
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        支付宝
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>
            <a href="https://twitter.com/willdx">
                <button class="ui mini circular twitter icon button">
                  <i class="twitter icon"></i>
                </button>
            </a>
            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    🐱
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">人世一身霜雪, 归来仍是少年.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        主页
                    </a>
                    <a href="/tweet.html" class="item">
                        推特
                    </a>
                    <a href="/about.html" class="item">
                        关于我
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        联系
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>Python测试和持续集成</h1>
        <h4>Posted April 07, 2017</h4>
        <h1>0. 前言</h1>
<blockquote class="blockquote-normal">
                <p>什么是测试?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>测试指的是通过编写独立于业务代码的测试代码来验证程序中是否有错误.</pre></div></div>
<blockquote class="blockquote-normal">
                <p>为什么需要测试呢?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>1. 测试可以保证代码**在预想到的情况**下正常工作:  测试并不能100%的保证没有bug产生,
2. 确保代码的改动不会破坏现有的功能: 如果一个功能改动,导致测试不通过, 在测试阶段能够理清业务逻辑
3. 良好的测试要求业务代码模块化, 代码耦合度低:  很多公司的代码是没有测试的-"裸泳状态",  也就是说对代码上线单元测试, 往往伴随着架构改造</pre></div></div>
<blockquote class="blockquote-normal">
                <p>测试的好处?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>写测试的同时能更好的理解业务, 更容易进行调试, 从而避免大部分的 "不应该出现的BUG"</pre></div></div>
<blockquote class="blockquote-normal">
                <p>是不是所有的模块都要进行单元测试?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># 借鉴"Web开发实战"作者的看法
1. 软件质量不是测试出来的, 而是设计和维护出来的
2. 不需要对所有的模块添加单元测试, 但是核心业务一定要添加测试
3. 保持测试的独立性. 测试用例之间最好不要有相互依赖, 也不要前后次序的区分</pre></div></div>

<h1>1. unittest</h1>

<p><a href="http://docs.python.org/library/unittest.html">在标准库文档中单元测试</a></p>

<ul>
<li>unittest是Python标准库中用于单元测试的模块. 单元测试用来对最小可测试单元进行正确性检验.</li>
<li>写单元测试对于本来已经忙到爆炸的开发人员来说的确不容易, 但单元测试存在的意义就是<q>维护现有的功能</q></li>
<li>当业务代码配套有对应的测试代码, 每次更新迭代业务就会更省心了</li>
<li>如果你想要开源一个项目, 最好有写测试的习惯, 没有测试的代码是无法说服用户你的项目是可信赖的</li>
</ul>

<h2>1.1 一个单元测试例子</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: ut_case.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 17:13:34 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">class</span> <span class="nc">TestCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1.测试用例,需要继承unittest.TestCase</span>
<span class="sd">    2.一个测试用例可以包含多个测试方法, 每个方法以test_开头</span>
<span class="sd">    3.测试方法中用到的self.assertXXX方法是断言语句, </span>
<span class="sd">    单元测试都是使用这样的断言语句来判断测试是否通过的,</span>
<span class="sd">    如果断言为False, 会抛出AssertionError异常, 测试不通过</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        setUp 方法列出了测试前的准备工作, 常用来做一些初始化.</span>
<span class="sd">        此方法非必须</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;abcdaba&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;setUp starting ....&#39;</span>

    <span class="k">def</span> <span class="nf">test_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="c1"># 测试相等</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># 测试对象类型</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># 测试是否为序列的一员</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c1"># assertRaise可以准确的判断某个异常是否被抛出</span>
        <span class="c1"># 通常使用assertRaise调用一个函数,判断函数返回的异常</span>
        <span class="c1"># self.assertRaises(TypeError, test_function, args)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c1"># 更进一步, assertRaisesRegex() 方法, 它可同时测试异常的存在以及通过正则式匹配异常的字符串表示</span>
        <span class="c1"># self.assertRaisesRegex(TypeError, regular_expression, func, args)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s1">&#39;invalid literal .*&#39;</span><span class="p">,</span> <span class="n">parse_int</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tearDown 方法列出了测试完成后的收尾工作,用来销毁测试过程中产生的影响</span>
<span class="sd">        此方法非必须</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s1">&#39;tearDown starting ...&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unitest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<h2>1.2  对异常进行判断补充</h2>
<blockquote class="blockquote-normal">
                <p>assertRaises() 和 assertRaisesRegex() 也能被当做上下文管理器使用：</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># 待测试函数</span>
<span class="c1"># A simple function to illustrate</span>
<span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
<span class="c1"># 测试代码</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestConversion</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_bad_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s1">&#39;invalid literal .*&#39;</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">parse_int</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
</pre></div>
</div>
<h2>1.3 unittest.TestSuite 测试套件</h2>
<blockquote class="blockquote-normal">
                <p>unittest.TestSuite将一组测试用例作为一个测试对象</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: ut_suite.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 18:19:52 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">class</span> <span class="nc">TestCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;abcdaba&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;setUp starting ....&#39;</span>

    <span class="k">def</span> <span class="nf">runTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;tearDown starting ...&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">())</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span>
    <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>或者, 更精细的控制</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">ut_case</span> <span class="kn">import</span> <span class="n">TestCounter</span>

    <span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
        <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">(</span><span class="s1">&#39;test_bisics&#39;</span><span class="p">))</span>
        <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">(</span><span class="s1">&#39;test_update&#39;</span><span class="p">))</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div>
<h2>1.4 常用assertXXX</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>unittest提供了一组测试函数:
assertDictEqual、ass-ertEqual、assertTrue、assertFalse、assertGreater、 
assertGreaterEqual、assertIn、assertIs、assertIsIntance、assertIsNon、 
assertualIsNot、as-sertIsNotNone、assertItemsEqual、assertLess、
assertLessEqual、 asse-rtListEqual、assertMultiLineEqual、assertNotAlmostEqual、
assertNot-Equal、 assertTupleEqual、assertRaises、assertRaisesRegexp、assertReg-expMatches等</pre></div></div>

<h1>2. doctest</h1>

<p><a href="https://docs.python.org/2/library/doctest.html#module-doctest">doctest文档</a></p>
<blockquote class="blockquote-normal">
                <p>doctest 是一种非常直观的表述型的测试方法, 他通常查找代码文件里文档字符串中的交互式会话部分, 执行会话以验证代码工作是否正常<br/>给函数添加doctest是个好习惯</p></blockquote>
<h2>2.1 例子</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: doc_test.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 18:45:36 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">import_object</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Imports an object by Name</span>
<span class="sd">    &gt;&gt;&gt; import os.path</span>
<span class="sd">    &gt;&gt;&gt; import_object(&#39;os.path&#39;) is os.path</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; import_object(&#39;os.missing_module&#39;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ImportError: No module named misssing_module</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;No module named {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">doctest</span>
        <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
<h2>2.2 python -m 方式运行测试</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>python -m doctest doc_test.py
</pre></div>
</div>
<h1>3. py.test</h1>

<p><a href="http://pytest.org/latest/">py.test文档</a></p>
<blockquote class="blockquote-normal">
                <p>Python 标准库提供的测试模块功能相对单一, 所以在项目中通常会使用第三方的测试工具</p></blockquote>
<h2>3.1 优点</h2>

<ol>
<li>自动发现需要测试的模块和函数</li>
<li>支持运行由nose, unittest 等模块编写的测试用例</li>
<li>第三方插件支持丰富,并且自定义插件方便</li>
<li>容易与持续集成工具结合</li>
<li>可以细粒度的控制需要测试的测试用例</li>
<li>帮助我们定位到测试失败的位置,并告诉我们预期值和实际值</li>
<li>命令行功能非常丰富,可以测试整个目录/单文件/ 单文件下的某个测试用例/ 测试用例下的单个方法</li>
</ol>

<h2>3.2 Install</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>pip install pytest</pre></div></div>

<h2>3.3 简单例子</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: test_pytest.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 23:45:14 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># unittest 必须把测试用例放入TestCase类中, pytest 只要求函数或者类以test开头</span>


<span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># 创建测试环境, 可以用来做setUp 和 tearDown 的工作</span>
<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">setup_math</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">return</span> <span class="n">math</span>

<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">setup_function</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">teardown_function</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;teardown_function called.&quot;</span><span class="p">)</span>
    <span class="c1"># 这个内嵌的函数做tearDown的工作</span>
    <span class="n">request</span><span class="o">.</span><span class="n">addfinalizer</span><span class="p">(</span><span class="n">teardown_function</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;setup_function called.&#39;</span><span class="p">)</span>

<span class="c1"># Py.test不需要Unittest的那种模板， 只要函数或者类以test开头即可</span>
<span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">setup_function</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Test_Func called.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_setup_math</span><span class="p">(</span><span class="n">setup_math</span><span class="p">):</span>
    <span class="c1"># pytest不需要使用self.assertXXX这样的断言语法,而直接使用Python自带的assert</span>
    <span class="c1">#import time</span>
    <span class="c1">#time.sleep(4)</span>
    <span class="k">assert</span> <span class="n">setup_math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mf">8.0</span>

 
<span class="k">class</span> <span class="nc">TestClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="s1">&#39;hello&#39;</span>

    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_math</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">setup_math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mf">11.0</span>

<span class="k">def</span> <span class="nf">raise_exit</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_mytest</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">SystemExit</span><span class="p">):</span> <span class="c1">#用来测试抛出的异常</span>
        <span class="n">raise_exit</span><span class="p">()</span>


<span class="c1"># parametrize 可以用装饰器的方式集成多组测试用例</span>
<span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s1">&#39;test_input, expected&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1+3&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;2*4&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1 == 2&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span> 
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<h2>3.4 命令行</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># 1.运行测试文件</span>
python -m pytest test_pytest.py
<span class="c1"># 2.验证整个目录</span>
py.test .
<span class="c1"># 3.验证单个测试用例</span>
py.test ./test_pytest.py::test_mytest
<span class="c1"># 4.验证单个测试用例的单个方法::test_in</span>
py.test ./test_pytest.py::TestClass::test_in
</pre></div>
</div>
<h2>3.5 插件</h2>

<h3>3.5.1 pytest-random</h3>

<p><strong>让测试用例变成随机的</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-random
py.test --random
</pre></div>
</div>
<h3>3.5.2 pytest-xdist</h3>

<p><strong>让py.test支持分布式测试</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-xdist
<span class="c1"># 1.将测试放到多个CPU执行</span>
py.test -n <span class="m">3</span> test_pytest.py

<span class="c1"># 2.使用子进程进行并发测试</span>
py.test -d --tx <span class="m">3</span><span class="se">\*</span>popen//python<span class="o">=</span>python2.7 test_pytest.py
</pre></div>
</div>
<h3>3.5.3 pytest-instafail</h3>

<p><strong>一旦出现错误信息就立即返回, 不用等待所有的测试运行完成</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-instafail
py.test --instafail
</pre></div>
</div>
<h1>4. Nose</h1>

<p><a href="http://readthedocs.org/docs/nose/en/latest/">nose</a></p>
<blockquote class="blockquote-normal">
                <p>nose继承测试单元，能够使测试更加容易<br/>不过据说最近几年Nose处于维护状态, 书上的建议使用py.test 替换nose, 这点得我研究之后再下结论<br/>nose自动化测试发现并节省人工创建测试组件的麻烦。它也提供各种插件，例如xUnit兼容性测试输出，覆盖度报告和测试选择</p></blockquote>
<h2>4.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install nose
</pre></div>
</div>
<h2>4.2 使用</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="nb">cd</span> tests/
nosetests
</pre></div>
</div>
<h1>5. tox</h1>

<p><a href="http://testrun.org/tox/latest/">tox文档</a></p>
<blockquote class="blockquote-normal">
                <p>Tox是一个通用的Virtualenv 管理和测试命令行工具, 它的目标是提供最先进的自动化打包,测试和发布功能.<br/>Tox只能在终端使用命令行的方式做测试, 多用于本地环境的测试或者集成进Ci服务器<br/>Tox的最大特性是支持一次性验证多个版本的Python解释器下 的包的集成情况<br/>Tox简直是开源项目之必备良药啊</p></blockquote>
<h2>5.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install tox
</pre></div>
</div>
<h2>5.2 简单例子</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>➜  section3 git:<span class="o">(</span>master<span class="o">)</span> tree
.
├── requirements.txt <span class="c1">#依赖文件</span>
├── tests 
│   └── test_pytest.py <span class="c1">#测试用例</span>
└── tox.ini <span class="c1">#配置文件</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># Tox配置如下</span>
<span class="o">[</span>tox<span class="o">]</span>
<span class="nv">envlist</span> <span class="o">=</span> py<span class="o">{</span><span class="m">2</span>.7, <span class="m">3</span>.5<span class="o">}</span> <span class="c1"># 默认创建Python2.7和Python3.5这两个虚拟环境</span>
<span class="nv">skipsdist</span> <span class="o">=</span> True <span class="c1"># Tox会默认使用dist的方式构建包, 对于测试来说没有必要, 而且构建还会要求存在README,setup.py等文件,并且这些文件格式符合要求等, 本例跳过这个步骤</span>

<span class="o">[</span>testenv<span class="o">]</span> <span class="c1"># 默认的集成方案</span>
<span class="nv">deps</span> <span class="o">=</span> pytest <span class="c1"># 集成需要的依赖</span>
<span class="nv">commands</span> <span class="o">=</span> <span class="o">{</span>posargs:py.test<span class="o">}</span> <span class="c1"># 可以把调用的命令的参数通过posargs传给Tox来使用</span>

<span class="o">[</span>testenv:flake8<span class="o">]</span> <span class="c1"># 非默认的集成方案, 需要使用 tox -e flake8 才能调用</span>
<span class="nv">basepython</span><span class="o">=</span>python2.7
<span class="nv">deps</span><span class="o">=</span>
    pytest <span class="c1"># 依赖可以多行</span>
    -rrequirements.txt  <span class="c1"># 文件有相关的依赖 flake8</span>
<span class="nv">commands</span> <span class="o">=</span>  
    <span class="o">{</span>posargs:py.test<span class="o">}</span> <span class="c1"># 单元测试</span>
    flake8 .  <span class="c1"># 代码规范</span>
</pre></div>
</div>
<h2>5.3 命令行</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>tox <span class="c1">#默认方案, 创建py27,py35这2个虚拟环境, 目录默认在当前目录的.tox目录下, 使用的命令是pytest</span>
tox -e flake8 <span class="c1">#使用 testenv:flake8这个块中的集成方案</span>
tox -e py2.7 <span class="c1">#仅使用py27的集成方案, 和tox -e py27同义</span>
tox -- py.test -k test_eval <span class="c1">#只测试test_eval相关的3个测试,这就是{posargs:py.test}的作用</span>
tox -e py27 -- python <span class="c1">#进入python2.7的交互模式</span>
tox -e py27 -- python -m SimpleHttpServer <span class="c1">#可以支持多个参数</span>
</pre></div>
</div>
<h1>6. Unittest2</h1>

<p><a href="http://pypi.python.org/pypi/unittest2">unittest2</a></p>
<blockquote class="blockquote-normal">
                <p>Unittest2是Python2.7中unittest模型的补丁，它的API有所改善，并且对Python之前版本中已有的内容有了更好的说明</p><br/><p>如果使用Python2.6版本或者以下，需要使用pip安装unittest2</p></blockquote>
<h2>6.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install unittest2
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>将来你可能想要以unittest之名导入模块，目的是更容易地把代码移植到新的版本中</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest2</span> <span class="kn">as</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<h1>7.mock</h1>

<p><a href="https://docs.python.org/dev/library/unittest.mock">标准库中就有</a>
<a href="http://www.voidspace.org.uk/python/mock/">Mock文档</a></p>
<blockquote class="blockquote-normal">
                <p>mock是辅助单元测试的一个模块. 是在测试过程中对可能不稳定, 有副作用, 不容易获取的对象, 用一个虚拟的对象来创建以便完成测试的方法. 在Python中,这种类型的测试是通过Mock库完成的<br/> 个人理解: 就是将外部依赖都模拟为固定的值, 例如待测试函数中需要调用外部接口的场景, 我们就可以假设接口返回的消息的结构, 使用Mock模拟接口返回值, 根据设定值去测试函数功能;<br/>其他场景: 函数间的相互依赖; 连接数据库; </p></blockquote>
<h2>7.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>在Python2.x 中 mock是一个单独模块，需要单独安装

pip install  mock

在Python3.x中，mock已经被集成到了unittest单元测试框架中，所以，可以直接使用
</pre></div>
</div>
<h2>7.2  这个问题我思考了很久</h2>
<blockquote class="blockquote-normal">
                <p>把要测的东西都模拟掉了还测试什么呢？</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>但在，实际生产中的项目是非常复杂的，对其进行单元测试的时候，会遇到以下问题：

1. 接口的依赖
2. 外部接口调用
3. 测试环境非常复杂

　　单元测试应该只针对当前单元进行测试, 所有的内部或外部的依赖应该是稳定的, 已经在别处进行测试过的
使用mock 就可以对外部依赖组件实现进行模拟并且替换掉, 从而使得单元测试将焦点只放在当前的单元功能</pre></div></div>

<h2>7.3 简单场景</h2>

<p><strong>场景1: 假设现在一个单元测试依赖外部的API返回值</strong></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># 代码部分</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">api_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span>

<span class="k">def</span> <span class="nf">get_review_author</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">api_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">][</span><span class="s1">&#39;author&#39;</span><span class="p">]</span>
    
<span class="c1"># 测试用例</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">mock</span>
<span class="kn">import</span> <span class="nn">client</span>
<span class="k">class</span> <span class="nc">TestClient</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;dongwm&#39;</span><span class="p">}}</span>
        
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s1">&#39;client.api_request&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">test_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_request</span><span class="p">):</span>
        <span class="n">api_request</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_review_author</span><span class="p">(</span><span class="s1">&#39;http://www.xxx.com/123&#39;</span><span class="p">,</span> <span class="s1">&#39;dongwm&#39;</span><span class="p">))</span>
</pre></div>
</div>
<h1>8. 为自己的项目生成测试钩子</h1>
<blockquote class="blockquote-normal">
                <p>使用开源社区的第三方库的时候, 都会提供测试入口, 以确定改库在自己的服务器上是否能正常运行<br/>哈哈.... 文档待完善</p></blockquote>
<h1>9. 代码覆盖率统计</h1>

<p>代码覆盖率统计，要用到coverage, 暂时不知道具体怎么做</p>

<p><a href="http://www.epubit.com.cn/book/details/1835">Python高手之路测试部分</a>
<a href="https://book.douban.com/subject/26852057/">Python Web开发实战</a>
<a href="https://segmentfault.com/a/1190000002965620">Python Mock 入门</a></p>

    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">打赏 <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://willdx.github.io">willdx.github.io</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // 统计代码
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93231524-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: '177af99888a292531873',
        clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'Python测试和持续集成',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>