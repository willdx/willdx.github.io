<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> python webå¼€å‘æµ‹è¯•é©±åŠ¨å¼€å‘æ–¹æ³• </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>
            <a href="https://twitter.com/willdx">
                <button class="ui mini circular twitter icon button">
                  <i class="twitter icon"></i>
                </button>
            </a>
            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>python webå¼€å‘æµ‹è¯•é©±åŠ¨å¼€å‘æ–¹æ³•</h1>
        <h4>Posted April 07, 2017</h4>
        <h1>1. ä¸€ä¸ª selenium åŠŸèƒ½æµ‹è¯•ç®€å•å°ä¾‹å­</h1>

<h2>1.1 ç¯å¢ƒå‡†å¤‡</h2>

<ul>
<li>Firefox æµè§ˆå™¨</li>
<li>Python3 å¼€å‘ç¯å¢ƒ</li>
<li>å®‰è£… selenium</li>
</ul>

<h2>1.2 å®‰è£… selenium</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install selenium
vim functinal_tests.py
</pre></div>
</div>
<h2>1.3 ç¼–å†™ selenium æµ‹è¯•ç”¨ä¾‹</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*-coding:utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">selenium ç®€å•æµ‹è¯•</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="s1">&#39;Django&#39;</span> <span class="ow">in</span> <span class="n">browser</span><span class="o">.</span><span class="n">title</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>python3 functinal_tests.py
</pre></div>
</div>
<h2>1.4 æŠ¥é”™ä¸è§£å†³</h2>

<ul>
<li>æŠ¥é”™å†…å®¹å¦‚ä¸‹</li>
</ul>
<div class="code-wrapper"><div class="lang-label">log</div><div class="highlight"><pre><span></span>(accounting_server) âœ  accouting_project git:(master) âœ— python3 functinal_tests.py 
Traceback (most recent call last):
  File &quot;/Users/willdx/.virtualenvs/accounting_server/lib/python3.5/site-packages/selenium/webdriver/common/service.py&quot;, line 74, in start
    stdout=self.log_file, stderr=self.log_file)
  File &quot;/usr/local/Cellar/python3/3.5.0/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py&quot;, line 950, in __init__
    restore_signals, start_new_session)
  File &quot;/usr/local/Cellar/python3/3.5.0/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py&quot;, line 1540, in _execute_child
    raise child_exception_type(errno_num, err_msg)
FileNotFoundError: [Errno 2] No such file or directory: &#39;geckodriver&#39;

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;functinal_tests.py&quot;, line 8, in &lt;module&gt;
    browser = webdriver.Firefox()
  File &quot;/Users/willdx/.virtualenvs/accounting_server/lib/python3.5/site-packages/selenium/webdriver/firefox/webdriver.py&quot;, line 142, in __init__
    self.service.start()
  File &quot;/Users/willdx/.virtualenvs/accounting_server/lib/python3.5/site-packages/selenium/webdriver/common/service.py&quot;, line 81, in start
    os.path.basename(self.path), self.start_error_message)
selenium.common.exceptions.WebDriverException: Message: &#39;geckodriver&#39; executable needs to be in PATH.
</pre></div>
</div>
<ul>
<li>è§£å†³æ–¹æ³•:  å®‰è£…geckodriver</li>
</ul>

<p><a href="https://github.com/mozilla/geckodriver/releases">githubåœ°å€</a></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># ç”±äºæˆ‘æ˜¯åœ¨mac ä¸Šå®éªŒæ‰€ä»¥ç›´æ¥ brew å®‰è£…å³å¯</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">geckodriver</span>
</pre></div>
</div>
<ul>
<li>å†æ¬¡æ‰§è¡Œ: python3 functinal_tests.py</li>
</ul>

<p><p class="hassubimage"><img src="http://7xj7fg.com1.z0.glb.clouddn.com/2017-07-31-15010399692097.jpg"></p>
</p>

<p>å°†å¯åŠ¨ Firefox æµè§ˆå™¨, è¿æ¥å¤±è´¥æ˜¯ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å¯åŠ¨ webæœåŠ¡;</p>

<p>å¯åŠ¨Django webæœåŠ¡:  python manage.py runserver</p>

<ul>
<li>å†æ¬¡æµ‹è¯•: python3 functinal_tests.py</li>
</ul>

<p><p class="hassubimage"><img src="http://7xj7fg.com1.z0.glb.clouddn.com/2017-07-31-15010401553823.jpg"></p>
</p>

<p>æµ‹è¯•å¯åŠ¨äº† web æµè§ˆå™¨, æ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹éªŒè¯ç»“æœ:</p>

<p><p class="hassubimage"><img src="http://7xj7fg.com1.z0.glb.clouddn.com/2017-07-31-15010402045192.jpg"></p>
</p>

<p>æŠ›å‡ºäº†å¼‚å¸¸, è¯´æ˜æ¡ä»¶æ²¡æœ‰é€šè¿‡, ç”±äºæˆ‘çš„æµ‹è¯•ç¯å¢ƒæ˜¯æˆ‘è‡ªå·±çš„é¡¹ç›®, å¯åŠ¨çš„æœåŠ¡ä¸»é¡µ titleä¸åŒ…å« Django æ‰€ä»¥æµ‹è¯•å¤±è´¥;</p>

<p>åˆ°æ­¤ä¸ºæ­¢, æ˜¯ä¸€ä¸ª Selenium æµ‹è¯• Django çš„ç®€å•å°å®ä¾‹çš„å…¨éƒ¨è¿‡ç¨‹; åç»­æˆ‘ä»¬ä¼šç”¨ selenium åšæ›´å¤š,æ›´å…¨é¢çš„åŠŸèƒ½æµ‹è¯•;</p>
<blockquote class="blockquote-normal">
                <p>æœ¯è¯­1: TDD(Test-Driven-Development): æµ‹è¯•é©±åŠ¨å¼€å‘<br/>æœ¯è¯­2: åŠŸèƒ½æµ‹è¯•=éªŒæ”¶æµ‹è¯•(Acceptance)=ç«¯åˆ°ç«¯æµ‹è¯•(End<em>to</em>Endæµ‹è¯•), è¿™ç±»æµ‹è¯•æœ€é‡è¦çš„ä½œç”¨æ˜¯ä»å¤–éƒ¨å®è§‚çš„è§’åº¦è§‚å¯Ÿæ•´ä¸ªåº”ç”¨æ˜¯å¦‚ä½•è¿ä½œçš„; å¦ä¸€ä¸ªæœ¯è¯­: <code>é»‘ç®±æµ‹è¯•(Black Box Test)</code>, å› ä¸ºè¿™ç§æµ‹è¯•å¯¹æ‰€è¦æµ‹è¯•çš„ç³»ç»Ÿå†…éƒ¨ä¸€æ— æ‰€çŸ¥;</p></blockquote>
<p>åŠŸèƒ½æµ‹è¯•åº”è¯¥æœ‰ä¸€ä¸ªäººç±»å¯è¯», å®¹æ˜“ç†è§£çš„æ•…äº‹; è¿™é‡Œå°±å¼•ç”³å‡ºå¦ä¸€ä¸ªæ•æ·å¼€å‘çš„å­¦è¯´, <code>BDD(Behaviour Driven Development)ç”¨æˆ·æ•…äº‹</code>, æˆ‘ä»¬ç”¨è§„èŒƒçš„è¯­è¨€æè¿°æ•…äº‹, ç„¶åç”ŸæˆåŠŸèƒ½æµ‹è¯•ä»£ç çš„åŸºç¡€éƒ¨åˆ†, æˆ‘ä»¬å®Œæˆæ¯ä¸€ä¸ªç‚¹çš„å•å…ƒæµ‹è¯•, æœ€ç»ˆå½¢æˆä¸€ä¸ªå®Œå¤‡çš„åŠŸèƒ½æµ‹è¯•é›†åˆ; BDD é€šå¸¸å’Œ <code>DSL(Domain Specific Languagä¸€èµ·ä½¿ç”¨</code>); </p>

<p>å‡è®¾æˆ‘ä»¬ç®€å•çš„é‡‡ç”¨ç»™æµ‹è¯•ä»£ç åŠ æ³¨é‡Šçš„æ–¹å¼æè¿°ç”¨æˆ·æ•…äº‹, æ­¤æ—¶æµ‹è¯•ä»£ç å’Œç”¨æˆ·æ•…äº‹åœ¨åŒä¸€ä¸ªæ–‡ä»¶; æ— æ„ä¹‰çš„æ³¨é‡Š, æˆ–è€…æ³¨é‡Šæ›´æ–°ä¸åŠæ—¶ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜; æ›´å¥½çš„æ–¹å¼æ˜¯ BDD, ä½¿ç”¨ DSLæ–¹å¼æè¿°ç”¨æˆ·æ•…äº‹, è¿™æ ·æ•…äº‹å’Œæµ‹è¯•ä»£ç åˆ†å¼€; </p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># ä¸€ä¸ªä½¿ç”¨æ³¨é‡Šçš„ä¾‹å­</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

<span class="c1"># Will å¬è¯´æœ‰ä¸€ä¸ªå¾ˆé…·çš„ç½‘ç«™</span>
<span class="c1"># å¥¹å»çœ‹äº†åº”ç”¨çš„é¦–é¡µ</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">)</span>

<span class="c1"># å¥¹æ³¨æ„åˆ°ç½‘é¡µçš„æ ‡é¢˜åŒ…å«æœ‰&quot;ä¼—è´¢æ˜Ÿäº‘&quot;å­—æ ·</span>
<span class="c1"># assert &#39;ä¼—è´¢æ˜Ÿäº‘&#39; in browser.title</span>

<span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<h1>2. ä½¿ç”¨ Python æ ‡å‡†åº“ unitest æ¨¡å—ç¼–å†™å•å…ƒæµ‹è¯•</h1>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">VisitorTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•å‰æ‰§è¡Œ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="c1"># è®¾å®šéšå¼ç­‰å¾…3s, æ˜¯ç•™ç»™æµè§ˆå™¨å®Œå…¨åŠ è½½çš„æ—¶é—´</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•åæ‰§è¡Œ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_web_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•ä»£ç : æµ‹è¯•ä¸»é¡µä»£ç &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8000&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;ä¼—è´¢æ˜Ÿäº‘&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;Finish the test!&#39;</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºä¸€ä¸ªæµ‹è¯•å¤±è´¥çš„æ¶ˆæ¯, è¿™é‡Œè¿™æ˜¯ä¸ºäº†æé†’æµ‹è¯•ç»“æŸ</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">warnings</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># ç¦æ­¢æŠ›å‡º ResourceWarning å¼‚å¸¸</span>
</pre></div>
</div>
<p>æ³¨é‡Š:  <a href="http://code.google.com/p/selenium/issues/detail?id=5923">warnings åœ¨ Python2å’Œ Python3çš„ç”¨æ³•ä¸ä¸€æ ·</a></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># python3</span>
<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">warnings</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># python2</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
     <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>æµ‹è¯•ç»“æœ:</p>
<div class="code-wrapper"><div class="lang-label">log</div><div class="highlight"><pre><span></span>(accounting_server) âœ  accouting_project git:(master) âœ— python3 functinal_tests.py
======================================================================
FAIL: test_web_title (__main__.VisitorTest)
æµ‹è¯•ä»£ç : æµ‹è¯•ä¸»é¡µä»£ç 
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;functinal_tests.py&quot;, line 36, in test_web_title
    self.assertIn(&#39;ä¼—è´¢æ˜Ÿäº‘&#39;, self.browser.title)
AssertionError: &#39;ä¼—è´¢æ˜Ÿäº‘&#39; not found in &#39;&#39;

----------------------------------------------------------------------
Ran 1 test in 5.994s

FAILED (failures=1)
</pre></div>
</div>
<hr>

<p><strong>ä»ç¬¬ä¸‰ç« å¼€å§‹ä½¿ç”¨ä¹¦ä¸Šçš„ä»£ç è¿›è¡Œè¯•éªŒ</strong></p>

<h1>3. ç¬¬ä¸‰ç« : ç®€å•æµ‹è¯•é¦–é¡µ</h1>

<h2>3.1 Django ä¸­çš„å•å…ƒæµ‹è¯•å…¥å£</h2>

<ul>
<li>ä»£ç ç»“æ„</li>
</ul>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="err">âœ</span>  <span class="n">mycode</span> <span class="n">tree</span> <span class="o">-</span><span class="n">L</span> <span class="mi">2</span> <span class="n">book</span><span class="o">-</span><span class="n">example</span>
<span class="n">book</span><span class="o">-</span><span class="n">example</span>
<span class="err">â”œâ”€â”€</span> <span class="n">functional_tests</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”œâ”€â”€</span> <span class="n">lists</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="n">admin</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="n">apps</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="n">migrations</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="n">models</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”‚Â Â </span> <span class="err">â”œâ”€â”€</span> <span class="n">tests</span><span class="o">.</span><span class="n">py</span> <span class="c1"># æµ‹è¯•æ–‡ä»¶</span>
<span class="err">â”‚Â Â </span> <span class="err">â””â”€â”€</span> <span class="n">views</span><span class="o">.</span><span class="n">py</span>
<span class="err">â”œâ”€â”€</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span>
<span class="err">â””â”€â”€</span> <span class="n">superlists</span>
    <span class="err">â”œâ”€â”€</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="err">â”œâ”€â”€</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">pyc</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">settings</span><span class="o">.</span><span class="n">py</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">settings</span><span class="o">.</span><span class="n">pyc</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">urls</span><span class="o">.</span><span class="n">py</span>
    <span class="err">â””â”€â”€</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">py</span>

<span class="mi">3</span> <span class="n">directories</span><span class="p">,</span> <span class="mi">14</span> <span class="n">files</span>
</pre></div>
</div>
<ul>
<li>åœ¨ Django é¡¹ç›®ä¸­åˆ›å»º APP æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ tests.py</li>
</ul>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># å†™ä¸€ä¸ªå¿…å®šæ— æ³•é€šè¿‡çš„å•å…ƒæµ‹è¯•</span>
<span class="c1"># vim tests.py</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="c1"># Create your tests here.</span>

<span class="k">class</span> <span class="nc">SmokeTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_bad_maths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li>æ‰§è¡Œæµ‹è¯•</li>
</ul>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>

<span class="c1"># ç»“æœ</span>
<span class="n">Creating</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s1">&#39;default&#39;</span><span class="o">...</span>
<span class="n">System</span> <span class="n">check</span> <span class="n">identified</span> <span class="n">some</span> <span class="n">issues</span><span class="p">:</span>

<span class="n">System</span> <span class="n">check</span> <span class="n">identified</span> <span class="mi">1</span> <span class="n">issue</span> <span class="p">(</span><span class="mi">0</span> <span class="n">silenced</span><span class="p">)</span><span class="o">.</span>
<span class="n">F</span>
<span class="o">======================================================================</span>
<span class="n">FAIL</span><span class="p">:</span> <span class="n">test_bad_maths</span> <span class="p">(</span><span class="n">accouting_app</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">SmokeTest</span><span class="p">)</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/willdx/mycode/accouting_server/accouting_app/tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">8</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_bad_maths</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">3</span>

<span class="o">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="ow">in</span> <span class="mf">0.002</span><span class="n">s</span>

<span class="n">FAILED</span> <span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Destroying</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s1">&#39;default&#39;</span><span class="o">...</span>
</pre></div>
</div>
<h2>3.2 Django ä¸­çš„ MVC</h2>

<p>è¿™ä¸ªé—®é¢˜å›°æ‰°æœ‰æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†, Django æ˜¯ MTV è¿˜æ˜¯ MVC æ¨¡å‹?</p>

<p>å…¶å®, Django æ˜¯éµå®ˆç»å…¸çš„ MVC æ¶æ„çš„, åªæ˜¯å®ç°ä¸Šä¸å¤ªä¸€æ ·(å“ˆå“ˆ, è‡³å°‘ä¹¦ä¸Šæ˜¯è¿™ä¹ˆè¯´çš„), Django çš„è§†å›¾æ›´åƒæ˜¯æ§åˆ¶å™¨, æ¨¡æ¿ç›¸å½“äºè§†å›¾; </p>

<h3>3.2.1 åœ¨ Django ä¸­å†™ä¸€ä¸ªæµ‹è¯•é¦–é¡µçš„å•å…ƒæµ‹è¯•</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpRequest</span>
<span class="kn">from</span> <span class="nn">lists.views</span> <span class="kn">import</span> <span class="n">home_page</span>

<span class="k">class</span> <span class="nc">HomePageTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_root_url_resolves_to_home_page_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">home_page</span><span class="p">)</span>
</pre></div>
</div>
<p>æ­¤æ—¶, è¿è¡Œæµ‹è¯•ä¸ä¼šé€šè¿‡, åœ¨ TDDä¸­è¿™è¢«ç§°ä¸º<code>é¢„æœŸå¤±è´¥</code>; æˆ‘ä»¬å°½é‡æŒ‰ç…§ TDD çš„è§„åˆ™, <code>æ¯æ¬¡æ›´æ”¹å°½é‡å°‘çš„ä»£ç , æ¥è®©ä»£ç é€šè¿‡æµ‹è¯•</code>; ä½†æ˜¯åœ¨è¿™ç¯‡ BLog ä¸­å°±ä¸èµ˜è¿°äº†;</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># å†™ views.home_page å‡½æ•°</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;title&gt;To-Do lists&lt;/title&gt;&lt;/html&gt;&#39;</span><span class="p">)</span>

<span class="c1"># å†™å¯¹åº”çš„ url</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">lists</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="p">]</span>
<span class="c1"># å†æ¬¡æµ‹è¯•é€šè¿‡</span>
</pre></div>
</div>
<h3>3.2.2 ä¸ºè§†å›¾ç¼–å†™å•å…ƒæµ‹è¯•</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpRequest</span>

<span class="kn">from</span> <span class="nn">lists.views</span> <span class="kn">import</span> <span class="n">home_page</span>


<span class="k">class</span> <span class="nc">HomePageTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_root_url_resolves_to_home_page_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="n">found</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">home_page</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_home_page_returns_correct_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="n">request</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">()</span>
       <span class="n">response</span> <span class="o">=</span> <span class="n">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
       <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">))</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;To-Do lists&lt;/title&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">))</span>
</pre></div>
</div>
<h1>4. ç¬¬å››ç« : ä¸ºä»€ä¹ˆTDDä»¥åŠTDDçš„å‡ ä¸ªåœºæ™¯</h1>

<h2>4.1 ä¸ºä»€ä¹ˆéœ€è¦ TDD?</h2>

<ol>
<li>TDD å°±æ˜¯ä¸€ä¸ªå¥—è·¯, è¿™ä¸ªå¥—è·¯æ¥å¸®å¼€å‘è€…ç»†åŒ–æ¯ä¸€ä¸ªåŠŸèƒ½, å¹¶æµ‹è¯•ä¹‹, ç”¨äºä¿è¯ä»£ç ç¨³å®šæ€§;</li>
<li>TDD åº”è¯¥å°½é‡ç”¨ç®€å•çš„å‡½æ•°ç¼–å†™ç»†åŒ–çš„ç®€å•æµ‹è¯•;</li>
</ol>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">NewVisitorTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_can_start_a_list_and_retrieve_it_later</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Edith has heard about a cool new online to-do app. She goes</span>
        <span class="c1"># to check out its homepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">)</span>

        <span class="c1"># She notices the page title and header mention to-do lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="n">header_text</span><span class="p">)</span>

        <span class="c1"># She is invited to enter a to-do item straight away</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">inputbox</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Enter a to-do item&#39;</span>
        <span class="p">)</span>

        <span class="c1"># She types &quot;Buy peacock feathers&quot; into a text box (Edith&#39;s hobby</span>
        <span class="c1"># is tying fly-fishing lures)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># When she hits enter, the page updates, and now the page lists</span>
        <span class="c1"># &quot;1: Buy peacock feathers&quot; as an item in a to-do list table</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_list_table&#39;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_elements_by_tag_name</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;1: Buy peacock feathers&#39;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">),</span>
            <span class="s2">&quot;New to-do item did not appear in table&quot;</span>
        <span class="p">)</span>

        <span class="c1"># There is still a text box inviting her to add another item. She</span>
        <span class="c1"># enters &quot;Use peacock feathers to make a fly&quot; (Edith is very</span>
        <span class="c1"># methodical)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;Finish the test!&#39;</span><span class="p">)</span>

        <span class="c1"># The page updates again, and now shows both items on her list</span>

        <span class="c1"># Edith wonders whether the site will remember her list. Then she sees</span>
        <span class="c1"># that the site has generated a unique URL for her -- there is some</span>
        <span class="c1"># explanatory text to that effect.</span>

        <span class="c1"># She visits that URL - her to-do list is still there.</span>

        <span class="c1"># Satisfied, she goes back to sleep</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">warnings</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>æ³¨é‡Š: <code>any</code>
å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ ä¸º true çš„è¯è¿”å› True; å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸ºç©ºåˆ™è¿”å› False;
<a href="http://pycoders-weekly-chinese.readthedocs.io/en/latest/issue15/python-built-in-functions-are-awesome-use-them.html">Python å†…ç½®çš„é‚£äº›ç‰›é€¼é—ªäº®çš„å‡½æ•°</a> </p>

<h2>4.2 ä¸æµ‹è¯•å¸¸é‡è§„åˆ™</h2>

<ul>
<li>ä¸å¤šè¯´</li>
</ul>

<h2>4.3 å…³äºé‡æ„</h2>

<ol>
<li>é‡æ„çš„å‰ææ˜¯æœ‰æµ‹è¯•</li>
<li>é‡æ„æ—¶, ä¿®æ”¹ä»£ç æˆ–è€…æµ‹è¯•, ä½†ä¸è¦åœ¨ä¸€æ¬¡æäº¤ä¸­åŒæ—¶ä¿®æ”¹;</li>
</ol>

<h3>4.3.1 ä½¿ç”¨ Django æ¨¡æ¿é‡æ„ response</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim superlists/settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lists&#39;</span><span class="p">,</span> <span class="c1"># æ·»åŠ  APP</span>
<span class="p">]</span>

<span class="c1"># vim lists/views.py</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="c1"># Create your views here.</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">)</span>
    
<span class="c1"># vim lists/templates/home.html</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="n">lists</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Your</span> <span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_new_item&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter a to-do item&quot;</span> <span class="o">/&gt;</span>
       <span class="o">&lt;</span><span class="n">table</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_list_table&quot;</span><span class="o">&gt;</span>
       <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<h2>4.4 TDD æµç¨‹æ€»ç»“</h2>

<ul>
<li>TDD æµç¨‹: å…ˆå†™åŠŸèƒ½æµ‹è¯•(çœ‹ç€ä»–å¤±è´¥)-ç¼–å†™ä»£ç è®©æµ‹è¯•é€šè¿‡(è¿™ä¸€æ­¥æ˜¯å¤šä¸ªå•å…ƒæµ‹è¯•)-æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡åå›åˆ°åŠŸèƒ½æµ‹è¯•; å¦‚æœè¦æ›´æ”¹åŠŸèƒ½æµ‹è¯•çš„é€»è¾‘, é‚£ä¹ˆåŠŸèƒ½æµ‹è¯•,å•å…ƒæµ‹è¯•éƒ½è¦è·Ÿç€æ”¹, æ‰€ä»¥äº§å“ç»ç†æ”¹éœ€æ±‚çš„ä»£ä»·ç‰¹åˆ«å¤§;</li>
<li>åŠŸèƒ½æµ‹è¯•æ—¶åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œçš„æœ€ç»ˆè¯„åˆ¤, å•å…ƒæµ‹è¯•æ˜¯å¼€å‘è¿‡ç¨‹ä¸­çš„è¾…åŠ©å·¥å…·</li>
<li>åŠŸèƒ½æµ‹è¯•å¯ä»¥ç”±å¾ˆå¤šå•å…ƒæµ‹è¯•ç»„æˆ, å•å…ƒæµ‹è¯•éƒ¨åˆ†ä¹Ÿéµä» TDDæµç¨‹</li>
</ul>

<p><p class="hassubimage"><img src="http://7xj7fg.com1.z0.glb.clouddn.com/2017-07-31-15010595168051.jpg"></p>
</p>

<h1>5. ç¬¬5ç« : ä¿å­˜ç”¨æˆ·è¾“å…¥</h1>
<blockquote class="blockquote-normal">
                <p>TODO: äº†è§£CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ åŸç†)</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>æœ¯è¯­: é‡çº¢, å˜ç»¿, é‡æ„ å’Œ ä¸‰è§’æ³•

1. å…ˆå†™ä¸€ä¸ªä¼šå¤±è´¥çš„æµ‹è¯•(é‡çº¢)
2. ç¼–å†™å°½å¯èƒ½ç®€å•çš„ä»£ç è®©æµ‹è¯•é€šè¿‡, å³ä½¿æ˜¯ä¸šåŠ¡ä»£ç æ˜¯ä½œå¼Šä»£ç (å˜ç»¿)
3. é‡æ„, æ”¹è¿›ä»£ç , è®©å…¶æ›´åˆç†

ä¸‰è§’æ³•
ä¸“é—¨ä¸ºæŸäº›ç°æœ‰çš„ä»£ç ç¼–å†™æµ‹è¯•ç”¨ä¾‹, ä»¥æ­¤æ¨æ–­å‡ºæ™®éçš„å®ç°æ–¹å¼, ä½¿ä½œå¼Šä»£ç æ— æ³•é€šè¿‡æµ‹è¯•(ä¾‹å¦‚, å¤šå†™ä¸€ä¸ªæµ‹è¯•, æµ‹è¯•å¤šä¸ªè¾“å…¥æ“ä½œä¹‹åçš„çŠ¶æ€,è¿™æ ·é€šè¿‡å¸¸è§„çš„å†™å¸¸é‡é€šè¿‡æµ‹è¯•çš„æ–¹æ³•æ˜¯æ— æ³•é€šè¿‡æµ‹è¯•çš„), ç„¶åä¿ƒä½¿ä½ å»(åˆ é™¤ä½œå¼Šä»£ç )ç¼–å†™æ›´åˆç†çš„ä¸šåŠ¡ä»£ç ;


æœ¯è¯­: ä»£ç å¼‚å‘³, ä»£è¡¨ä¸€æ®µä»£ç éœ€è¦é‡å†™;

ç¼–ç¨‹åŸåˆ™: Don't repeat youself! (æ‹’ç»é‡å¤)
ç¼–ç¨‹åŸåˆ™: ä¸€ä¸ªæµ‹è¯•åªæµ‹è¯•ä¸€ä»¶äº‹æƒ…

æœ¯è¯­: 
(1)å›å½’
æ–°æ·»åŠ çš„ä»£ç ç ´åäº†åº”ç”¨åŸæœ¬å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„åŠŸèƒ½;

(2)æ„å¤–å¤±è´¥
æµ‹è¯•åœ¨æ„æ–™ä¹‹å¤–å¤±è´¥äº†, è¿™æ„å‘³ç€æµ‹è¯•ä¸­æœ‰é”™è¯¯, æˆ–è€…æµ‹è¯•å¸®æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå›å½’, å› æ­¤è¦åœ¨ä»£ç ä¸­ä¿®æ­£;</pre></div></div>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim functional_tests.py</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">NewVisitorTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">check_for_row_in_list_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_text</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_list_table&#39;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_elements_by_tag_name</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">row_text</span><span class="p">,</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">test_can_start_a_list_and_retrieve_it_later</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Edith has heard about a cool new online to-do app. She goes</span>
        <span class="c1"># to check out its homepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">)</span>

        <span class="c1"># She notices the page title and header mention to-do lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="n">header_text</span><span class="p">)</span>

        <span class="c1"># She is invited to enter a to-do item straight away</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">inputbox</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Enter a to-do item&#39;</span>
        <span class="p">)</span>

        <span class="c1"># She types &quot;Buy peacock feathers&quot; into a text box (Edith&#39;s hobby</span>
        <span class="c1"># is tying fly-fishing lures)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># When she hits enter, the page updates, and now the page lists</span>
        <span class="c1"># &quot;1: Buy peacock feathers&quot; as an item in a to-do list table</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># There is still a text box inviting her to add another item. She</span>
        <span class="c1"># enters &quot;Use peacock feathers to make a fly&quot; (Edith is very</span>
        <span class="c1"># methodical)</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># The page updates again, and now shows both items on her list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;2: Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># Edith wonders whether the site will remember her list. Then she sees</span>
        <span class="c1"># that the site has generated a unique URL for her -- there is some</span>
        <span class="c1"># explanatory text to that effect.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;Finish the test!&#39;</span><span class="p">)</span>

        <span class="c1"># She visits that URL - her to-do list is still there.</span>

        <span class="c1"># Satisfied, she goes back to sleep</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">warnings</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="sb">``</span><span class="err">`</span>
    
<span class="sb">``</span><span class="err">`</span><span class="n">python</span>
<span class="c1"># ä»£ç éƒ¨åˆ†</span>
<span class="c1"># URL</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">lists</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="err">$</span> <span class="n">views</span><span class="o">.</span><span class="n">py</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">lists.models</span> <span class="kn">import</span> <span class="n">Item</span>

<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;item_text&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">})</span>

<span class="c1"># model</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<h1>6. ç¬¬6ç« : å®Œæˆæœ€ç®€å¯ç”¨ç½‘ç«™</h1>

<ul>
<li><p>é—®é¢˜1: å¦‚ä½•éš”ç¦»æµ‹è¯•ç¯å¢ƒ?</p>

<p>æ¯æ¬¡æµ‹è¯•å®Œæˆå, è¿˜åŸæµ‹è¯•ç¯å¢ƒ; </p></li>
<li><p>é—®é¢˜2: å¦‚ä½•è¿˜åŸæµ‹è¯•ç¯å¢ƒå‘¢?</p>

<p>æ–¹æ³•1: åœ¨å•å…ƒæµ‹è¯• tearDown ä»£ç ä¸­å®Œæˆæµ‹è¯•ç¯å¢ƒçš„è¿˜åŸæ“ä½œ</p>

<p>æ–¹æ³•2: Django ä»1.4å¼€å§‹æä¾› LiveServerTestCase, ä»–ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ•°æ®åº“, å¹¶å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨, è®©åŠŸèƒ½æµ‹è¯•åœ¨å…¶ä¸­è¿è¡Œ; Django ä¼šæŸ¥æ‰¾æ‰€æœ‰åå­—ä»¥ testå¼€å¤´çš„æ–‡ä»¶;  æˆ‘ä»¬å¯ä»¥æŠŠæµ‹è¯•æ”¾åˆ°æ–‡ä»¶å¤¹ä¸­åˆ†ç±»ç®¡ç†, ä½†æ˜¯è¦æ±‚éœ€è¦æœ‰__ init__.pyæ–‡ä»¶, ä¹Ÿå°±æ˜¯è¯´æµ‹è¯•æ–‡ä»¶å¤¹å…¶å®å¯ä»¥çœ‹åšä¸€ä¸ª Python æ¨¡å—;</p>

<h2>(1)åŸºæœ¬åŠŸèƒ½</h2></li>
</ul>

<h3>6.1 ç¯å¢ƒå‡†å¤‡</h3>

<h3>6.2 é…ç½®è™šæ‹Ÿç¯å¢ƒ</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">mkvirtualenv</span> <span class="o">-</span><span class="n">p</span> <span class="sb">`which python3`</span> <span class="n">book</span><span class="o">-</span><span class="n">example</span>  <span class="o">--</span><span class="n">system</span><span class="o">-</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span>
</pre></div>
</div>
<h3>6.3 å®‰è£… Django</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">workon</span>  <span class="n">book</span><span class="o">-</span><span class="n">example</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">Django</span> <span class="n">selenium</span>
</pre></div>
</div>
<h2>6.4 åˆ›å»ºé¡¹ç›®</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">workon</span>  <span class="n">book</span><span class="o">-</span><span class="n">example</span>
<span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">startproject</span> <span class="n">superlists</span>
</pre></div>
</div>
<h3>6.5 åˆ›å»º app</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startapp</span> <span class="n">lists</span>

<span class="c1"># å°† APP åŠ å…¥ settings.py</span>
<span class="n">vim</span> <span class="n">superlists</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lists&#39;</span> <span class="c1"># add</span>
<span class="p">]</span>
</pre></div>
</div>
<h3>6.6 ç¼–å†™åŸºç¡€ä»£ç </h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># URL</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">lists</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="p">]</span>
<span class="c1"># views</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">lists.models</span> <span class="kn">import</span> <span class="n">Item</span>

<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
       <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;item_text&#39;</span><span class="p">])</span>
       <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">})</span>

<span class="c1"># models</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
<span class="c1"># vim lists/templates/home.html</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="n">lists</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Your</span> <span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item_text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_new_item&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter a to-do item&quot;</span> <span class="o">/&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="n">table</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_list_table&quot;</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">forloop</span><span class="o">.</span><span class="n">counter</span> <span class="p">}}:</span> <span class="p">{{</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<h3>6.7 å•å…ƒæµ‹è¯•</h3>
<blockquote class="blockquote-normal">
                <p>å•å…ƒæµ‹è¯•é€šè¿‡å‡½æ•°å’Œæ¥å£æ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚; </p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim lists/tests.py</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">lists.models</span> <span class="kn">import</span> <span class="n">Item</span>


<span class="k">class</span> <span class="nc">HomePageTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_uses_home_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•ä½¿ç”¨ä¸»é¡µæ¨¡æ¿&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_displays_all_list_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;åˆ›å»ºé¡¹ç›®å¹¶æµ‹è¯•è¿”å›&quot;&quot;&quot;</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;itemey 1&#39;</span><span class="p">)</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;itemey 2&#39;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;itemey 1&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;itemey 2&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">test_can_save_a_POST_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•ä¿å­˜ç”¨æˆ·è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_redirects_after_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯• POST è¯·æ±‚ä¹‹åçš„é‡å®šå‘, é€šè¿‡åˆ¤æ–­çŠ¶æ€å—&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">],</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_only_saves_items_when_necessary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•æ­£å¸¸è¯·æ±‚çš„æ—¶å€™ä¸ä¼šä¿å­˜æ•°æ®&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># **æ³¨æ„:**</span>

    <span class="err">æ¯ä¸€ä¸ªä»¥</span> <span class="n">test</span> <span class="err">å¼€å¤´çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ</span><span class="p">,</span> <span class="err">æµ‹è¯•æ“ä½œäº’ä¸å½±å“</span><span class="p">;</span> <span class="err">ä¾‹å¦‚</span><span class="p">,</span> <span class="err">ä¸Šé¢å‰</span><span class="mi">5</span><span class="err">ä¸ªæµ‹è¯•æœ‰ä¸€äº›å†™å…¥æ•°æ®çš„æ“ä½œ</span><span class="p">,</span> <span class="err">ä½†æ˜¯ç¬¬</span><span class="mi">6</span><span class="err">ä¸ªæµ‹è¯•</span><span class="p">:</span> <span class="n">test_only_saves_items_when_necessary</span> <span class="err">å»</span> <span class="n">Count</span> <span class="err">çš„æ—¶å€™ä¾æ—§ä¸º</span><span class="mi">0</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">ItemModelTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_saving_and_retrieving_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;æµ‹è¯•æ›´æ–°æ¨¡å‹å­—æ®µ&quot;&quot;&quot;</span>
        <span class="n">first_item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">()</span>
        <span class="n">first_item</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;The first (ever) list item&#39;</span>
        <span class="n">first_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">second_item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">()</span>
        <span class="n">second_item</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Item the second&#39;</span>
        <span class="n">second_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">saved_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_items</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">first_saved_item</span> <span class="o">=</span> <span class="n">saved_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">second_saved_item</span> <span class="o">=</span> <span class="n">saved_items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first_saved_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;The first (ever) list item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">second_saved_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;Item the second&#39;</span><span class="p">)</span>
</pre></div>
</div>
<h3>6.8 åˆ›å»ºåŠŸèƒ½æµ‹è¯•</h3>
<blockquote class="blockquote-normal">
                <p>åŠŸèƒ½æµ‹è¯•é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·ä»æµè§ˆå™¨è¯·æ±‚æ¥æµ‹è¯•;</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">functional_tests</span>
<span class="n">touch</span> <span class="n">functional_tests</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim functional_tests/tests.py</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">LiveServerTestCase</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">WebDriverException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">MAX_WAIT</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">class</span> <span class="nc">NewVisitorTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">wait_for_row_in_list_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_text</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_list_table&#39;</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_elements_by_tag_name</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">row_text</span><span class="p">,</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">MAX_WAIT</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_can_start_a_list_and_retrieve_it_later</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Edith has heard about a cool new online to-do app. She goes</span>
        <span class="c1"># to check out its homepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">)</span>

        <span class="c1"># She notices the page title and header mention to-do lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="n">header_text</span><span class="p">)</span>

        <span class="c1"># She is invited to enter a to-do item straight away</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">inputbox</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Enter a to-do item&#39;</span>
        <span class="p">)</span>

        <span class="c1"># She types &quot;Buy peacock feathers&quot; into a text box (Edith&#39;s hobby</span>
        <span class="c1"># is tying fly-fishing lures)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># When she hits enter, the page updates, and now the page lists</span>
        <span class="c1"># &quot;1: Buy peacock feathers&quot; as an item in a to-do list table</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># There is still a text box inviting her to add another item. She</span>
        <span class="c1"># enters &quot;Use peacock feathers to make a fly&quot; (Edith is very</span>
        <span class="c1"># methodical)</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>

        <span class="c1"># The page updates again, and now shows both items on her list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;2: Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># Edith wonders whether the site will remember her list. Then she sees</span>
        <span class="c1"># that the site has generated a unique URL for her -- there is some</span>
        <span class="c1"># explanatory text to that effect.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;Finish the test!&#39;</span><span class="p">)</span>

        <span class="c1"># She visits that URL - her to-do list is still there.</span>

        <span class="c1"># Satisfied, she goes back to sleep</span>
</pre></div>
</div>
<h3>6.9 è¿è¡Œæµ‹è¯•</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># é€šå¸¸æ‰€æœ‰å•å…ƒæµ‹è¯•éƒ½é€šè¿‡åæ‰ä¼šè¿è¡ŒåŠŸèƒ½æµ‹è¯•</span>
<span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="c1"># åŒæ—¶è¿è¡ŒåŠŸèƒ½æµ‹è¯•å’Œå•å…ƒæµ‹è¯•</span>
<span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="n">functional_tests</span> <span class="c1"># è¿è¡ŒåŠŸèƒ½æµ‹è¯•</span>
<span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="n">lists</span> <span class="c1"># è¿è¡Œå•å…ƒæµ‹è¯•</span>
</pre></div>
</div>
<h2>(2)ä½¿ç”¨ Django client ç®€åŒ–æµ‹è¯•æ­¥éª¤: æµ‹è¯•è§†å›¾, æ¨¡æ¿, URL</h2>

<h3>6.10 æ–°åŠŸèƒ½ä»£ç </h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># url</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">lists</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^new$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">new_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;new_list&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">view_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;view_list&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d+)/add_item$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_item</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_item&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># view</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">lists.models</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">new_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;item_text&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="o">=</span><span class="n">list_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;/lists/{list_.id}/&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">list_id</span><span class="p">):</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">list_id</span><span class="p">)</span>
    <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;item_text&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="o">=</span><span class="n">list_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;/lists/{list_.id}/&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">view_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">list_id</span><span class="p">):</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">list_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;list.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="n">list_</span><span class="p">})</span>

<span class="c1"># model</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>


<span class="c1"># template home</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="n">lists</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Start</span> <span class="n">a</span> <span class="n">new</span> <span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/lists/new&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item_text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_new_item&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter a to-do item&quot;</span> <span class="o">/&gt;</span>
      <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>

<span class="c1"># template list</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="n">lists</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Your</span> <span class="n">To</span><span class="o">-</span><span class="n">Do</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/lists/{{ list.id }}/add_item&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item_text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_new_item&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter a to-do item&quot;</span> <span class="o">/&gt;</span>
      <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">table</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;id_list_table&quot;</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="o">.</span><span class="n">item_set</span><span class="o">.</span><span class="n">all</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">forloop</span><span class="o">.</span><span class="n">counter</span> <span class="p">}}:</span> <span class="p">{{</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<h3>6.11 æ–°åŠŸèƒ½å•å…ƒæµ‹è¯•</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">lists.models</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">List</span>


<span class="k">class</span> <span class="nc">HomePageTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_uses_home_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">NewListTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_can_save_a_POST_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/lists/new&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_redirects_after_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/lists/new&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new list item&#39;</span><span class="p">})</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;/lists/{new_list.id}/&#39;</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">NewItemTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_can_save_a_POST_request_to_an_existing_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">correct_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;/lists/{correct_list.id}/add_item&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new item for an existing list&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;A new item for an existing list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_item</span><span class="o">.</span><span class="n">list</span><span class="p">,</span> <span class="n">correct_list</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_redirects_to_list_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">correct_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;/lists/{correct_list.id}/add_item&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_text&#39;</span><span class="p">:</span> <span class="s1">&#39;A new item for an existing list&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;/lists/{correct_list.id}/&#39;</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">ListViewTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_uses_list_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;/lists/{list_.id}/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;list.html&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_passes_correct_list_to_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">correct_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;/lists/{correct_list.id}/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">],</span> <span class="n">correct_list</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_displays_only_items_for_that_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">correct_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;itemey 1&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="n">correct_list</span><span class="p">)</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;itemey 2&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="n">correct_list</span><span class="p">)</span>
        <span class="n">other_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;other list item 1&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="n">other_list</span><span class="p">)</span>
        <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;other list item 2&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="n">other_list</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;/lists/{correct_list.id}/&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;itemey 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;itemey 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;other list item 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;other list item 2&#39;</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">ListAndItemModelsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_saving_and_retrieving_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span>
        <span class="n">list_</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">first_item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">()</span>
        <span class="n">first_item</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;The first (ever) list item&#39;</span>
        <span class="n">first_item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">list_</span>
        <span class="n">first_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">second_item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">()</span>
        <span class="n">second_item</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Item the second&#39;</span>
        <span class="n">second_item</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">list_</span>
        <span class="n">second_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">saved_list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_list</span><span class="p">,</span> <span class="n">list_</span><span class="p">)</span>

        <span class="n">saved_items</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_items</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">first_saved_item</span> <span class="o">=</span> <span class="n">saved_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">second_saved_item</span> <span class="o">=</span> <span class="n">saved_items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first_saved_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;The first (ever) list item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first_saved_item</span><span class="o">.</span><span class="n">list</span><span class="p">,</span> <span class="n">list_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">second_saved_item</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;Item the second&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">second_saved_item</span><span class="o">.</span><span class="n">list</span><span class="p">,</span> <span class="n">list_</span><span class="p">)</span>
</pre></div>
</div>
<h3>6.12 æ–°åŠŸèƒ½åŠŸèƒ½æµ‹è¯•</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">LiveServerTestCase</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">WebDriverException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">MAX_WAIT</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">class</span> <span class="nc">NewVisitorTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">wait_for_row_in_list_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_text</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_list_table&#39;</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_elements_by_tag_name</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">row_text</span><span class="p">,</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">MAX_WAIT</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_can_start_a_list_for_one_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Edith has heard about a cool new online to-do app. She goes</span>
        <span class="c1"># to check out its homepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">)</span>

        <span class="c1"># She notices the page title and header mention to-do lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;To-Do&#39;</span><span class="p">,</span> <span class="n">header_text</span><span class="p">)</span>

        <span class="c1"># She is invited to enter a to-do item straight away</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">inputbox</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Enter a to-do item&#39;</span>
        <span class="p">)</span>

        <span class="c1"># She types &quot;Buy peacock feathers&quot; into a text box (Edith&#39;s hobby</span>
        <span class="c1"># is tying fly-fishing lures)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># When she hits enter, the page updates, and now the page lists</span>
        <span class="c1"># &quot;1: Buy peacock feathers&quot; as an item in a to-do list table</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># There is still a text box inviting her to add another item. She</span>
        <span class="c1"># enters &quot;Use peacock feathers to make a fly&quot; (Edith is very</span>
        <span class="c1"># methodical)</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>

        <span class="c1"># The page updates again, and now shows both items on her list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;2: Use peacock feathers to make a fly&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># Satisfied, she goes back to sleep</span>


    <span class="k">def</span> <span class="nf">test_multiple_users_can_start_lists_at_different_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Edith starts a new to-do list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">)</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy peacock feathers&#39;</span><span class="p">)</span>

        <span class="c1"># She notices that her list has a unique URL</span>
        <span class="n">edith_list_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">edith_list_url</span><span class="p">,</span> <span class="s1">&#39;/lists/.+&#39;</span><span class="p">)</span>

        <span class="c1"># Now a new user, Francis, comes along to the site.</span>

        <span class="c1">## We use a new browser session to make sure that no information</span>
        <span class="c1">## of Edith&#39;s is coming through from cookies etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>

        <span class="c1"># Francis visits the home page.  There is no sign of Edith&#39;s</span>
        <span class="c1"># list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">)</span>
        <span class="n">page_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">,</span> <span class="n">page_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;make a fly&#39;</span><span class="p">,</span> <span class="n">page_text</span><span class="p">)</span>

        <span class="c1"># Francis starts a new list by entering a new item. He</span>
        <span class="c1"># is less interesting than Edith...</span>
        <span class="n">inputbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;id_new_item&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Buy milk&#39;</span><span class="p">)</span>
        <span class="n">inputbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_row_in_list_table</span><span class="p">(</span><span class="s1">&#39;1: Buy milk&#39;</span><span class="p">)</span>

        <span class="c1"># Francis gets his own unique URL</span>
        <span class="n">francis_list_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">current_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">francis_list_url</span><span class="p">,</span> <span class="s1">&#39;/lists/.+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">francis_list_url</span><span class="p">,</span> <span class="n">edith_list_url</span><span class="p">)</span>

        <span class="c1"># Again, there is no trace of Edith&#39;s list</span>
        <span class="n">page_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;Buy peacock feathers&#39;</span><span class="p">,</span> <span class="n">page_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Buy milk&#39;</span><span class="p">,</span> <span class="n">page_text</span><span class="p">)</span>

        <span class="c1"># Satisfied, they both go back to sleep</span>
</pre></div>
</div>
<p>http://7xj7fg.com1.z0.glb.clouddn.com/15146512145459.jpg</p>

    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://willdx.github.io">willdx.github.io</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93231524-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: '177af99888a292531873',
        clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'python webå¼€å‘æµ‹è¯•é©±åŠ¨å¼€å‘æ–¹æ³•',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>