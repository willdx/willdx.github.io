<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> Pythonæµ‹è¯•å’ŒæŒç»­é›†æˆ </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>
            <a href="https://twitter.com/willdx">
                <button class="ui mini circular twitter icon button">
                  <i class="twitter icon"></i>
                </button>
            </a>
            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>Pythonæµ‹è¯•å’ŒæŒç»­é›†æˆ</h1>
        <h4>Posted April 07, 2017</h4>
        <h1>0. å‰è¨€</h1>
<blockquote class="blockquote-normal">
                <p>ä»€ä¹ˆæ˜¯æµ‹è¯•?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>æµ‹è¯•æŒ‡çš„æ˜¯é€šè¿‡ç¼–å†™ç‹¬ç«‹äºä¸šåŠ¡ä»£ç çš„æµ‹è¯•ä»£ç æ¥éªŒè¯ç¨‹åºä¸­æ˜¯å¦æœ‰é”™è¯¯.</pre></div></div>
<blockquote class="blockquote-normal">
                <p>ä¸ºä»€ä¹ˆéœ€è¦æµ‹è¯•å‘¢?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>1. æµ‹è¯•å¯ä»¥ä¿è¯ä»£ç **åœ¨é¢„æƒ³åˆ°çš„æƒ…å†µ**ä¸‹æ­£å¸¸å·¥ä½œ:  æµ‹è¯•å¹¶ä¸èƒ½100%çš„ä¿è¯æ²¡æœ‰bugäº§ç”Ÿ,
2. ç¡®ä¿ä»£ç çš„æ”¹åŠ¨ä¸ä¼šç ´åç°æœ‰çš„åŠŸèƒ½: å¦‚æœä¸€ä¸ªåŠŸèƒ½æ”¹åŠ¨,å¯¼è‡´æµ‹è¯•ä¸é€šè¿‡, åœ¨æµ‹è¯•é˜¶æ®µèƒ½å¤Ÿç†æ¸…ä¸šåŠ¡é€»è¾‘
3. è‰¯å¥½çš„æµ‹è¯•è¦æ±‚ä¸šåŠ¡ä»£ç æ¨¡å—åŒ–, ä»£ç è€¦åˆåº¦ä½:  å¾ˆå¤šå…¬å¸çš„ä»£ç æ˜¯æ²¡æœ‰æµ‹è¯•çš„-"è£¸æ³³çŠ¶æ€",  ä¹Ÿå°±æ˜¯è¯´å¯¹ä»£ç ä¸Šçº¿å•å…ƒæµ‹è¯•, å¾€å¾€ä¼´éšç€æ¶æ„æ”¹é€ </pre></div></div>
<blockquote class="blockquote-normal">
                <p>æµ‹è¯•çš„å¥½å¤„?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>å†™æµ‹è¯•çš„åŒæ—¶èƒ½æ›´å¥½çš„ç†è§£ä¸šåŠ¡, æ›´å®¹æ˜“è¿›è¡Œè°ƒè¯•, ä»è€Œé¿å…å¤§éƒ¨åˆ†çš„ "ä¸åº”è¯¥å‡ºç°çš„BUG"</pre></div></div>
<blockquote class="blockquote-normal">
                <p>æ˜¯ä¸æ˜¯æ‰€æœ‰çš„æ¨¡å—éƒ½è¦è¿›è¡Œå•å…ƒæµ‹è¯•?</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># å€Ÿé‰´"Webå¼€å‘å®æˆ˜"ä½œè€…çš„çœ‹æ³•
1. è½¯ä»¶è´¨é‡ä¸æ˜¯æµ‹è¯•å‡ºæ¥çš„, è€Œæ˜¯è®¾è®¡å’Œç»´æŠ¤å‡ºæ¥çš„
2. ä¸éœ€è¦å¯¹æ‰€æœ‰çš„æ¨¡å—æ·»åŠ å•å…ƒæµ‹è¯•, ä½†æ˜¯æ ¸å¿ƒä¸šåŠ¡ä¸€å®šè¦æ·»åŠ æµ‹è¯•
3. ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§. æµ‹è¯•ç”¨ä¾‹ä¹‹é—´æœ€å¥½ä¸è¦æœ‰ç›¸äº’ä¾èµ–, ä¹Ÿä¸è¦å‰åæ¬¡åºçš„åŒºåˆ†</pre></div></div>

<h1>1. unittest</h1>

<p><a href="http://docs.python.org/library/unittest.html">åœ¨æ ‡å‡†åº“æ–‡æ¡£ä¸­å•å…ƒæµ‹è¯•</a></p>

<ul>
<li>unittestæ˜¯Pythonæ ‡å‡†åº“ä¸­ç”¨äºå•å…ƒæµ‹è¯•çš„æ¨¡å—. å•å…ƒæµ‹è¯•ç”¨æ¥å¯¹æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ­£ç¡®æ€§æ£€éªŒ.</li>
<li>å†™å•å…ƒæµ‹è¯•å¯¹äºæœ¬æ¥å·²ç»å¿™åˆ°çˆ†ç‚¸çš„å¼€å‘äººå‘˜æ¥è¯´çš„ç¡®ä¸å®¹æ˜“, ä½†å•å…ƒæµ‹è¯•å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯<q>ç»´æŠ¤ç°æœ‰çš„åŠŸèƒ½</q></li>
<li>å½“ä¸šåŠ¡ä»£ç é…å¥—æœ‰å¯¹åº”çš„æµ‹è¯•ä»£ç , æ¯æ¬¡æ›´æ–°è¿­ä»£ä¸šåŠ¡å°±ä¼šæ›´çœå¿ƒäº†</li>
<li>å¦‚æœä½ æƒ³è¦å¼€æºä¸€ä¸ªé¡¹ç›®, æœ€å¥½æœ‰å†™æµ‹è¯•çš„ä¹ æƒ¯, æ²¡æœ‰æµ‹è¯•çš„ä»£ç æ˜¯æ— æ³•è¯´æœç”¨æˆ·ä½ çš„é¡¹ç›®æ˜¯å¯ä¿¡èµ–çš„</li>
</ul>

<h2>1.1 ä¸€ä¸ªå•å…ƒæµ‹è¯•ä¾‹å­</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: ut_case.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 17:13:34 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">class</span> <span class="nc">TestCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1.æµ‹è¯•ç”¨ä¾‹,éœ€è¦ç»§æ‰¿unittest.TestCase</span>
<span class="sd">    2.ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¯ä»¥åŒ…å«å¤šä¸ªæµ‹è¯•æ–¹æ³•, æ¯ä¸ªæ–¹æ³•ä»¥test_å¼€å¤´</span>
<span class="sd">    3.æµ‹è¯•æ–¹æ³•ä¸­ç”¨åˆ°çš„self.assertXXXæ–¹æ³•æ˜¯æ–­è¨€è¯­å¥, </span>
<span class="sd">    å•å…ƒæµ‹è¯•éƒ½æ˜¯ä½¿ç”¨è¿™æ ·çš„æ–­è¨€è¯­å¥æ¥åˆ¤æ–­æµ‹è¯•æ˜¯å¦é€šè¿‡çš„,</span>
<span class="sd">    å¦‚æœæ–­è¨€ä¸ºFalse, ä¼šæŠ›å‡ºAssertionErrorå¼‚å¸¸, æµ‹è¯•ä¸é€šè¿‡</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        setUp æ–¹æ³•åˆ—å‡ºäº†æµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ, å¸¸ç”¨æ¥åšä¸€äº›åˆå§‹åŒ–.</span>
<span class="sd">        æ­¤æ–¹æ³•éå¿…é¡»</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;abcdaba&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;setUp starting ....&#39;</span>

    <span class="k">def</span> <span class="nf">test_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="c1"># æµ‹è¯•ç›¸ç­‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># æµ‹è¯•å¯¹è±¡ç±»å‹</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># æµ‹è¯•æ˜¯å¦ä¸ºåºåˆ—çš„ä¸€å‘˜</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c1"># assertRaiseå¯ä»¥å‡†ç¡®çš„åˆ¤æ–­æŸä¸ªå¼‚å¸¸æ˜¯å¦è¢«æŠ›å‡º</span>
        <span class="c1"># é€šå¸¸ä½¿ç”¨assertRaiseè°ƒç”¨ä¸€ä¸ªå‡½æ•°,åˆ¤æ–­å‡½æ•°è¿”å›çš„å¼‚å¸¸</span>
        <span class="c1"># self.assertRaises(TypeError, test_function, args)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c1"># æ›´è¿›ä¸€æ­¥, assertRaisesRegex() æ–¹æ³•, å®ƒå¯åŒæ—¶æµ‹è¯•å¼‚å¸¸çš„å­˜åœ¨ä»¥åŠé€šè¿‡æ­£åˆ™å¼åŒ¹é…å¼‚å¸¸çš„å­—ç¬¦ä¸²è¡¨ç¤º</span>
        <span class="c1"># self.assertRaisesRegex(TypeError, regular_expression, func, args)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s1">&#39;invalid literal .*&#39;</span><span class="p">,</span> <span class="n">parse_int</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tearDown æ–¹æ³•åˆ—å‡ºäº†æµ‹è¯•å®Œæˆåçš„æ”¶å°¾å·¥ä½œ,ç”¨æ¥é”€æ¯æµ‹è¯•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å½±å“</span>
<span class="sd">        æ­¤æ–¹æ³•éå¿…é¡»</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s1">&#39;tearDown starting ...&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unitest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<h2>1.2  å¯¹å¼‚å¸¸è¿›è¡Œåˆ¤æ–­è¡¥å……</h2>
<blockquote class="blockquote-normal">
                <p>assertRaises() å’Œ assertRaisesRegex() ä¹Ÿèƒ½è¢«å½“åšä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨ï¼š</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># å¾…æµ‹è¯•å‡½æ•°</span>
<span class="c1"># A simple function to illustrate</span>
<span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
<span class="c1"># æµ‹è¯•ä»£ç </span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestConversion</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_bad_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s1">&#39;invalid literal .*&#39;</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">parse_int</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
</pre></div>
</div>
<h2>1.3 unittest.TestSuite æµ‹è¯•å¥—ä»¶</h2>
<blockquote class="blockquote-normal">
                <p>unittest.TestSuiteå°†ä¸€ç»„æµ‹è¯•ç”¨ä¾‹ä½œä¸ºä¸€ä¸ªæµ‹è¯•å¯¹è±¡</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: ut_suite.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 18:19:52 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">class</span> <span class="nc">TestCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;abcdaba&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;setUp starting ....&#39;</span>

    <span class="k">def</span> <span class="nf">runTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;tearDown starting ...&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">())</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span>
    <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>æˆ–è€…, æ›´ç²¾ç»†çš„æ§åˆ¶</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">ut_case</span> <span class="kn">import</span> <span class="n">TestCounter</span>

    <span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
        <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">(</span><span class="s1">&#39;test_bisics&#39;</span><span class="p">))</span>
        <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestCounter</span><span class="p">(</span><span class="s1">&#39;test_update&#39;</span><span class="p">))</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div>
<h2>1.4 å¸¸ç”¨assertXXX</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>unittestæä¾›äº†ä¸€ç»„æµ‹è¯•å‡½æ•°:
assertDictEqualã€ass-ertEqualã€assertTrueã€assertFalseã€assertGreaterã€ 
assertGreaterEqualã€assertInã€assertIsã€assertIsIntanceã€assertIsNonã€ 
assertualIsNotã€as-sertIsNotNoneã€assertItemsEqualã€assertLessã€
assertLessEqualã€ asse-rtListEqualã€assertMultiLineEqualã€assertNotAlmostEqualã€
assertNot-Equalã€ assertTupleEqualã€assertRaisesã€assertRaisesRegexpã€assertReg-expMatchesç­‰</pre></div></div>

<h1>2. doctest</h1>

<p><a href="https://docs.python.org/2/library/doctest.html#module-doctest">doctestæ–‡æ¡£</a></p>
<blockquote class="blockquote-normal">
                <p>doctest æ˜¯ä¸€ç§éå¸¸ç›´è§‚çš„è¡¨è¿°å‹çš„æµ‹è¯•æ–¹æ³•, ä»–é€šå¸¸æŸ¥æ‰¾ä»£ç æ–‡ä»¶é‡Œæ–‡æ¡£å­—ç¬¦ä¸²ä¸­çš„äº¤äº’å¼ä¼šè¯éƒ¨åˆ†, æ‰§è¡Œä¼šè¯ä»¥éªŒè¯ä»£ç å·¥ä½œæ˜¯å¦æ­£å¸¸<br/>ç»™å‡½æ•°æ·»åŠ doctestæ˜¯ä¸ªå¥½ä¹ æƒ¯</p></blockquote>
<h2>2.1 ä¾‹å­</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: doc_test.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 18:45:36 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">import_object</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Imports an object by Name</span>
<span class="sd">    &gt;&gt;&gt; import os.path</span>
<span class="sd">    &gt;&gt;&gt; import_object(&#39;os.path&#39;) is os.path</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; import_object(&#39;os.missing_module&#39;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ImportError: No module named misssing_module</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;No module named {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">doctest</span>
        <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
<h2>2.2 python -m æ–¹å¼è¿è¡Œæµ‹è¯•</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>python -m doctest doc_test.py
</pre></div>
</div>
<h1>3. py.test</h1>

<p><a href="http://pytest.org/latest/">py.testæ–‡æ¡£</a></p>
<blockquote class="blockquote-normal">
                <p>Python æ ‡å‡†åº“æä¾›çš„æµ‹è¯•æ¨¡å—åŠŸèƒ½ç›¸å¯¹å•ä¸€, æ‰€ä»¥åœ¨é¡¹ç›®ä¸­é€šå¸¸ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æµ‹è¯•å·¥å…·</p></blockquote>
<h2>3.1 ä¼˜ç‚¹</h2>

<ol>
<li>è‡ªåŠ¨å‘ç°éœ€è¦æµ‹è¯•çš„æ¨¡å—å’Œå‡½æ•°</li>
<li>æ”¯æŒè¿è¡Œç”±nose, unittest ç­‰æ¨¡å—ç¼–å†™çš„æµ‹è¯•ç”¨ä¾‹</li>
<li>ç¬¬ä¸‰æ–¹æ’ä»¶æ”¯æŒä¸°å¯Œ,å¹¶ä¸”è‡ªå®šä¹‰æ’ä»¶æ–¹ä¾¿</li>
<li>å®¹æ˜“ä¸æŒç»­é›†æˆå·¥å…·ç»“åˆ</li>
<li>å¯ä»¥ç»†ç²’åº¦çš„æ§åˆ¶éœ€è¦æµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹</li>
<li>å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°æµ‹è¯•å¤±è´¥çš„ä½ç½®,å¹¶å‘Šè¯‰æˆ‘ä»¬é¢„æœŸå€¼å’Œå®é™…å€¼</li>
<li>å‘½ä»¤è¡ŒåŠŸèƒ½éå¸¸ä¸°å¯Œ,å¯ä»¥æµ‹è¯•æ•´ä¸ªç›®å½•/å•æ–‡ä»¶/ å•æ–‡ä»¶ä¸‹çš„æŸä¸ªæµ‹è¯•ç”¨ä¾‹/ æµ‹è¯•ç”¨ä¾‹ä¸‹çš„å•ä¸ªæ–¹æ³•</li>
</ol>

<h2>3.2 Install</h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>pip install pytest</pre></div></div>

<h2>3.3 ç®€å•ä¾‹å­</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">File Name: test_pytest.py</span>
<span class="sd">Author: willdx</span>
<span class="sd">mail: daixiang1992@gmail.com</span>
<span class="sd">Created Time: Wed Apr 19 23:45:14 2017</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># unittest å¿…é¡»æŠŠæµ‹è¯•ç”¨ä¾‹æ”¾å…¥TestCaseç±»ä¸­, pytest åªè¦æ±‚å‡½æ•°æˆ–è€…ç±»ä»¥testå¼€å¤´</span>


<span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># åˆ›å»ºæµ‹è¯•ç¯å¢ƒ, å¯ä»¥ç”¨æ¥åšsetUp å’Œ tearDown çš„å·¥ä½œ</span>
<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">setup_math</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">return</span> <span class="n">math</span>

<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">setup_function</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">teardown_function</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;teardown_function called.&quot;</span><span class="p">)</span>
    <span class="c1"># è¿™ä¸ªå†…åµŒçš„å‡½æ•°åštearDownçš„å·¥ä½œ</span>
    <span class="n">request</span><span class="o">.</span><span class="n">addfinalizer</span><span class="p">(</span><span class="n">teardown_function</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;setup_function called.&#39;</span><span class="p">)</span>

<span class="c1"># Py.testä¸éœ€è¦Unittestçš„é‚£ç§æ¨¡æ¿ï¼Œ åªè¦å‡½æ•°æˆ–è€…ç±»ä»¥testå¼€å¤´å³å¯</span>
<span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">setup_function</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Test_Func called.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_setup_math</span><span class="p">(</span><span class="n">setup_math</span><span class="p">):</span>
    <span class="c1"># pytestä¸éœ€è¦ä½¿ç”¨self.assertXXXè¿™æ ·çš„æ–­è¨€è¯­æ³•,è€Œç›´æ¥ä½¿ç”¨Pythonè‡ªå¸¦çš„assert</span>
    <span class="c1">#import time</span>
    <span class="c1">#time.sleep(4)</span>
    <span class="k">assert</span> <span class="n">setup_math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mf">8.0</span>

 
<span class="k">class</span> <span class="nc">TestClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="s1">&#39;hello&#39;</span>

    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_math</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">setup_math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mf">11.0</span>

<span class="k">def</span> <span class="nf">raise_exit</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_mytest</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">SystemExit</span><span class="p">):</span> <span class="c1">#ç”¨æ¥æµ‹è¯•æŠ›å‡ºçš„å¼‚å¸¸</span>
        <span class="n">raise_exit</span><span class="p">()</span>


<span class="c1"># parametrize å¯ä»¥ç”¨è£…é¥°å™¨çš„æ–¹å¼é›†æˆå¤šç»„æµ‹è¯•ç”¨ä¾‹</span>
<span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s1">&#39;test_input, expected&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1+3&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;2*4&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1 == 2&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span> 
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<h2>3.4 å‘½ä»¤è¡Œ</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># 1.è¿è¡Œæµ‹è¯•æ–‡ä»¶</span>
python -m pytest test_pytest.py
<span class="c1"># 2.éªŒè¯æ•´ä¸ªç›®å½•</span>
py.test .
<span class="c1"># 3.éªŒè¯å•ä¸ªæµ‹è¯•ç”¨ä¾‹</span>
py.test ./test_pytest.py::test_mytest
<span class="c1"># 4.éªŒè¯å•ä¸ªæµ‹è¯•ç”¨ä¾‹çš„å•ä¸ªæ–¹æ³•::test_in</span>
py.test ./test_pytest.py::TestClass::test_in
</pre></div>
</div>
<h2>3.5 æ’ä»¶</h2>

<h3>3.5.1 pytest-random</h3>

<p><strong>è®©æµ‹è¯•ç”¨ä¾‹å˜æˆéšæœºçš„</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-random
py.test --random
</pre></div>
</div>
<h3>3.5.2 pytest-xdist</h3>

<p><strong>è®©py.testæ”¯æŒåˆ†å¸ƒå¼æµ‹è¯•</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-xdist
<span class="c1"># 1.å°†æµ‹è¯•æ”¾åˆ°å¤šä¸ªCPUæ‰§è¡Œ</span>
py.test -n <span class="m">3</span> test_pytest.py

<span class="c1"># 2.ä½¿ç”¨å­è¿›ç¨‹è¿›è¡Œå¹¶å‘æµ‹è¯•</span>
py.test -d --tx <span class="m">3</span><span class="se">\*</span>popen//python<span class="o">=</span>python2.7 test_pytest.py
</pre></div>
</div>
<h3>3.5.3 pytest-instafail</h3>

<p><strong>ä¸€æ—¦å‡ºç°é”™è¯¯ä¿¡æ¯å°±ç«‹å³è¿”å›, ä¸ç”¨ç­‰å¾…æ‰€æœ‰çš„æµ‹è¯•è¿è¡Œå®Œæˆ</strong></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install pytest-instafail
py.test --instafail
</pre></div>
</div>
<h1>4. Nose</h1>

<p><a href="http://readthedocs.org/docs/nose/en/latest/">nose</a></p>
<blockquote class="blockquote-normal">
                <p>noseç»§æ‰¿æµ‹è¯•å•å…ƒï¼Œèƒ½å¤Ÿä½¿æµ‹è¯•æ›´åŠ å®¹æ˜“<br/>ä¸è¿‡æ®è¯´æœ€è¿‘å‡ å¹´Noseå¤„äºç»´æŠ¤çŠ¶æ€, ä¹¦ä¸Šçš„å»ºè®®ä½¿ç”¨py.test æ›¿æ¢nose, è¿™ç‚¹å¾—æˆ‘ç ”ç©¶ä¹‹åå†ä¸‹ç»“è®º<br/>noseè‡ªåŠ¨åŒ–æµ‹è¯•å‘ç°å¹¶èŠ‚çœäººå·¥åˆ›å»ºæµ‹è¯•ç»„ä»¶çš„éº»çƒ¦ã€‚å®ƒä¹Ÿæä¾›å„ç§æ’ä»¶ï¼Œä¾‹å¦‚xUnitå…¼å®¹æ€§æµ‹è¯•è¾“å‡ºï¼Œè¦†ç›–åº¦æŠ¥å‘Šå’Œæµ‹è¯•é€‰æ‹©</p></blockquote>
<h2>4.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install nose
</pre></div>
</div>
<h2>4.2 ä½¿ç”¨</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="nb">cd</span> tests/
nosetests
</pre></div>
</div>
<h1>5. tox</h1>

<p><a href="http://testrun.org/tox/latest/">toxæ–‡æ¡£</a></p>
<blockquote class="blockquote-normal">
                <p>Toxæ˜¯ä¸€ä¸ªé€šç”¨çš„Virtualenv ç®¡ç†å’Œæµ‹è¯•å‘½ä»¤è¡Œå·¥å…·, å®ƒçš„ç›®æ ‡æ˜¯æä¾›æœ€å…ˆè¿›çš„è‡ªåŠ¨åŒ–æ‰“åŒ…,æµ‹è¯•å’Œå‘å¸ƒåŠŸèƒ½.<br/>Toxåªèƒ½åœ¨ç»ˆç«¯ä½¿ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼åšæµ‹è¯•, å¤šç”¨äºæœ¬åœ°ç¯å¢ƒçš„æµ‹è¯•æˆ–è€…é›†æˆè¿›CiæœåŠ¡å™¨<br/>Toxçš„æœ€å¤§ç‰¹æ€§æ˜¯æ”¯æŒä¸€æ¬¡æ€§éªŒè¯å¤šä¸ªç‰ˆæœ¬çš„Pythonè§£é‡Šå™¨ä¸‹ çš„åŒ…çš„é›†æˆæƒ…å†µ<br/>Toxç®€ç›´æ˜¯å¼€æºé¡¹ç›®ä¹‹å¿…å¤‡è‰¯è¯å•Š</p></blockquote>
<h2>5.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install tox
</pre></div>
</div>
<h2>5.2 ç®€å•ä¾‹å­</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>âœ  section3 git:<span class="o">(</span>master<span class="o">)</span> tree
.
â”œâ”€â”€ requirements.txt <span class="c1">#ä¾èµ–æ–‡ä»¶</span>
â”œâ”€â”€ tests 
â”‚Â Â  â””â”€â”€ test_pytest.py <span class="c1">#æµ‹è¯•ç”¨ä¾‹</span>
â””â”€â”€ tox.ini <span class="c1">#é…ç½®æ–‡ä»¶</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># Toxé…ç½®å¦‚ä¸‹</span>
<span class="o">[</span>tox<span class="o">]</span>
<span class="nv">envlist</span> <span class="o">=</span> py<span class="o">{</span><span class="m">2</span>.7, <span class="m">3</span>.5<span class="o">}</span> <span class="c1"># é»˜è®¤åˆ›å»ºPython2.7å’ŒPython3.5è¿™ä¸¤ä¸ªè™šæ‹Ÿç¯å¢ƒ</span>
<span class="nv">skipsdist</span> <span class="o">=</span> True <span class="c1"># Toxä¼šé»˜è®¤ä½¿ç”¨distçš„æ–¹å¼æ„å»ºåŒ…, å¯¹äºæµ‹è¯•æ¥è¯´æ²¡æœ‰å¿…è¦, è€Œä¸”æ„å»ºè¿˜ä¼šè¦æ±‚å­˜åœ¨README,setup.pyç­‰æ–‡ä»¶,å¹¶ä¸”è¿™äº›æ–‡ä»¶æ ¼å¼ç¬¦åˆè¦æ±‚ç­‰, æœ¬ä¾‹è·³è¿‡è¿™ä¸ªæ­¥éª¤</span>

<span class="o">[</span>testenv<span class="o">]</span> <span class="c1"># é»˜è®¤çš„é›†æˆæ–¹æ¡ˆ</span>
<span class="nv">deps</span> <span class="o">=</span> pytest <span class="c1"># é›†æˆéœ€è¦çš„ä¾èµ–</span>
<span class="nv">commands</span> <span class="o">=</span> <span class="o">{</span>posargs:py.test<span class="o">}</span> <span class="c1"># å¯ä»¥æŠŠè°ƒç”¨çš„å‘½ä»¤çš„å‚æ•°é€šè¿‡posargsä¼ ç»™Toxæ¥ä½¿ç”¨</span>

<span class="o">[</span>testenv:flake8<span class="o">]</span> <span class="c1"># éé»˜è®¤çš„é›†æˆæ–¹æ¡ˆ, éœ€è¦ä½¿ç”¨ tox -e flake8 æ‰èƒ½è°ƒç”¨</span>
<span class="nv">basepython</span><span class="o">=</span>python2.7
<span class="nv">deps</span><span class="o">=</span>
    pytest <span class="c1"># ä¾èµ–å¯ä»¥å¤šè¡Œ</span>
    -rrequirements.txt  <span class="c1"># æ–‡ä»¶æœ‰ç›¸å…³çš„ä¾èµ– flake8</span>
<span class="nv">commands</span> <span class="o">=</span>  
    <span class="o">{</span>posargs:py.test<span class="o">}</span> <span class="c1"># å•å…ƒæµ‹è¯•</span>
    flake8 .  <span class="c1"># ä»£ç è§„èŒƒ</span>
</pre></div>
</div>
<h2>5.3 å‘½ä»¤è¡Œ</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>tox <span class="c1">#é»˜è®¤æ–¹æ¡ˆ, åˆ›å»ºpy27,py35è¿™2ä¸ªè™šæ‹Ÿç¯å¢ƒ, ç›®å½•é»˜è®¤åœ¨å½“å‰ç›®å½•çš„.toxç›®å½•ä¸‹, ä½¿ç”¨çš„å‘½ä»¤æ˜¯pytest</span>
tox -e flake8 <span class="c1">#ä½¿ç”¨ testenv:flake8è¿™ä¸ªå—ä¸­çš„é›†æˆæ–¹æ¡ˆ</span>
tox -e py2.7 <span class="c1">#ä»…ä½¿ç”¨py27çš„é›†æˆæ–¹æ¡ˆ, å’Œtox -e py27åŒä¹‰</span>
tox -- py.test -k test_eval <span class="c1">#åªæµ‹è¯•test_evalç›¸å…³çš„3ä¸ªæµ‹è¯•,è¿™å°±æ˜¯{posargs:py.test}çš„ä½œç”¨</span>
tox -e py27 -- python <span class="c1">#è¿›å…¥python2.7çš„äº¤äº’æ¨¡å¼</span>
tox -e py27 -- python -m SimpleHttpServer <span class="c1">#å¯ä»¥æ”¯æŒå¤šä¸ªå‚æ•°</span>
</pre></div>
</div>
<h1>6. Unittest2</h1>

<p><a href="http://pypi.python.org/pypi/unittest2">unittest2</a></p>
<blockquote class="blockquote-normal">
                <p>Unittest2æ˜¯Python2.7ä¸­unittestæ¨¡å‹çš„è¡¥ä¸ï¼Œå®ƒçš„APIæœ‰æ‰€æ”¹å–„ï¼Œå¹¶ä¸”å¯¹Pythonä¹‹å‰ç‰ˆæœ¬ä¸­å·²æœ‰çš„å†…å®¹æœ‰äº†æ›´å¥½çš„è¯´æ˜</p><br/><p>å¦‚æœä½¿ç”¨Python2.6ç‰ˆæœ¬æˆ–è€…ä»¥ä¸‹ï¼Œéœ€è¦ä½¿ç”¨pipå®‰è£…unittest2</p></blockquote>
<h2>6.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>pip install unittest2
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>å°†æ¥ä½ å¯èƒ½æƒ³è¦ä»¥unittestä¹‹åå¯¼å…¥æ¨¡å—ï¼Œç›®çš„æ˜¯æ›´å®¹æ˜“åœ°æŠŠä»£ç ç§»æ¤åˆ°æ–°çš„ç‰ˆæœ¬ä¸­</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest2</span> <span class="kn">as</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<h1>7.mock</h1>

<p><a href="https://docs.python.org/dev/library/unittest.mock">æ ‡å‡†åº“ä¸­å°±æœ‰</a>
<a href="http://www.voidspace.org.uk/python/mock/">Mockæ–‡æ¡£</a></p>
<blockquote class="blockquote-normal">
                <p>mockæ˜¯è¾…åŠ©å•å…ƒæµ‹è¯•çš„ä¸€ä¸ªæ¨¡å—. æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å¯¹å¯èƒ½ä¸ç¨³å®š, æœ‰å‰¯ä½œç”¨, ä¸å®¹æ˜“è·å–çš„å¯¹è±¡, ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„å¯¹è±¡æ¥åˆ›å»ºä»¥ä¾¿å®Œæˆæµ‹è¯•çš„æ–¹æ³•. åœ¨Pythonä¸­,è¿™ç§ç±»å‹çš„æµ‹è¯•æ˜¯é€šè¿‡Mockåº“å®Œæˆçš„<br/> ä¸ªäººç†è§£: å°±æ˜¯å°†å¤–éƒ¨ä¾èµ–éƒ½æ¨¡æ‹Ÿä¸ºå›ºå®šçš„å€¼, ä¾‹å¦‚å¾…æµ‹è¯•å‡½æ•°ä¸­éœ€è¦è°ƒç”¨å¤–éƒ¨æ¥å£çš„åœºæ™¯, æˆ‘ä»¬å°±å¯ä»¥å‡è®¾æ¥å£è¿”å›çš„æ¶ˆæ¯çš„ç»“æ„, ä½¿ç”¨Mockæ¨¡æ‹Ÿæ¥å£è¿”å›å€¼, æ ¹æ®è®¾å®šå€¼å»æµ‹è¯•å‡½æ•°åŠŸèƒ½;<br/>å…¶ä»–åœºæ™¯: å‡½æ•°é—´çš„ç›¸äº’ä¾èµ–; è¿æ¥æ•°æ®åº“; </p></blockquote>
<h2>7.1 install</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>åœ¨Python2.x ä¸­ mockæ˜¯ä¸€ä¸ªå•ç‹¬æ¨¡å—ï¼Œéœ€è¦å•ç‹¬å®‰è£…

pip install  mock

åœ¨Python3.xä¸­ï¼Œmockå·²ç»è¢«é›†æˆåˆ°äº†unittestå•å…ƒæµ‹è¯•æ¡†æ¶ä¸­ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
</pre></div>
</div>
<h2>7.2  è¿™ä¸ªé—®é¢˜æˆ‘æ€è€ƒäº†å¾ˆä¹…</h2>
<blockquote class="blockquote-normal">
                <p>æŠŠè¦æµ‹çš„ä¸œè¥¿éƒ½æ¨¡æ‹Ÿæ‰äº†è¿˜æµ‹è¯•ä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>ä½†åœ¨ï¼Œå®é™…ç”Ÿäº§ä¸­çš„é¡¹ç›®æ˜¯éå¸¸å¤æ‚çš„ï¼Œå¯¹å…¶è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

1. æ¥å£çš„ä¾èµ–
2. å¤–éƒ¨æ¥å£è°ƒç”¨
3. æµ‹è¯•ç¯å¢ƒéå¸¸å¤æ‚

ã€€ã€€å•å…ƒæµ‹è¯•åº”è¯¥åªé’ˆå¯¹å½“å‰å•å…ƒè¿›è¡Œæµ‹è¯•, æ‰€æœ‰çš„å†…éƒ¨æˆ–å¤–éƒ¨çš„ä¾èµ–åº”è¯¥æ˜¯ç¨³å®šçš„, å·²ç»åœ¨åˆ«å¤„è¿›è¡Œæµ‹è¯•è¿‡çš„
ä½¿ç”¨mock å°±å¯ä»¥å¯¹å¤–éƒ¨ä¾èµ–ç»„ä»¶å®ç°è¿›è¡Œæ¨¡æ‹Ÿå¹¶ä¸”æ›¿æ¢æ‰, ä»è€Œä½¿å¾—å•å…ƒæµ‹è¯•å°†ç„¦ç‚¹åªæ”¾åœ¨å½“å‰çš„å•å…ƒåŠŸèƒ½</pre></div></div>

<h2>7.3 ç®€å•åœºæ™¯</h2>

<p><strong>åœºæ™¯1: å‡è®¾ç°åœ¨ä¸€ä¸ªå•å…ƒæµ‹è¯•ä¾èµ–å¤–éƒ¨çš„APIè¿”å›å€¼</strong></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># ä»£ç éƒ¨åˆ†</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">api_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span>

<span class="k">def</span> <span class="nf">get_review_author</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">api_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">][</span><span class="s1">&#39;author&#39;</span><span class="p">]</span>
    
<span class="c1"># æµ‹è¯•ç”¨ä¾‹</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">mock</span>
<span class="kn">import</span> <span class="nn">client</span>
<span class="k">class</span> <span class="nc">TestClient</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;dongwm&#39;</span><span class="p">}}</span>
        
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s1">&#39;client.api_request&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">test_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_request</span><span class="p">):</span>
        <span class="n">api_request</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_review_author</span><span class="p">(</span><span class="s1">&#39;http://www.xxx.com/123&#39;</span><span class="p">,</span> <span class="s1">&#39;dongwm&#39;</span><span class="p">))</span>
</pre></div>
</div>
<h1>8. ä¸ºè‡ªå·±çš„é¡¹ç›®ç”Ÿæˆæµ‹è¯•é’©å­</h1>
<blockquote class="blockquote-normal">
                <p>ä½¿ç”¨å¼€æºç¤¾åŒºçš„ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™, éƒ½ä¼šæä¾›æµ‹è¯•å…¥å£, ä»¥ç¡®å®šæ”¹åº“åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ<br/>å“ˆå“ˆ.... æ–‡æ¡£å¾…å®Œå–„</p></blockquote>
<h1>9. ä»£ç è¦†ç›–ç‡ç»Ÿè®¡</h1>

<p>ä»£ç è¦†ç›–ç‡ç»Ÿè®¡ï¼Œè¦ç”¨åˆ°coverage, æš‚æ—¶ä¸çŸ¥é“å…·ä½“æ€ä¹ˆåš</p>

<p><a href="http://www.epubit.com.cn/book/details/1835">Pythoné«˜æ‰‹ä¹‹è·¯æµ‹è¯•éƒ¨åˆ†</a>
<a href="https://book.douban.com/subject/26852057/">Python Webå¼€å‘å®æˆ˜</a>
<a href="https://segmentfault.com/a/1190000002965620">Python Mock å…¥é—¨</a></p>

    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://willdx.github.io">willdx.github.io</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93231524-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: '177af99888a292531873',
        clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'Pythonæµ‹è¯•å’ŒæŒç»­é›†æˆ',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>