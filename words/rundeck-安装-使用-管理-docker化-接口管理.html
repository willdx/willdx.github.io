<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> rundeck-å®‰è£…-ä½¿ç”¨-ç®¡ç†-dockeråŒ–-æ¥å£ç®¡ç† </title>
        <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
        <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/theme.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/card.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon.ico">
        <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitalk.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">


        <style type="text/css"> 
        </style>
    </head>
    
    <body class="sk-default">
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">ä¸»é¢˜é€‰æ‹©</span></h3>
                <table id="theme" style="width: 100%; color: #fff; margin-left: auto; margin-right: auto;">
                        <tbody>
                            <tr class="sk-mo" onclick="document.body.className = 'sk-mo'; localStorage.setItem('skin', 'sk-mo');">
                                <td class="title">å¢¨</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-green" onclick="document.body.className = 'sk-green'; localStorage.setItem('skin', 'sk-green');">
                                <td class="title">ç»¿</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-default" onclick="document.body.className = 'sk-default'; localStorage.setItem('skin', 'sk-default');">
                                <td class="title">é’</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg"></div></td>
                            </tr>
                            <tr class="sk-orange" onclick="document.body.className = 'sk-orange'; localStorage.setItem('skin', 'sk-orange');">
                                <td class="title">æ©˜</td>
                                <td width="50%;"><div style="width: 100%;height: 25px; background: var(--main-bg);" class="bg ">
                                </div></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
        <div id="cats-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <table style="color: #fff;">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-bn-avatar.jpeg" />
                                <div class="name">æ³¢å¦</div>
                                <div class="time">2017å¹´2æœˆ21å·</div>
                            </td>
                            <td valign="middle" align="center" width="50%">
                                <img src="/assets/cat-ss-avatar.png" />
                                <div class="name">ä¸‰ä¸‰</div>
                                <div class="time">2017å¹´4æœˆ10å·</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:1426409836@qq.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/willdx">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>





            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input id="searchInput" onkeypress="return search(event)" type="search" placeholder="Search with google...">
            </div>
        </div>

        <div id="topbar"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary site-wrapper icon button">
                    <i class="snowflake icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary social-links-wrapper icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary search-wrapper icon button">
                    <i class="search icon"></i>
                </button>
                <!--
                <button onclick="toggleById(wrappers, 'cats-wrapper')" class="ui secondary cats-wrapper icon button">
                    ğŸ±
                </button>
                -->
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary donation-wrapper icon button">
                    <i class="heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name">Will Dx</h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="top menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/tweet.html" class="item">
                        æ¨ç‰¹
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <a href="#social-links-wrapper" style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </a>
                    <a href="/rss.xml" class="item">
                        RSS 
                    </a>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>rundeck-å®‰è£…-ä½¿ç”¨-ç®¡ç†-dockeråŒ–-æ¥å£ç®¡ç†</h1>
        <h4>Posted April 07, 2017</h4>
        <p><a href="http://rundeck.org/docs/administration/index.html">å®˜æ–¹ç®¡ç†å‘˜æ‰‹å†Œ</a></p>

<h1>1. é‡åˆ°çš„å‘-ä»¥åŠè§£å†³</h1>

<h2>1.1 å‘çˆ¹çš„ä¸­æ–‡ä¹±ç é—®é¢˜</h2>
<blockquote class="blockquote-normal">
                <p>é—®é¢˜æè¿°:  rundeckèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨,ä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¸­æ–‡ä¹±ç <br/>é—®é¢˜ç°è±¡:  Ubuntu14.04ç»ˆç«¯æ— æ³•è¾“å…¥ä¸­æ–‡,vimä¹Ÿæ— æ³•è¾“å…¥ä¸­æ–‡</p></blockquote>
<h3>1.1.1 rundeckæ‰€åœ¨ubuntuæœºå™¨é…ç½®ä¸­æ–‡ç¯å¢ƒ</h3>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span>è§£å†³æ–¹æ¡ˆ:
<span class="m">1</span>.å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…
    sudo apt-get -y install language-pack-zh-hans language-pack-zh-hans-base

<span class="m">2</span>.åœ¨~/.bashrc æˆ–è€… ~/.zshrcæ–‡ä»¶è®¾å®šç¼–ç 
<span class="nb">export</span> <span class="nv">LC_ALL</span><span class="o">=</span>zh_CN.UTF-8
<span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span>zh_CN.UTF-8

<span class="m">3</span>.å†æ‰§è¡Œlocaleå‘½ä»¤è®¾ç½®å½“å‰localeç¯å¢ƒ:
sudo dpkg-reconfigure locales
sudo locale

<span class="m">4</span>.é‡å¼€ä¸€ä¸ªç»ˆç«¯
è®²é“ç†çš„è¯,ç»ˆç«¯å’Œviméƒ½èƒ½è¾“å…¥ä¸­æ–‡äº†

<span class="m">5</span>.å¦‚æœæ•°æ®ä¸é‡è¦å¯ä»¥å…ˆåˆ é™¤æ‰€æœ‰rundeckçš„æ–‡ä»¶,ç„¶åé‡æ–°ç”Ÿæˆ
ä¾‹å¦‚æˆ‘æ˜¯åœ¨ /data/rundeck/ç›®å½•ä¸‹å¯åŠ¨
<span class="nb">cd</span> /data/rundeck<span class="p">;</span>rm -rf *<span class="p">;</span>
</pre></div>
</div>
<h3>1.1.2 rundeckçš„mysqlæ•°æ®åº“ä¸­æ–‡æ”¯æŒ</h3>

<h4>è‡ªå»ºæ•°æ®åº“</h4>

<p><a href="http://www.imooc.com/article/4425">å‚è€ƒé“¾æ¥</a>
<a href="https://app.yinxiang.com/Home.action#n=0f3da369-993d-4d54-b397-a6f64ac71e4a&amp;ses=4&amp;sh=2&amp;sds=5&amp;">å°è±¡ç¬”è®°é“¾æ¥</a></p>

<h4>ä½¿ç”¨docker</h4>

<p>[å‚è€ƒgithubçš„é¡¹ç›®]https://github.com/dnhsoft/docker-mysql-utf8</p>

<h2>1.2 å¯åŠ¨å‘½ä»¤ç¼–ç </h2>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>å…¶ä¸­-Dfile.encoding=UTF-8æ˜¯ç”¨æ¥æŒ‡æ˜è¾“å‡ºæ—¥å¿—ä½¿ç”¨çš„ç¼–ç æ ¼å¼

exec java -Xmx${mem}m \
  -XX:MaxPermSize=${perm}m \
  -Drundeck.jetty.connector.forwarded=true \
  -Dserver.http.host=0.0.0.0 \
  -Dserver.hostname=$(hostname) \
  -Dserver.http.port=${SERVER_PORT:-4440} \
  -Dfile.encoding=UTF-8 \
  -jar $RDECK_JAR --skipinstall &</pre></div></div>

<h2>1.3 rundeckæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡è¿‡å¤š,åç»­ä»»åŠ¡æ— æ³•æ‰§è¡Œ</h2>
<blockquote class="blockquote-normal">
                <p>&lt;åœºæ™¯&gt;<br/>æ‰§è¡Œäº†10ä¸ªä»¥ä¸Šçš„åå°ä»»åŠ¡,åç»­ä»»åŠ¡å¯åŠ¨ä»»åŠ¡ä¸€ç›´running,ä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨ç›®æ ‡æœºå™¨è°ƒèµ·æ¥<br/>killå‡ ä¸ªä»»åŠ¡, æ²¡æœ‰è°ƒèµ·æ¥çš„ä»»åŠ¡æ•°é‡</p></blockquote><div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre><é—®é¢˜å®šä½>
è¿›å…¥dockerç¯å¢ƒ
1. å‡è®¾, å¤šä¸ªåå°è¿›ç¨‹èµ„æºæ¶ˆè€—è¿‡é«˜
æµ‹è¯•: å°è¯•å¢åŠ å¤šä¸ªåå°ä»»åŠ¡, htopè§‚å¯Ÿåå°çš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ, å‘ç°å¹¶æ²¡æœ‰å¼‚å¸¸
ç»“è®º: å¤šä¸ªåå°æ‰§è¡Œçš„ä»»åŠ¡(å¤§é‡è¾“å‡ºæ—¥å¿—çš„é™¤å¤–), ä¸ä¼šå ç”¨è¿‡å¤šçš„ç³»ç»Ÿèµ„æº, æ‰€ä»¥ç“¶é¢ˆä¸åœ¨è¿™é‡Œ.

2. å‡è®¾æ˜¯æœåŠ¡å™¨è¿æ¥æ•°é™å®š

> æœåŠ¡å™¨é™å®š
ulimit -n
1048576

> æœåŠ¡å™¨å®é™…
netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}'
TIME_WAIT 128
ESTABLISHED 10

å³ä½¿æˆ‘åœ¨rundeckä¸Šè¶…è¿‡10ä¸ªçš„åå°ä»»åŠ¡, å‘ç°å¾—åˆ°çš„ESTABLISHEDçš„é“¾æ¥åªæœ‰10

æ€»ç»“: rundeckçš„ESTABLISHEDæœ€å¤§è¿æ¥æ•°åªæœ‰10, å¿…å®šæ˜¯rundeckè‡ªèº«çš„é™å®šå€¼

<è§£å†³>
æ‰“å¼€rundeck-config.properties æ·»åŠ ä¸€è¡Œ:
vim /docker_data/rundeck/server/config/rundeck-config.properties 
quartz.props.threadPool.threadCount
é‡å¯rundeck
å†æ¬¡æŸ¥çœ‹è¿æ¥æ•°
netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}'
TIME_WAIT 399
ESTABLISHED 15</pre></div></div>

<h1>2.rundeckç®€å•ä½¿ç”¨</h1>

<h2>2.1å¯åŠ¨åœæ­¢</h2>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># æ–¹æ³•1: ç›´æ¥è°ƒç”¨javaåŒ…</span>
java -jar rundeck-launcher-2.8.2.jar
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># æ–¹æ³•2: ä»å¯åŠ¨è„šæœ¬å¯åŠ¨</span>
vim /etc/profile 
<span class="nb">export</span> <span class="nv">RDECK_BASE</span><span class="o">=</span>/home/jacky007wang/rundeck/
åœ¨åˆå§‹åŒ–jaråŒ…ä¹‹åï¼Œä¸‹ä¸€æ¬¡å¯åŠ¨å’Œå…³é—­å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
Startup
<span class="nv">$RDECK_BASE</span>/server/sbin/rundeckd start
Shutdown
<span class="nv">$RDECK_BASE</span>/server/sbin/rundeckd stop
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># æ–¹æ³•3: è°ƒç”¨JavaåŒ…, ä½†æ˜¯æ·»åŠ ä¸€äº›é…ç½®å‚æ•°</span>
java -Xmx3096m -XX:MaxPermSize<span class="o">=</span>774m -Drundeck.jetty.connector.forwarded<span class="o">=</span><span class="nb">true</span> -Dserver.http.host<span class="o">=</span><span class="m">0</span>.0.0.0 -Dserver.hostname<span class="o">=</span>10ec642ea1ff -Dserver.http.port<span class="o">=</span><span class="m">4440</span> -Dfile.encoding<span class="o">=</span>UTF-8 -Duser.timezone<span class="o">=</span>Asia/Shanghai -jar /data/rundeck/app.jar --skipinstall
</pre></div>
</div>
<h2>2.2æ·»åŠ ç”¨æˆ·ä¸æ›´æ”¹å¯†ç </h2>

<p><a href="http://rundeck.org/docs/administration/authenticating-users.html">rundeckè®¤è¯æ–¹å¼</a></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1"># è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„è®¤è¯æ–¹å¼PropertyFileLoginModule</span>
Location: /*jaråŒ…å¯åŠ¨å’Œrpmå®‰è£… é…ç½®æ–‡ä»¶è·¯å¾„*/
    Launcher: <span class="nv">$RDECK_BASE</span>/server/config/realm.properties 
    RPM/DEB: /etc/rundeck/realm.properties
</pre></div>
</div>
<h2>2.3å°†å¯†ç åŠ å¯†å­˜å‚¨</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="err">$</span><span class="n">RDECK_BASE</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span>
<span class="n">java</span> <span class="o">-</span><span class="n">cp</span> <span class="n">jetty</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="mf">7.6</span><span class="o">.</span><span class="mf">0.</span><span class="n">v20120127</span><span class="o">.</span><span class="n">jar</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">jetty</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">Password</span> <span class="n">daixiang</span> <span class="n">daixiang</span>
<span class="n">vim</span> <span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">realm</span><span class="o">.</span><span class="n">properties</span>
<span class="n">daixiang</span><span class="p">:</span> <span class="n">MD5</span><span class="p">:</span><span class="n">deb8235d78bd806f2f8972f3dc7970e8</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">admin</span>
</pre></div>
</div>
<h2>2.4è„šæœ¬æ–¹å¼</h2>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">DEFAULT_ADMIN_USER</span><span class="o">=</span><span class="n">xingzhe</span>
<span class="n">export</span> <span class="n">DEFAULT_ADMIN_PASSWORD</span><span class="o">=</span><span class="n">xxxxxx</span>
<span class="n">export</span> <span class="n">DEFAULT_USER</span><span class="o">==</span><span class="n">will</span>
<span class="n">export</span> <span class="n">DEFAULT_PASSWORD</span><span class="o">=</span><span class="n">xxxxx</span>
<span class="n">echo</span> <span class="s2">&quot;${DEFAULT_ADMIN_USER:-docker}:${DEFAULT_ADMIN_PASSWORD:-docker},user,admin&quot;</span> <span class="err">$</span><span class="n">RDECK_BASE</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">realm</span><span class="o">.</span><span class="n">properties</span>
<span class="n">echo</span> <span class="s2">&quot;${DEFAULT_USER:-docker}:${DEFAULT_PASSWORD:-docker},user&quot;</span> <span class="err">$</span><span class="n">RDECK_BASE</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">realm</span><span class="o">.</span><span class="n">properties</span>
</pre></div>
</div>
<h1>3.ä¿®æ”¹æ•°æ®å­˜å‚¨</h1>

<p><a href="http://rundeck.org/docs/administration/setting-up-an-rdb-datasource.html">ä¿®æ”¹æ•°æ®å­˜å‚¨01</a>
<a href="http://rundeck.org/docs/administration/setting-up-an-rdb-datasource.html#mysql-setup-guide">ä¿®æ”¹æ•°æ®å­˜å‚¨02</a></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1">#ä¿®æ”¹æ•°æ®å­˜å‚¨æ–‡ä»¶:</span>
<span class="nv">config_properties</span><span class="o">=</span><span class="nv">$RDECK_BASE</span>/server/config/rundeck-config.properties
<span class="c1">#æ³¨æ„rundeckæ”¯æŒmysqlå’Œh2çš„JDBCé©±åŠ¨,å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹æè¿°:</span>

Rundeck includes a JDBC driver <span class="k">for</span> Mysql and H2. If you are using another database copy the appropriate JDBC driver, such as <span class="s2">&quot;ojdbc14.jar&quot;</span> <span class="k">for</span> Oracle into the server lib dir:
<span class="sb">`</span>cp ojdbc14.jar <span class="nv">$RDECK_BASE</span>/server/lib<span class="sb">`</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1">#è„šæœ¬è®¾å®š</span>
<span class="k">function</span> config_mysql<span class="o">()</span> <span class="o">{</span>
    <span class="nv">sql_datasource</span><span class="o">=</span><span class="s2">&quot;dataSource.url = jdbc:mysql://</span><span class="si">${</span><span class="nv">MYSQL_ADDR</span><span class="k">:-</span><span class="nv">mysql</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">MYSQL_DB</span><span class="k">:-</span><span class="nv">rundeck</span><span class="si">}</span><span class="s2">?autoReconnect=true&quot;</span>
    <span class="nv">sql_un</span><span class="o">=</span><span class="s2">&quot;dataSource.username = </span><span class="si">${</span><span class="nv">MYSQL_USER</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nv">sql_pw</span><span class="o">=</span><span class="s2">&quot;dataSource.password = </span><span class="si">${</span><span class="nv">MYSQL_PASSWORD</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nv">extra_crap_for_sql</span><span class="o">=</span><span class="s2">&quot;rundeck.projectsStorageType=db\nrundeck.storage.provider.1.type=db\nrundeck.storage.provider.1.path=keys&quot;</span>
    sed -i <span class="s2">&quot;s,^dataSource\.url.*\$,</span><span class="si">${</span><span class="nv">sql_datasource</span><span class="si">}</span><span class="s2">,&quot;</span> <span class="nv">$config_properties</span>
    <span class="nb">echo</span> <span class="nv">$sql_un</span> &gt;&gt; <span class="nv">$config_properties</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">$sql_pw</span> &gt;&gt; <span class="nv">$config_properties</span>
    <span class="nb">echo</span> -e <span class="nv">$extra_crap_for_sql</span> &gt;&gt; <span class="nv">$config_properties</span>
<span class="o">}</span>
</pre></div>
</div>
<h1>4.æ·»åŠ é¡¹ç›®readme</h1>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1">#readme.mdåœ°å€:markdownæ ¼å¼è¯­æ³•å³å¯</span>
launcher: <span class="nv">$RDECK_BASE</span>/projects/<span class="o">{</span>project<span class="o">}</span>/readme.md
rpm/deb: /var/rundeck/projects/<span class="o">{</span>project<span class="o">}</span>/readme.md
</pre></div>
</div>
<h1>5.é…ç½®èŠ‚ç‚¹</h1>

<p><a href="http://rundeck.org/docs/administration/project-setup.html">é…ç½®èŠ‚ç‚¹-å®˜ç½‘åœ°å€</a></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1">#ä¾‹å­</span>
&lt;project&gt;&lt;<span class="nv">nodename</span><span class="o">=</span><span class="s2">&quot;orion&quot;</span><span class="nv">description</span><span class="o">=</span><span class="s2">&quot;a foodazzler service host&quot;</span><span class="nv">tags</span><span class="o">=</span><span class="s2">&quot;staging,us-east&quot;</span><span class="nv">osFamily</span><span class="o">=</span><span class="s2">&quot;unix&quot;</span><span class="nv">osName</span><span class="o">=</span><span class="s2">&quot;Linux&quot;</span><span class="nv">hostname</span><span class="o">=</span><span class="s2">&quot;orion&quot;</span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;alexh&quot;</span>/&gt;&lt;/project&gt;

&lt;project&gt;&lt;<span class="nv">nodename</span><span class="o">=</span><span class="s2">&quot;orion&quot;</span><span class="nv">description</span><span class="o">=</span><span class="s2">&quot;a foodazzler service host&quot;</span><span class="nv">tags</span><span class="o">=</span><span class="s2">&quot;staging,us-east&quot;</span><span class="nv">osFamily</span><span class="o">=</span><span class="s2">&quot;unix&quot;</span><span class="nv">osName</span><span class="o">=</span><span class="s2">&quot;Linux&quot;</span><span class="nv">hostname</span><span class="o">=</span><span class="s2">&quot;orion&quot;</span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;alexh&quot;</span>/&gt;&lt;<span class="nv">nodename</span><span class="o">=</span><span class="s2">&quot;homestar&quot;</span><span class="nv">description</span><span class="o">=</span><span class="s2">&quot;a humdinger&quot;</span><span class="nv">tags</span><span class="o">=</span><span class="s2">&quot;integration,us-west&quot;</span><span class="nv">osFamily</span><span class="o">=</span><span class="s2">&quot;unix&quot;</span><span class="nv">hostname</span><span class="o">=</span><span class="s2">&quot;192.168.1.02&quot;</span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;alexh&quot;</span>&gt;&lt;<span class="nv">attributename</span><span class="o">=</span><span class="s2">&quot;flavor&quot;</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span>/&gt;&lt;<span class="nv">attributename</span><span class="o">=</span><span class="s2">&quot;package:version&quot;</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;2.0&quot;</span>/&gt;&lt;/node&gt;&lt;/project&gt;

<span class="c1">#æ³¨æ„:éœ€è¦è®¾å®šrundeck-serverå…å¯†ç™»å½•clientæ‰èƒ½åœ¨clientä¸Šæ‰§è¡Œå‘½ä»¤</span>
<span class="c1">#æ³¨æ„:æœ‰çš„sshç«¯å£å¼€æ”¾åœ¨é22ç«¯å£,åœ¨æ·»åŠ èŠ‚ç‚¹å’Œåšå…å¯†ç™»å½•çš„æ—¶å€™éƒ½éœ€è¦æ·»åŠ ç«¯å£</span>

<span class="c1">#ç«¯å£é—®é¢˜</span>
<span class="nv">hostname</span><span class="o">=</span><span class="s2">&quot;192.168.1.02:port&quot;</span>
<span class="c1">#å¯ä»¥ä½¿ç”¨ssh-copy-idå‘½ä»¤åšå…å¯†ç™»å½•</span>
ssh-copy-id -i ~/.ssh/id_rsa.pub -p <span class="m">2380</span> <span class="s2">&quot;ill@120.55.74.101&quot;</span>
</pre></div>
</div>
<h1>6.æƒé™æ§åˆ¶</h1>

<p><a href="http://rundeck.org/docs/administration/access-control-policy.html">æƒé™æ§åˆ¶</a>
<a href="http://rundeck.org/docs/man1/rd-acl.html">æƒé™æ§åˆ¶å‘½ä»¤è¡Œå·¥å…·rd-acl</a></p>
<div class="code-wrapper"><div class="lang-label">Bash</div><div class="highlight"><pre><span></span><span class="c1">#å®˜æ–¹æè¿°</span>
All *.aclpolicy files found in the rundeck etc dir, which is either /etc/rundeck <span class="o">(</span>rpm and debian install defaults<span class="o">)</span>, or <span class="nv">$RDECK_BASE</span>/etc <span class="o">(</span>launcher/war configuration<span class="o">)</span>.

<span class="c1">#ä½ç½®</span>
<span class="nv">$RDECK_BASE</span>/etc/xx.aclpolicy

<span class="c1">#ä»¥admin.aclpolicyä¸ºä¾‹å­,è§£é‡ŠACLæƒé™æ§åˆ¶</span>

<span class="c1">## 1.admin é¡¹ç›®çº§åˆ«çš„æƒé™</span>
description: Admin, all access.  <span class="c1">#å®Œå…¨æ§åˆ¶</span>
context:
  project: <span class="s1">&#39;.*&#39;</span> <span class="c1"># æ‰€æœ‰é¡¹ç›®</span>
<span class="k">for</span>:
  resource:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># æ‰€æœ‰çš„è¯»å–/åˆ›å»ºæƒé™</span>
  adhoc:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow read/running/killing adhoc jobs</span>
  job:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow read/write/delete/run/kill of all jobs</span>
  node:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow read/run for all nodes</span>
by:
  group: admin

---
<span class="c1">## 2.admin åº”ç”¨çº§åˆ«çš„æƒé™</span>
description: Admin, all access.
context:
  application: <span class="s1">&#39;rundeck&#39;</span>
<span class="k">for</span>:
  resource:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow create of projects</span>
  project:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow view/admin of all projects</span>
  project_acl:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow admin of all project-level ACL policies</span>
  storage:
    - allow: <span class="s1">&#39;*&#39;</span> <span class="c1"># allow read/create/update/delete for all /keys/* storage content</span>
by:
  group: admin
</pre></div>
</div>
<h2>6.1æ·»åŠ ä¸€ä¸ªé™åˆ¶ç”¨æˆ·çš„aclä¾‹å­</h2>

<h3>6.1.1éœ€è¦å…ˆæ·»åŠ å¥½è´¦å·å’Œç»„åˆ«</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">vim</span> <span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">realm</span><span class="o">.</span><span class="n">properties</span>
<span class="err">ä¾‹å¦‚</span><span class="p">:</span>
<span class="n">test</span><span class="p">:</span><span class="n">xxxx</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">product</span>
</pre></div>
</div>
<h3>6.1.2ç„¶åå¯¹è®¾å®šçš„ç»„åˆ«è¿›è¡Œæƒé™è®¾å®š</h3>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># vim etc/product.aclpolicy</span>
<span class="n">description</span><span class="p">:</span> <span class="n">sp</span> <span class="n">project</span> <span class="n">acl</span>
<span class="n">context</span><span class="p">:</span>
  <span class="n">project</span><span class="p">:</span> <span class="s1">&#39;operate&#39;</span>
<span class="k">for</span><span class="p">:</span>
  <span class="n">resource</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">job</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">run</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">node</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">event</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">create</span><span class="p">]</span>
  <span class="n">adhoc</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
  <span class="n">job</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;è½¦åº—-å·¥å…·&#39;</span>
        <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;xz_servie_point_checked&#39;</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">run</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;è½¦åº—-å·¥å…·&#39;</span>
        <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;xz_servie_point_comment_manage&#39;</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">run</span><span class="p">]</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">run</span><span class="p">]</span>
<span class="n">by</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">sp</span>

<span class="o">---</span>

<span class="n">description</span><span class="p">:</span> <span class="n">sp</span> <span class="n">system</span> <span class="n">acl</span>
<span class="n">context</span><span class="p">:</span>
  <span class="n">application</span><span class="p">:</span> <span class="s1">&#39;rundeck&#39;</span>
<span class="k">for</span><span class="p">:</span>
  <span class="n">resource</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">project</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span> <span class="n">run</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">system</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span><span class="n">enable_executions</span><span class="p">,</span><span class="n">disable_executions</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">system_acl</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">equals</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">user</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
  <span class="n">project</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;operate&#39;</span>
      <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
  <span class="n">project_acl</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">allow</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span> <span class="c1"># allow admin of all project-level ACL policies</span>
  <span class="n">storage</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">allow</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">,</span><span class="n">create</span><span class="p">,</span><span class="n">update</span><span class="p">]</span> <span class="c1"># allow read/create/update/delete for all /keys/* storage content</span>
<span class="n">by</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">sp</span>
</pre></div>
</div>
<h3>6.1.3æŒ‰ç…§è§’è‰²åˆ†ç±»è®¾å®šaclæƒé™</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>TODO: å¾…è¡¥å……</pre></div></div>

<h1>7.é‚®ä»¶å‘Šè­¦-æµ‹è¯•ä¸é€šè¿‡-ä»»åŠ¡ä¸€ç›´å¤„äºrunningçŠ¶æ€(æ±‚é«˜æ‰‹æŒ‡å¯¼)</h1>

<p><a href="http://rundeck.org/docs/administration/email-settings.html">é‚®ä»¶å‘Šè­¦</a>
<a href="http://gpc.github.io/grails-mail/guide/2.%20Configuration.html#2.1%20SMTP%20Server%20Configuration">å‚è€ƒæ–‡æ¡£</a></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">docker_data</span><span class="o">/</span><span class="n">rundeck</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">rundeck</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">properties</span>
<span class="err">æ·»åŠ </span><span class="p">:</span>
<span class="c1"># email</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="n">smtp</span><span class="o">.</span><span class="n">qq</span><span class="o">.</span><span class="n">com</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">25</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">username</span><span class="o">=</span><span class="mi">1426409836</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">xxxxxxxxxxx</span>  <span class="sb">`#è¿™é‡Œæ˜¯ä½ çš„æˆæƒç `</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">from</span><span class="o">=</span><span class="mi">1426409836</span><span class="nd">@qq.com</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">overrideAddress</span> <span class="o">=</span> <span class="s2">&quot;1426409836@qq.com&quot;</span>
<span class="n">grails</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mail.smtp.starttls.enable&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span><span class="p">,</span><span class="s2">&quot;mail.smtp.port&quot;</span><span class="p">:</span><span class="s2">&quot;465&quot;</span><span class="p">]</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="n">grails</span> <span class="p">{</span>
    <span class="n">mail</span> <span class="p">{</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;smtp.gmail.com&quot;</span>
        <span class="s1">&#39;default&#39;</span> <span class="p">{</span>
            <span class="kn">from</span> <span class="o">=</span> <span class="s2">&quot;&lt;username&gt;@gmail.com&quot;</span>
        <span class="p">}</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">465</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;&lt;username&gt;@gmail.com&quot;</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&lt;password&gt;&quot;</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mail.smtp.auth&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span><span class="p">,</span>                      
          <span class="s2">&quot;mail.smtp.socketFactory.port&quot;</span><span class="p">:</span><span class="s2">&quot;465&quot;</span><span class="p">,</span>
          <span class="s2">&quot;mail.smtp.socketFactory.class&quot;</span><span class="p">:</span><span class="s2">&quot;javax.net.ssl.SSLSocketFactory&quot;</span><span class="p">,</span>
          <span class="s2">&quot;mail.smtp.socketFactory.fallback&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>é™„QQé‚®ç®±æˆæƒç ä½ç½®, é‚®ç®±è®¾ç½®-è´¦æˆ·-POP3æœåŠ¡</p></blockquote>
<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901097317831.jpg"></p>
</p>

<h1>8.åŸºæœ¬ä½¿ç”¨</h1>

<h2>8.1.ä»»åŠ¡ç®¡ç†ç•Œé¢</h2>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/05bd4b9c-d329-4aa0-826e-001f42741a86.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<h2>8.2.åˆ›å»ºä¸€ä¸ªä»»åŠ¡</h2>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/d108141d-def9-438b-91aa-1fcc8d3da487.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/2754aed6-188d-4791-b09e-1f2e5cefbb09.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/ec53d12c-e45c-4a45-9002-e33530e30340.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/649e16fe-3ea2-4d5a-8968-60986a853db5.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/52c16127-5e27-4d35-b691-98dadfd1ff5b.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/f2203034-c546-44e6-93e2-c165eacfeef0.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p> </p>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/e8cd7d2c-f6f8-498f-8a11-6e134beae1e7.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å›¾ç‰‡</p></p>

<h2>8.3.å¸¸ç”¨è®¡åˆ’ä»»åŠ¡è¡¨</h2>

<p><p class="hassubimage"><img src="https://dn-coding-net-production-pp.qbox.me/6e0e134e-bfc5-4a72-bedc-aaa2f21fb09d.png"></p>
                    <p class="img-title"><span class="symbol">#</span>å¸¸ç”¨è®¡åˆ’ä»»åŠ¡è¡¨</p></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">59</span> <span class="mi">23</span> <span class="mi">1</span> <span class="o">*</span> <span class="err">?</span> <span class="o">*</span>    <span class="c1"># æ¯æœˆ1å·çš„23ç‚¹59åˆ†æ‰§è¡Œ</span>
<span class="mi">0</span> <span class="mo">00</span> <span class="mi">8</span><span class="p">,</span><span class="mi">18</span> <span class="err">?</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="c1"># æ¯å¤©çš„8ç‚¹å’Œ18ç‚¹æ•´æ‰§è¡Œ</span>
</pre></div>
</div>
<h1>9.rundeck dockeråŒ–</h1>
<blockquote class="blockquote-normal">
                <p>ç›®çš„: è®©rundeckå¹³å°çš„é…ç½®æ•°æ®ä¸ä¸¢å¤± å¹¶ä¸” åœ¨ä»»ä½•æœºå™¨éƒ½èƒ½å¾ˆå¿«é€Ÿçš„å¯åŠ¨ </p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># æ¡ä»¶åå°„: </span>
    <span class="n">docker</span><span class="err">æ¥è§£å†³</span><span class="p">,</span><span class="err">é•œåƒæ”¾åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“</span><span class="p">,</span><span class="err">æ•°æ®å­˜å‚¨åˆ°äº‘ç£ç›˜</span><span class="p">;</span> 

<span class="c1"># ç†æƒ³çŠ¶æ€: </span>
    <span class="err">è‹¥å®¹å™¨æŒ‚æ‰</span><span class="p">,</span><span class="err">åˆ™ä½¿ç”¨æ„å»ºå¥½çš„é•œåƒé‡æ–°</span><span class="n">run</span><span class="err">ä¸€ä¸ªå®¹å™¨</span><span class="p">;</span>
    <span class="err">è‹¥é•œåƒæŒ‚æ‰</span><span class="p">,</span><span class="err">åˆ™ä½¿ç”¨</span><span class="n">Dockerfile</span><span class="err">é‡æ–°æ‰“ä¸€ä¸ªé•œåƒ</span><span class="p">,</span><span class="err">å†</span><span class="n">run</span><span class="err">ä¸€ä¸ªå®¹å™¨</span><span class="p">;</span>
    <span class="err">è‹¥ç‰©ç†æœºå™¨æŒ‚æ‰</span><span class="p">,</span><span class="err">åˆ™é‡å¼€ä¸€å°æœºå™¨</span><span class="p">,</span><span class="err">æŒ‚è½½äº‘ç£ç›˜</span><span class="p">,</span><span class="n">pull</span><span class="err">é•œåƒ</span><span class="p">,</span><span class="n">run</span><span class="err">å®¹å™¨</span><span class="p">;</span>

<span class="c1"># dockeræœåŠ¡åŒ–ç†è§£:</span>
    <span class="p">(</span><span class="err">ä¸ªäººç†è§£</span><span class="p">)</span><span class="n">docker</span><span class="err">çš„å¸¸è§„ä½¿ç”¨åœºæ™¯æ¥è¯´</span><span class="p">,</span><span class="n">docker</span><span class="err">ä¸€èˆ¬ä¼šå°†æœåŠ¡å’Œæ•°æ®åˆ†ç¦»</span><span class="p">(</span><span class="err">åˆ†åˆ«åˆ›å»º</span><span class="n">docker</span><span class="err">å®¹å™¨</span><span class="p">),</span>
<span class="err">å…¶ä¸­æœåŠ¡ç›¸å…³çš„é…ç½®ä¸€èˆ¬æ¥è¯´æ˜¯ä¸å˜çš„</span><span class="p">,</span><span class="err">å¦‚æœæ”¹å˜åˆ™éœ€è¦æ›´æ–°åˆ°é•œåƒä¸­</span><span class="p">,</span><span class="err">æ¥ä¿è¯å…¬å…¨ç½‘çš„æœåŠ¡ç»Ÿä¸€æ€§</span><span class="p">,</span>
<span class="err">å¹¶æ–¹ä¾¿ç§»æ¤</span><span class="p">;</span>

<span class="c1"># é‚£ä¹ˆè§£å†³æ–¹æ³•(äº²æµ‹å¯è¡Œ):</span>
    <span class="mf">1.</span><span class="err">å°†å®‰è£…æ–‡ä»¶æ”¾åˆ°å…±äº«ç£ç›˜</span>
    <span class="mf">2.</span><span class="err">åœ¨</span><span class="n">Docker</span> <span class="n">run</span> <span class="err">æˆ–è€…</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="err">æ–‡ä»¶ä¸­æŒ‚è½½å…±äº«ç£ç›˜åˆ°</span><span class="n">rundeck</span>
    <span class="mf">3.</span><span class="err">ç„¶å</span><span class="n">rundeck</span><span class="err">çš„</span><span class="n">Dockerfile</span><span class="err">çš„å…¥å£</span><span class="n">shell</span><span class="err">è„šæœ¬è¿›è¡Œæ•°æ®åº“è¿æ¥</span><span class="p">,</span><span class="err">åˆå§‹åŒ–å®‰è£…</span><span class="n">rundeck</span><span class="p">,</span><span class="err">å¹¶å¯åŠ¨</span><span class="p">;</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># è®²é“ç†çš„è¯, å…¶å®ç›´æ¥åœ¨äº‘ç£ç›˜è¿è¡Œ, åŒæ ·èƒ½æ»¡è¶³éœ€æ±‚, è€Œä¸”æ›´ç®€å•!</span>
<span class="c1"># æœ‰æ—¶å€™æ„Ÿè§‰æ•´ä¸ªdockerå¹³å°æ²¡æœ‰å¼€å§‹ä¹‹å‰, ä¸Šdockerè¿™æ˜¯æœ‰ç‚¹æ‰¾ç½ªå—å•Š!(ä¸å–œå‹¿å–·)</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># Dockerfile</span>
<span class="n">FROM</span> <span class="n">registry</span><span class="o">.</span><span class="n">cn</span><span class="o">-</span><span class="n">hangzhou</span><span class="o">.</span><span class="n">aliyuncs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xingzhe_server</span><span class="o">/</span><span class="n">ubuntu_java</span><span class="p">:</span><span class="n">latest</span>
<span class="n">COPY</span>    <span class="n">run</span><span class="o">.</span><span class="n">sh</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">rundeck</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">data</span>
<span class="n">EXPOSE</span>  <span class="mi">4440</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;rundeck&quot;</span><span class="p">]</span>
</pre></div>
</div><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># docker-compose.yml</span>
<span class="n">mysql</span><span class="p">:</span>
  <span class="n">image</span><span class="p">:</span> <span class="n">registry</span><span class="o">.</span><span class="n">cn</span><span class="o">-</span><span class="n">hangzhou</span><span class="o">.</span><span class="n">aliyuncs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xingzhe_server</span><span class="o">/</span><span class="n">mysql</span><span class="p">:</span><span class="n">latest</span>
  <span class="n">environment</span><span class="p">:</span>
    <span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="n">rundeck</span>
    <span class="n">MYSQL_DATABASE</span><span class="p">:</span> <span class="n">rundeck</span>
    <span class="n">MYSQL_USER</span><span class="p">:</span> <span class="n">xz</span>
    <span class="n">MYSQL_PASSWORD</span><span class="p">:</span> <span class="n">xz</span>
  <span class="n">volumes</span><span class="p">:</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">docker_data</span><span class="o">/</span><span class="n">rundeck_mariadb</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>

<span class="n">rundeck</span><span class="p">:</span>
  <span class="n">image</span><span class="p">:</span> <span class="n">registry</span><span class="o">.</span><span class="n">cn</span><span class="o">-</span><span class="n">hangzhou</span><span class="o">.</span><span class="n">aliyuncs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xingzhe_server</span><span class="o">/</span><span class="n">rundeck</span><span class="p">:</span><span class="n">latest</span>
  <span class="n">environment</span><span class="p">:</span>
    <span class="n">MYSQL_USER</span><span class="p">:</span> <span class="n">xz</span>
    <span class="n">MYSQL_PASSWORD</span><span class="p">:</span> <span class="n">xz</span>
    <span class="c1">#DEFAULT_ADMIN_USER: admin</span>
    <span class="c1">#DEFAULT_ADMIN_PASSWORD: admin</span>
    <span class="n">RDECK_BASE</span><span class="p">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">rundeck</span>
    <span class="n">RDECK_JAR</span><span class="p">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">rundeck</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">jar</span>
    <span class="n">USE_INTERNAL_IP</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.106</span>
  <span class="n">links</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">mysql</span><span class="p">:</span><span class="n">mysql</span>
  <span class="n">volumes</span><span class="p">:</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">docker_data</span><span class="o">/</span><span class="n">rundeck</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">rundeck</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="o">-</span> <span class="mi">4440</span><span class="p">:</span><span class="mi">4440</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>javaå¯åŠ¨rundeckç¨‹åºæ—¶åŒºå‚æ•°éœ€è¦æ³¨æ„,å¦åˆ™å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ—¶é—´æ€»æ˜¯ä¸å¯¹<br/>-Duser.timezone=Asia/Shanghai</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># run.sh</span>
<span class="c1">#!/bin/bash</span>

<span class="c1"># OPTIONS:</span>
<span class="c1">#   DEFAULT_ADMIN_USER          Set the default admin user (defaults to &quot;admin&quot;)</span>
<span class="c1">#   DEFAULT_ADMIN_PASSWORD      Set the default admin&#39;s password (defaults to &quot;admin&quot;)</span>
<span class="c1">#   DEFAULT_USER                Set the default user (defaults to &quot;docker&quot;)</span>
<span class="c1">#   DEFAULT_PASSWORD            Set the default user&#39;s password (defaults to &quot;docker&quot;)</span>
<span class="c1">#   SERVER_MEMORY               Because Java is stupid</span>
<span class="c1">#   SERVER_PORT                 Sets Rundeck&#39;s listening port (defaults to &quot;4440&quot;)</span>
<span class="c1">#   SERVER_URL                  Sets Rundeck&#39;s grails.serverURL</span>
<span class="c1">#   MYSQL_USER                  MySQL username</span>
<span class="c1">#   MYSQL_PASSWORD              MySQL password</span>
<span class="c1">#   MYSQL_ADDR                  MySQL address (defaults to &quot;mysql&quot;)</span>
<span class="c1">#   MYSQL_DB                    MySQL database name (defaults to &quot;rundeck&quot;)</span>
<span class="c1">#   USE_INTERNAL_IP             When SERVER_URL is undefined, use the container&#39;s eth0 address (otherwise try to guess external)</span>

<span class="n">config_properties</span><span class="o">=</span><span class="err">$</span><span class="n">RDECK_BASE</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">rundeck</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">properties</span>
<span class="n">mem</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="n">SERVER_MEMORY</span><span class="p">:</span><span class="o">-</span><span class="mi">1024</span><span class="p">}</span>
<span class="n">perm</span><span class="o">=</span><span class="err">$</span><span class="p">((</span><span class="err">$</span><span class="n">mem</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>

<span class="n">function</span> <span class="n">install_rundeck</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="err">$</span><span class="n">RDECK_JAR</span> <span class="o">--</span><span class="n">installonly</span>
    <span class="c1">#echo &quot;${DEFAULT_ADMIN_USER:-docker}:${DEFAULT_ADMIN_PASSWORD:-docker},user,admin&quot; &gt; $RDECK_BASE/server/config/realm.properties</span>
    <span class="c1">#echo &quot;${DEFAULT_USER:-docker}:${DEFAULT_PASSWORD:-docker},user&quot; &gt;&gt; $RDECK_BASE/server/config/realm.properties</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">config_grails_url</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">## Get eth0&#39;s IP</span>
    <span class="c1">#if [ -z ${SERVER_URL} ]; then</span>
    <span class="c1">#    ext_ip=$(curl --silent http://ipv4bot.whatismyipaddress.com)</span>
    <span class="c1">#    int_ip=$(ip -4 -o addr show scope global eth0 | awk &#39;{gsub(/\/.*/,&quot;&quot;,$4); print $4}&#39;)</span>
    <span class="c1">#    if [ -z ${USE_INTERNAL_IP} ]; then</span>
    <span class="c1">#        SERVER_URL=http://${ext_ip}:${SERVER_PORT:-4440}</span>
    <span class="c1">#    else</span>
    <span class="c1">#        SERVER_URL=http://${int_ip}:${SERVER_PORT:-4440}</span>
    <span class="c1">#    fi</span>
    <span class="c1">#fi</span>
    <span class="n">SERVER_URL</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="err">$</span><span class="p">{</span><span class="n">USE_INTERNAL_IP</span><span class="p">}:</span><span class="err">$</span><span class="p">{</span><span class="n">SERVER_PORT</span><span class="p">:</span><span class="o">-</span><span class="mi">4440</span><span class="p">}</span>
    <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;s,^grails\.serverURL.*\$,grails\.serverURL=${SERVER_URL},&quot;</span> <span class="err">$</span><span class="n">config_properties</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">config_mysql</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sql_datasource</span><span class="o">=</span><span class="s2">&quot;dataSource.url = jdbc:mysql://${MYSQL_ADDR:-mysql}/${MYSQL_DB:-rundeck}?autoReconnect=true&quot;</span>
    <span class="n">sql_un</span><span class="o">=</span><span class="s2">&quot;dataSource.username = ${MYSQL_USER}&quot;</span>
    <span class="n">sql_pw</span><span class="o">=</span><span class="s2">&quot;dataSource.password = ${MYSQL_PASSWORD}&quot;</span>
    <span class="n">extra_crap_for_sql</span><span class="o">=</span><span class="s2">&quot;rundeck.projectsStorageType=db</span><span class="se">\n</span><span class="s2">rundeck.storage.provider.1.type=db</span><span class="se">\n</span><span class="s2">rundeck.storage.provider.1.path=keys&quot;</span>
    <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;s,^dataSource\.url.*\$,${sql_datasource},&quot;</span> <span class="err">$</span><span class="n">config_properties</span>
    <span class="n">echo</span> <span class="err">$</span><span class="n">sql_un</span> <span class="o">&gt;&gt;</span> <span class="err">$</span><span class="n">config_properties</span><span class="p">;</span> <span class="n">echo</span> <span class="err">$</span><span class="n">sql_pw</span> <span class="o">&gt;&gt;</span> <span class="err">$</span><span class="n">config_properties</span>
    <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">$</span><span class="n">extra_crap_for_sql</span> <span class="o">&gt;&gt;</span> <span class="err">$</span><span class="n">config_properties</span>
<span class="p">}</span>

<span class="n">install_rundeck</span>
<span class="n">config_grails_url</span>

<span class="k">if</span> <span class="err">!</span> <span class="p">[</span> <span class="o">-</span><span class="n">z</span> <span class="err">$</span><span class="p">{</span><span class="n">MYSQL_USER</span><span class="p">}</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="err">!</span> <span class="p">[</span> <span class="o">-</span><span class="n">z</span> <span class="err">$</span><span class="p">{</span><span class="n">MYSQL_PASSWORD</span><span class="p">}</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">config_mysql</span>
<span class="n">fi</span>

<span class="n">echo</span> <span class="s2">&quot;#################STARTING RUNDECK#######################&quot;</span>
<span class="k">exec</span> <span class="n">java</span> <span class="o">-</span><span class="n">Xmx</span><span class="err">$</span><span class="p">{</span><span class="n">mem</span><span class="p">}</span><span class="n">m</span> \
  <span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">MaxPermSize</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="n">perm</span><span class="p">}</span><span class="n">m</span> \
  <span class="o">-</span><span class="n">Drundeck</span><span class="o">.</span><span class="n">jetty</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">forwarded</span><span class="o">=</span><span class="n">true</span> \
  <span class="o">-</span><span class="n">Dserver</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">host</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> \
  <span class="o">-</span><span class="n">Dserver</span><span class="o">.</span><span class="n">hostname</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span> \
  <span class="o">-</span><span class="n">Dserver</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="n">SERVER_PORT</span><span class="p">:</span><span class="o">-</span><span class="mi">4440</span><span class="p">}</span> \
  <span class="o">-</span><span class="n">Dfile</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> \
  <span class="o">-</span><span class="n">Duser</span><span class="o">.</span><span class="n">timezone</span><span class="o">=</span><span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span> <span class="o">-</span><span class="n">jar</span> <span class="err">$</span><span class="n">RDECK_JAR</span> <span class="o">--</span><span class="n">skipinstall</span> <span class="o">&amp;</span>
<span class="n">rd_pid</span><span class="o">=</span><span class="err">$!</span>
<span class="n">wait</span> <span class="err">$</span><span class="n">rd_pid</span>
<span class="n">echo</span> <span class="s2">&quot;##############RUNDECK HAS DIED :(#######################&quot;</span>
</pre></div>
</div><blockquote class="blockquote-normal">
                <p>å¦‚æœæ—¶é—´è¿˜æ˜¯ä¸å¯¹,å¯èƒ½æ˜¯å®¹å™¨çš„æ—¶é—´æœ‰é—®é¢˜<br/> ä»¥ä¸‹æ˜¯Ubuntuç³»ç»Ÿæ›´æ”¹æ—¶åŒºçš„å›¾è§£</p></blockquote>
<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901073212924.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901073567384.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901073649882.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901073892175.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901074002681.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901074229123.jpg"></p>
</p>

<p><p class="hassubimage"><img src="http://iwillb.imdancer.com/14901077423143.jpg"></p>
</p>

<h1>10.æ¥å£ç®¡ç†</h1>

<h2>10.1 è°ƒç”¨è‡ªå¸¦æ¥å£æ·»åŠ job</h2>
<blockquote class="blockquote-normal">
                <p>è§‰å¾—åœ¨webä¸Šç‚¹ç‚¹ç‚¹è¾“å…¥é…ç½®,ä¸å¦‚ç›´æ¥è°ƒç”¨æ¥å£æ¥çš„å¿«é€Ÿ</p></blockquote><div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_job</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;rundeckæ·»åŠ job&quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_type</span><span class="p">),</span>
        <span class="s1">&#39;charset&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
        <span class="s1">&#39;X-Rundeck-Auth-Token&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">token</span>  <span class="c1"># ç‰¹åˆ«æ³¨æ„è¿™é‡Œçš„è®¤è¯æ–¹å¼</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span>

<span class="k">def</span> <span class="nf">format_job_xml</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">exec_str</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;æ ¼å¼åŒ–æ·»åŠ jobxmlå­—ç¬¦ä¸²</span>

<span class="sd">    :param: name: str: jod_id,è‹±æ–‡æ ‡é¢˜</span>
<span class="sd">    :param: group: str: jobç»„åˆ«</span>
<span class="sd">    :param: description: str: jobæè¿°</span>
<span class="sd">    :param: exec_str: str: æ‰§è¡Œå‘½ä»¤</span>
<span class="sd">    :param: args: list: æ‰§è¡Œå‚æ•°, æ ¼å¼:[{&quot;name&quot;:name, &quot;value&quot;:value, &quot;desc&quot;:desc}]</span>
<span class="sd">    :param: node: str: æ‰§è¡ŒèŠ‚ç‚¹</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># æ ¼å¼åŒ–è¾“å…¥å‚æ•°</span>
    <span class="n">option</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;option name=&#39;{}&#39; required=&#39;true&#39; value=&#39;{}&#39;&gt;</span>
<span class="s2">                    &lt;description&gt;{}&lt;/description&gt;</span>
<span class="s2">                &lt;/option&gt;&quot;&quot;&quot;</span> 
    <span class="n">option_base</span> <span class="o">=</span> <span class="s2">&quot;${option.</span><span class="si">%s</span><span class="s2">}&quot;</span> 

    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">options_exec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">option_str</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">arg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">arg</span><span class="p">[</span><span class="s2">&quot;desc&quot;</span><span class="p">])</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option_str</span><span class="p">)</span>

        <span class="n">option_base_str</span> <span class="o">=</span> <span class="n">option_base</span> <span class="o">%</span> <span class="n">arg</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">options_exec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option_base_str</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">options_exec</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options_exec</span><span class="p">)</span> 

    <span class="n">job_xml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;joblist&gt;</span>
<span class="s2">      &lt;job&gt;</span>
<span class="s2">        &lt;context&gt;</span>
<span class="s2">          &lt;options preserveOrder=&#39;true&#39;&gt;</span>
<span class="s2">            {options}</span>
<span class="s2">          &lt;/options&gt;</span>
<span class="s2">        &lt;/context&gt;</span>
<span class="s2">        &lt;description&gt;{description}&lt;/description&gt;</span>
<span class="s2">        &lt;executionEnabled&gt;true&lt;/executionEnabled&gt;</span>
<span class="s2">        &lt;group&gt;{group}&lt;/group&gt;</span>
<span class="s2">        &lt;id&gt;{name}&lt;/id&gt;</span>
<span class="s2">        &lt;loglevel&gt;INFO&lt;/loglevel&gt;</span>
<span class="s2">        &lt;name&gt;{name}&lt;/name&gt;</span>
<span class="s2">        &lt;nodefilters&gt;</span>
<span class="s2">            &lt;filter&gt;name: {node}&lt;/filter&gt;</span>
<span class="s2">        &lt;/nodefilters&gt;</span>
<span class="s2">        &lt;scheduleEnabled&gt;true&lt;/scheduleEnabled&gt;</span>
<span class="s2">        &lt;sequence keepgoing=&#39;false&#39; strategy=&#39;node-first&#39;&gt;</span>
<span class="s2">          &lt;command&gt;</span>
<span class="s2">            &lt;description&gt;&lt;/description&gt;</span>
<span class="s2">            &lt;exec&gt;{exec_str} {options_exec}&lt;/exec&gt;</span>
<span class="s2">          &lt;/command&gt;</span>
<span class="s2">        &lt;/sequence&gt;</span>
<span class="s2">        &lt;uuid&gt;{name}&lt;/uuid&gt;</span>
<span class="s2">      &lt;/job&gt;</span>
<span class="s2">    &lt;/joblist&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">exec_str</span><span class="o">=</span><span class="n">exec_str</span><span class="p">,</span> <span class="n">options_exec</span><span class="o">=</span><span class="n">options_exec</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">job_xml</span>



<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">exec_str</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> 
    <span class="c1">#name = &quot;rundeck_add_job&quot;   </span>
    <span class="c1">#group = &quot;Rundeck&quot;</span>
    <span class="c1">#description = &quot;Rundeckç®¡ç†&quot;</span>
    <span class="c1">#exec_str = &quot;&quot;&quot;cd /docker_data/rundeck/scripts;python æ·»åŠ job.py&quot;&quot;&quot; </span>
    <span class="c1">#args = eval(&quot;&quot;&quot;[</span>
    <span class="c1">#    {&quot;name&quot;:&quot;name&quot;, &quot;value&quot;:None, &quot;desc&quot;:&quot;ç¨‹åºè‹±æ–‡åç§°&quot;}, </span>
    <span class="c1">#    {&quot;name&quot;:&quot;group&quot;, &quot;value&quot;:&quot;Rundeckç®¡ç†&quot;, &quot;desc&quot;:&quot;ç¨‹åºå½’å±ç»„&quot;}, </span>
    <span class="c1">#    {&quot;name&quot;:&quot;description&quot;, &quot;value&quot;:None, &quot;desc&quot;:&quot;ç¨‹åºåŠŸèƒ½æè¿°&quot;}, </span>
    <span class="c1">#    {&quot;name&quot;:&quot;exec_str&quot;, &quot;value&quot;:None, &quot;desc&quot;:&quot;ç¨‹åºæ‰§è¡Œå‘½ä»¤&quot;},</span>
    <span class="c1">#    {&quot;name&quot;:&quot;args&quot;, &quot;value&quot;:&quot;dx1426409836&quot;, &quot;desc&quot;:&quot;ç¨‹åºæ‰§è¡Œå‚æ•°&quot;}</span>
    <span class="c1">#    {&quot;name&quot;:&quot;node&quot;, &quot;value&quot;:&quot;OpsScripts&quot;, &quot;desc&quot;:&quot;ç¨‹åºæ‰§è¡ŒèŠ‚ç‚¹&quot;}</span>
    <span class="c1">#    ]&quot;&quot;&quot;)</span>
    <span class="n">job_xml</span> <span class="o">=</span> <span class="n">format_job_xml</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">exec_str</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
    <span class="c1"># æ³¨æ„:æ­¤å¤„çš„tokenéœ€è¦ä½¿ç”¨webç•Œé¢ç™»å½•ç®¡ç†å‘˜è´¦å·,ç„¶å,è´¦å·-Profile-Generate New Token</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">add_job</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://120.26.235.204:4440/api/18/project/xingzhe/jobs/import&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">job_xml</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;xml&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;xxxxxxxx&quot;</span><span class="p">)</span>
</pre></div>
</div>
<h2>10.2 rundeckrun ä¸€ä¸ªå¥½ç”¨çš„rundeck apiå·¥å…·åº“</h2>
<blockquote class="blockquote-normal">
                <p>é™„ä¸Šä½œè€…githubåœ°å€, å¹¶ç»™ä½œè€…100ä¸ªèµ </p></blockquote>
<p><a href="https://github.com/marklap/rundeckrun">githubé“¾æ¥</a></p>

<h2>11.rundeck å¤‡ä»½</h2>

<h3>11.1 å¤‡ä»½projectåŠjobs</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre># å¤‡ä»½project
cp -r /apps/rundeck/project å¤‡ä»½è·¯å¾„

# å¤‡ä»½jobs ï¼ˆæ¯”å¦‚å¤‡ä»½appsé¡¹ç›®ï¼‰
/app/rundeck/tools/bin/rd-jobs list -f ~/backup/jobs.xml -p apps

# å¤‡ä»½data/logs ï¼ˆéœ€è¦å…ˆåœæ­¢rundeckï¼‰
sh  server/sbin/rundeckd stop
cp -r  /apps/rundeck/server/data/ ~/backup
cp -r  /apps/rundeck/var/logs/ ~/backup
sh  server/sbin/rundeckd start</pre></div></div>

<h3>11.2 è¿˜åŸjobs</h3>
<div class="code-wrapper">
          <div class="lang-label">Raw</div>
        
<div class="highlight"><pre>/apps/rundeck/tools/bin/rd-jobs load -f ~/backup/jobs.xml -p apps</pre></div></div>

    </div>
    <div id="donate" style="text-align: center;">
        <a href="#donation-wrapper"><div onclick="displayDonation()" class="ui basic green button">æ‰“èµ <i class="red heart icon"></i></div></a>
    </div>
    <div id="comments">
    </div>
    <div id="more-words">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>

        <div id="footer" class="footer code">
            <span>Â© 1994 - 2018 willdx</span><b>@</b><a class="code" href="https://github.com/willdx/willdx.github.io">blog.willdx.me</a>
            <br/>
            <span class="notprint">
                <span id="busuanzi_container_site_pv">
                    <i class="eye icon"></i><span id="busuanzi_value_site_pv" class="orange text"></span> pv
                </span>
                <b> | </b>
                <span id="busuanzi_container_site_uv">
                    <i class="user icon"></i><span id="busuanzi_value_site_uv" class="orange text"></span> uv
                </span>
                <br/>
            </span>
            <span>Power by <i class="github alternate icon"></i><a href="https://github.com/willdx/willdx.github.io">Github Page</a></span>
            <br/>
            <i class="green superpowers icon"></i>
        </div>
    </body>
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="/assets/js/web.js"></script>
    <script>
        // ç»Ÿè®¡ä»£ç 
        var skin = localStorage.getItem('skin');

        if (skin) {
            document.body.className = skin;
        } else {
            localStorage.setItem('skin', 'sk-default');
        }

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-68394485-1', 'auto');
        ga('send', 'pageview');

        var wrappers = ["cats-wrapper", "donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat();
        }
    </script>
    
    <script src="/assets/3rd/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
        clientID: 'de35601f0076c240632f',
        clientSecret: 'b44ba043a5af4818f53dc13d3b4e49b5a28a2a0c',
        repo: 'willdx.github.io',
        owner: 'willdx',
        admin: ['willdx'],
        id: 'rundeck-å®‰è£…-ä½¿ç”¨-ç®¡ç†-dockeråŒ–-æ¥å£ç®¡ç†',      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        labels: ['gitment'],
        pagerDirection: "last",
    })
      
    gitalk.render('comments')
    </script>


</html>